<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/xiaolangwiki/images/favicon64.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/xiaolangwiki/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/xiaolangwiki/images/favicon16.ico">
  <link rel="mask-icon" href="/xiaolangwiki/images/favicon48.ico" color="#222">

<link rel="stylesheet" href="/xiaolangwiki/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Noto Serif SC:300,300italic,400,400italic,700,700italic|Console:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/xiaolangwiki/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/xiaolangwiki/lib/pace/pace-theme-minimal.min.css">
  <script src="/xiaolangwiki/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"liantianno1.github.io","root":"/xiaolangwiki/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","enable":false,"active":"gitalk","storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
<meta property="og:type" content="website">
<meta property="og:title" content="小浪wiki">
<meta property="og:url" content="https://liantianno1.github.io/xiaolangwiki/page/2/index.html">
<meta property="og:site_name" content="小浪wiki">
<meta property="og:description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="小浪wiki">
<meta property="article:tag" content="小浪wiki, 编程, 计算机, 软件工程, 互联网">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://liantianno1.github.io/xiaolangwiki/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<!-- 页面点击小红心 -->
<!-- <script type="text/javascript" src="/xiaolangwiki/js/love.js"></script> -->
<script type="text/javascript" defer src="/xiaolangwiki/js/mybg.js"></script>
<!-- 文章加密 -->
<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>

  <title>小浪wiki</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="referrer" content="no-referrer"/>
<link rel="alternate" href="/xiaolangwiki/atom.xml" title="小浪wiki" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/xiaolangwiki/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">小浪wiki</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一个关于编程、计算机、软件工程、互联网</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/xiaolangwiki/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/xiaolangwiki/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/xiaolangwiki/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/xiaolangwiki/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/LianTianNo1" class="github-corner" title="LianTianNo1&#96; GitHub" aria-label="LianTianNo1&#96; GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2022/01/12/14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2022/01/12/14/" class="post-title-link" itemprop="url">一个基本的拦截器实现示例：Axios 拦截器</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-12 11:01:14" itemprop="dateCreated datePublished" datetime="2022-01-12T11:01:14+08:00">2022-01-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一个基本的拦截器实现示例："><a href="#一个基本的拦截器实现示例：" class="headerlink" title="一个基本的拦截器实现示例："></a>一个基本的拦截器实现示例：</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InterceptorManager</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handlers</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">use</span>(<span class="params">fulfilled, rejected</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      fulfilled,</span><br><span class="line">      rejected</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">handlers</span>.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">eject</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">handlers</span>[id]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">handlers</span>[id] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Axios</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span> = &#123;</span><br><span class="line">      <span class="attr">request</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>(),</span><br><span class="line">      <span class="attr">response</span>: <span class="keyword">new</span> <span class="title class_">InterceptorManager</span>()</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">request</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 创建 Promise 链</span></span><br><span class="line">    <span class="keyword">let</span> chain = [</span><br><span class="line">      <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Sending Request:&#x27;</span>, config);</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">undefined</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加请求拦截器</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="property">handlers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">interceptor</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (interceptor !== <span class="literal">null</span>) &#123;</span><br><span class="line">        chain.<span class="title function_">unshift</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加响应拦截器</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="property">handlers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">interceptor</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (interceptor !== <span class="literal">null</span>) &#123;</span><br><span class="line">        chain.<span class="title function_">push</span>(interceptor.<span class="property">fulfilled</span>, interceptor.<span class="property">rejected</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行 Promise 链</span></span><br><span class="line">    <span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config);</span><br><span class="line">    <span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">      promise = promise.<span class="title function_">then</span>(chain.<span class="title function_">shift</span>(), chain.<span class="title function_">shift</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> axios = <span class="keyword">new</span> <span class="title class_">Axios</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request Interceptor 1&#x27;</span>);</span><br><span class="line">    config.<span class="property">headers</span> = &#123; <span class="string">&#x27;X-Custom-Header&#x27;</span>: <span class="string">&#x27;foo&#x27;</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Response Interceptor 1&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送请求</span></span><br><span class="line">axios.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data&#x27;</span> &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Final Response:&#x27;</span>, response))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span><br></pre></td></tr></table></figure>
<p>这个简化版本包含了以下关键部分：</p>
<ol>
<li><code>InterceptorManager</code> 类：管理拦截器的添加和移除。</li>
<li><code>Axios</code> 类：包含请求方法和拦截器管理。</li>
<li><code>request</code> 方法：<ul>
<li>创建一个包含实际请求处理函数的初始 Promise 链。</li>
<li>将请求拦截器添加到链的开头。</li>
<li>将响应拦截器添加到链的末尾。</li>
<li>使用 <code>while</code> 循环执行整个 Promise 链。</li>
</ul>
</li>
<li>使用示例：展示了如何添加拦截器和发送请求。</li>
</ol>
<p>这个实现展示了拦截器的基本工作原理：</p>
<ul>
<li>拦截器被存储在数组中。</li>
<li>请求时，创建一个 Promise 链，包含所有拦截器和实际的请求处理。</li>
<li>Promise 链按顺序执行，允许每个拦截器修改请求或响应。</li>
</ul>
<p>实际的 Axios 库更加复杂</p>
<h2 id="拦截器实现的核心"><a href="#拦截器实现的核心" class="headerlink" title="拦截器实现的核心"></a>拦截器实现的核心</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(config);</span><br><span class="line"><span class="keyword">while</span> (chain.<span class="property">length</span>) &#123;</span><br><span class="line">  promise = promise.<span class="title function_">then</span>(chain.<span class="title function_">shift</span>(), chain.<span class="title function_">shift</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码是拦截器实现的核心，它创建了一个 Promise 链来依次执行所有的拦截器和实际的请求。让我们逐步分析：</p>
<ol>
<li><code>let promise = Promise.resolve(config);</code><ul>
<li>这行创建了一个立即解决（resolve）的 Promise，初始值是 config 对象。</li>
<li>这个 Promise 将作为整个链的起点。</li>
</ul>
</li>
<li><code>while (chain.length) &#123; ... &#125;</code><ul>
<li>这个循环会一直执行，直到 chain 数组为空。</li>
<li>chain 数组包含了所有的拦截器函数和实际的请求处理函数。</li>
</ul>
</li>
<li><code>promise = promise.then(chain.shift(), chain.shift());</code><ul>
<li><code>chain.shift()</code> 移除并返回数组的第一个元素。</li>
<li>这里每次调用 <code>shift()</code> 两次，分别获取成功回调和失败回调。</li>
<li><code>promise.then()</code> 将这两个回调添加到当前 Promise 的后面，形成一个新的 Promise。</li>
<li>新的 Promise 被赋值回 <code>promise</code> 变量，准备下一次循环。</li>
</ul>
</li>
</ol>
<p>工作流程示例：</p>
<p>假设我们有以下拦截器和请求处理函数：</p>
<ul>
<li>请求拦截器 1: requestInterceptor1</li>
<li>请求拦截器 2: requestInterceptor2</li>
<li>实际请求处理: sendRequest</li>
<li>响应拦截器 1: responseInterceptor1</li>
<li>响应拦截器 2: responseInterceptor2</li>
</ul>
<p>初始的 chain 数组可能如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  requestInterceptor2, errorHandler2,</span><br><span class="line">  requestInterceptor1, errorHandler1,</span><br><span class="line">  sendRequest, <span class="literal">undefined</span>,</span><br><span class="line">  responseInterceptor1, errorHandler3,</span><br><span class="line">  responseInterceptor2, errorHandler4</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>循环执行过程：</p>
<ol>
<li>第一次循环：<code>promise.then(requestInterceptor2, errorHandler2)</code></li>
<li>第二次循环：<code>promise.then(requestInterceptor1, errorHandler1)</code></li>
<li>第三次循环：<code>promise.then(sendRequest, undefined)</code></li>
<li>第四次循环：<code>promise.then(responseInterceptor1, errorHandler3)</code></li>
<li>第五次循环：<code>promise.then(responseInterceptor2, errorHandler4)</code></li>
</ol>
<p>这样，通过不断地将拦截器和请求处理函数添加到 Promise 链中，我们创建了一个完整的执行序列，确保了所有操作按照正确的顺序执行。</p>
<p>这种实现方式的优点是：</p>
<ol>
<li>灵活性：可以轻松添加或移除拦截器。</li>
<li>异步支持：每个拦截器都可以是异步的。</li>
<li>错误处理：每个步骤都有相应的错误处理机制。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2022/01/09/04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2022/01/09/04/" class="post-title-link" itemprop="url">husky的原理是什么</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-09 16:06:04" itemprop="dateCreated datePublished" datetime="2022-01-09T16:06:04+08:00">2022-01-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一个简化的代码示例,展示 husky 的基本实现原理。这个例子会展示 husky 如何拦截 Git hooks 并执行自定义脚本。请注意,这只是一个概念性的示例,真实的 husky 实现要复杂得多。</p>
<p>以下是一个简化的 JavaScript 代码示例,展示了 husky 的核心原理:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; execSync &#125; = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleHusky</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooksDir</span> = path.<span class="title function_">join</span>(<span class="string">&quot;.git&quot;</span>, <span class="string">&quot;hooks&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">config</span> = <span class="variable language_">this</span>.<span class="title function_">loadConfig</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载husky配置</span></span><br><span class="line">  <span class="title function_">loadConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> packageJson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;package.json&quot;</span>, <span class="string">&quot;utf8&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> packageJson.<span class="property">husky</span> || &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 安装Git hooks</span></span><br><span class="line">  <span class="title function_">install</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(<span class="variable language_">this</span>.<span class="property">hooksDir</span>)) &#123;</span><br><span class="line">      fs.<span class="title function_">mkdirSync</span>(<span class="variable language_">this</span>.<span class="property">hooksDir</span>, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">hooks</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">hookName</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> hookPath = path.<span class="title function_">join</span>(<span class="variable language_">this</span>.<span class="property">hooksDir</span>, hookName);</span><br><span class="line">      <span class="keyword">const</span> hookContent = <span class="variable language_">this</span>.<span class="title function_">generateHookScript</span>(hookName);</span><br><span class="line">      fs.<span class="title function_">writeFileSync</span>(hookPath, hookContent, &#123; <span class="attr">mode</span>: <span class="number">0o755</span> &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Husky hooks installed successfully!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成hook脚本</span></span><br><span class="line">  <span class="title function_">generateHookScript</span>(<span class="params">hookName</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`#!/bin/sh</span></span><br><span class="line"><span class="string"># Husky</span></span><br><span class="line"><span class="string"># 运行配置的脚本</span></span><br><span class="line"><span class="string"><span class="subst">$&#123;<span class="variable language_">this</span>.config.hooks[hookName]&#125;</span></span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 运行hook</span></span><br><span class="line">  <span class="title function_">runHook</span>(<span class="params">hookName</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">hooks</span>[hookName];</span><br><span class="line">    <span class="keyword">if</span> (script) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Running <span class="subst">$&#123;hookName&#125;</span> hook...`</span>);</span><br><span class="line">        <span class="title function_">execSync</span>(script, &#123; <span class="attr">stdio</span>: <span class="string">&quot;inherit&quot;</span> &#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;hookName&#125;</span> hook completed successfully.`</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;hookName&#125;</span> hook failed. Git operation aborted.`</span>);</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> husky = <span class="keyword">new</span> <span class="title class_">SimpleHusky</span>();</span><br><span class="line">husky.<span class="title function_">install</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟触发pre-commit hook</span></span><br><span class="line">husky.<span class="title function_">runHook</span>(<span class="string">&quot;pre-commit&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>这个简化的实现展示了 husky 的几个核心概念:</p>
<ol>
<li>配置加载: 从 package.json 文件中读取 husky 配置。</li>
<li>Hook 安装: 在.git/hooks 目录中创建对应的 hook 脚本文件。</li>
<li>Hook 脚本生成: 生成可执行的 shell 脚本,其中包含用户配置的命令。</li>
<li>Hook 执行: 当 Git 操作触发 hook 时,执行相应的脚本。</li>
<li>错误处理: 如果脚本执行失败,则阻止 Git 操作继续进行。</li>
</ol>
<p>使用这个简化版的 husky,你可以在 package.json 中添加类似这样的配置:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;husky&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run lint &amp;&amp; npm test&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pre-push&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后,当你尝试提交代码时,它会先运行 lint 和测试,只有在这些检查都通过后,提交才会成功。</p>
<p>请注意,实际的 husky 实现要复杂得多,包括更多的错误处理、跨平台兼容性、与不同版本的 Git 的兼容性等。这个示例仅用于说明基本原理。如果您需要在实际项目中使用,我强烈建议使用官方的 husky 包,因为它经过了充分的测试和优化。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2022/01/02/42/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2022/01/02/42/" class="post-title-link" itemprop="url">快速入门Webpack的简单使用</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-02 16:11:42" itemprop="dateCreated datePublished" datetime="2022-01-02T16:11:42+08:00">2022-01-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="快速入门-Webpack-的简单使用"><a href="#快速入门-Webpack-的简单使用" class="headerlink" title="快速入门 Webpack 的简单使用"></a>快速入门 Webpack 的简单使用</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7048497932647006216">https://juejin.cn/post/7048497932647006216</a></p>
<blockquote>
<p>前言</p>
</blockquote>
<p>大家好呀，我是小浪，这次给大家带来的是我以前学习<code>webpack</code>如何使用的时候的学习总结，希望能够帮助到有需要的朋友，在学校里的事挺多的，所以好久都没有在掘金发文章。要放假了，继续坚持学习，刷到林三心大佬的 B 站视频，三心大佬他自己写文章然后去分享给他人，是一种快速学习的途径，我认为对于我来说也是十分正确，在分享的同时自己印象也会深刻</p>
<p><strong>Webpack 简介</strong>：</p>
<blockquote>
<p>Webpack 是目前主流的前端工程化解决方案之一</p>
<p><strong>主要功能</strong>：它提供了友好的前端模块化开发支持，以及代码压缩混淆、处理浏览器端 JavaScript 的兼容性、性 能优化等强大的功能。</p>
<p><strong>好处</strong>：让程序员把工作的重心放到具体功能的实现上，提高了前端开发效率和项目的可维护性。 注意：目前 Vue，React 等前端项目，基本上都是基于 webpack 进行工程化开发的</p>
</blockquote>
<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>项目结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">project_name</span><br><span class="line">|—— src</span><br><span class="line">|    |—— index.js</span><br><span class="line">|—— index.html</span><br><span class="line">|—— package.json</span><br><span class="line">|—— webpack.config.js</span><br><span class="line">|—— babel.config.js</span><br></pre></td></tr></table></figure>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在项目中安装 webpack + webpack-cli，使用 <code>-D</code> 相当于 <code>--save-dev</code></p>
<p><code>-D</code> 写入到<code>package.json</code>中 <code>devDependencies</code>进行添加，表示我们只有在开发阶段才使用到</p>
<p><code>-S</code> 相当于 <code>--save</code> 写入到 <code>dependencies</code> 对象，表示开发环境和生产都使用</p>
<p>如果项目没有 <code>package.json</code> 使用 <code>npm init -y</code> 快速配置一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack@5.42.1 webpack-cli@4.9.0 -D</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.42.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;webpack-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.9.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置启动命令"><a href="#配置启动命令" class="headerlink" title="配置启动命令"></a>配置启动命令</h3><p>在<code>package.json</code>配置 <code>scripts</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>在命令行我们就使用 <code>npm run dev</code> 来启动 <code>webpack</code>命令</p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="创建-webpack-config-js-文件"><a href="#创建-webpack-config-js-文件" class="headerlink" title="创建 webpack.config.js 文件"></a>创建 webpack.config.js 文件</h3><p>在项目根目录中，创建名为 webpack.config.js 的 webpack 配置文件，webpack 在真正开始打包构建之前，会先读取这个配置文件，从而基于给定的配置，对项目进行打包。</p>
<h3 id="设置-mode"><a href="#设置-mode" class="headerlink" title="设置 mode"></a>设置 mode</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>mode</code> 可选值有两个，分别是：</p>
<blockquote>
<p><code>development</code></p>
<ul>
<li>开发环境</li>
<li>不会对打包生成的文件进行代码压缩和性能优化</li>
<li>打包速度快，适合在开发阶段使用</li>
</ul>
<p><code>production</code></p>
<ul>
<li>生产环境</li>
<li>会对打包生成的文件进行代码压缩和性能优化</li>
<li>打包速度很慢，仅适合在项目发布阶段使用</li>
</ul>
</blockquote>
<h3 id="设置入口和出口"><a href="#设置入口和出口" class="headerlink" title="设置入口和出口"></a>设置入口和出口</h3><p>webpack 4.x 和 5.x 中默认约定：</p>
<ul>
<li>默认入口文件为 <code>src -&gt; index.js</code></li>
<li>默认输出文件 <code>dist -&gt; main.js</code></li>
</ul>
<p>我们可以在<code>webpack.config.js</code>中自定义</p>
<p><code>entry</code>：打包的入口</p>
<p><code>output</code>：打包的出口</p>
<p>我们就可以像下面一样设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: <span class="string">&quot;./dist/mian.js&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>还是这样写比较好，使用<code>path</code>模块来拼接路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./src/index.js&quot;</span>),</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="webpack-dev-server-简单使用"><a href="#webpack-dev-server-简单使用" class="headerlink" title="webpack-dev-server 简单使用"></a>webpack-dev-server 简单使用</h2><p>当修改了源代码，<code>webpack</code> 会自动进行项目的打包和构建，这个就不用每次自己去<code>npm run dev</code>了</p>
<p><code>webpack-dev-server</code> 提供热更新的开发服务器</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server@3.11.2 -D</span><br></pre></td></tr></table></figure>
<p>安装完毕之后可通过 <code>webpack serve</code> 启动</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>方便<code>webpack-dev-server</code>的启动我们在<code>package.json</code>的<code>scripts</code>新加一个命令</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>在<code>webpack.config.js</code>配置端口，<code>devServer</code>可配置的选项有很多，我在这里就配置一个端口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>devServer.compress，启用 gzip 压缩。</p>
<p>devServer.contentBase，告诉服务器从哪里提供内容。只有在你想要提供静态文件时才需要。</p>
<p>devServer.host，指定 host。使用 0.0.0.0 可以让局域网内可访问。</p>
<p>devServer.hot，启用 webpack 的模块热替换特性（Hot Module Replacement）。</p>
<p>devServer.hotOnly，构建失败的时候是否不允许回退到使用刷新网页。</p>
<p>devServer.inline，模式切换。默认为内联模式，使用 false 切换到 iframe 模式。</p>
<p>devServer.open，启动 webpack-dev-server 后是否使用浏览器打开首页。</p>
<p>devServer.overlay，是否允许使用全屏覆盖的方式显示编译错误。默认不允许</p>
<p>devServer.port，监听端口号。默认 8080。</p>
<p>devServer.proxy，代理，对于另外有单独的后端开发服务器 API 来说比较适合。</p>
<p>devServer.publicPath，设置内存中的打包文件的输出目录。区别于 output.publicPath。</p>
</blockquote>
<p>修改后使用 <code>npm run serve</code> 进行项目的打包</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05445615b7d24fda9a42568be26c67ff~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211225133914336"></p>
<p>打包完毕后，启动一个实时打包的 <code>http</code> 服务器，提示我们访问 <code>http://localhost:8080/</code>，访问之后就可以查看我们页面效果</p>
<h3 id="打包的文件"><a href="#打包的文件" class="headerlink" title="打包的文件"></a>打包的文件</h3><p>打包生成的文件存放到了内存中，因为内存更快，提高实时打包的性能，所以上面设置的<code>output</code>的输出路径是针对<strong>没有安装</strong><code>webpack-dev-server</code>来说的</p>
<p>如何访问我们打包好的<code>bundel.js</code>呢，因为 <code>webpack-dev-server</code> 开启了一个服务器，<code>/</code>是项目的根目录，我们直接在<strong>地址栏</strong>就能访问到<code>bundle.js</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/898d1a90f1e04ee8ae218ee1fc5a937d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211225135310863"></p>
<h2 id="插件-plugin"><a href="#插件-plugin" class="headerlink" title="插件 plugin"></a>插件 plugin</h2><p>通过安装和配置第三方的插件，可以拓展 <code>webpack</code> 使它更强大</p>
<h3 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h3><p>这个插件我们会经常使用到它，将公共的<code>css</code>，<code>js</code>文件插入到 html 中，可以减少请求次数，达到优化的效果，以通过此插件自定制 <code>index.html</code> 页面的内容。</p>
<p>HTML 插件在生成的 <code>index.html</code> 页面，自动注入了打包的 <code>bundle.js</code> 文件</p>
<h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin@5.3.2 -D</span><br></pre></td></tr></table></figure>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><p>在 <code>webpack.config.js</code> 的 <code>plugins</code> 进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: \[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src/index.html&#x27;</span>),</span><br><span class="line">      <span class="attr">filename</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./dist/index.html&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  \],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>HtmlWebpackPlugin</code>有很多可选的参数，我就说下面三个常用的</p>
<blockquote>
<p><strong><code>title</code></strong>: 生成的 html 文档的标题。配置该项，它并不会替换指定模板文件中的 title 元素的内容</p>
<p><strong><code>template</code></strong>: 本地模板文件的位置，支持加载器(如 handlebars、ejs、undersore、html 等)</p>
<p><strong><code>filename</code></strong>：输出文件的文件名称，默认为<strong>index.html</strong>，不配置就是该文件名；此外，还可以为输出文件指定目录位置（例如’./dist/index.html’）</p>
</blockquote>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>运行命令 <code>npm run dev</code> 就可以看见打包完成</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b66e1783df734f88a0b9c76e1f1d0005~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211225142229881"></p>
<p>如果是用 <code>npm run serve</code> 就不会有这两个，而是都在内存中，我们可以使用地址栏查看</p>
<h3 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a>clean-webpack-plugin</h3><p>时自动清理掉 dist 目录中的旧文件</p>
<h4 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin@3.0.0 -D</span><br></pre></td></tr></table></figure>
<h4 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h4><p>在 <code>webpack.config.js</code> 的 <code>plugins</code> 进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ClenWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: \[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ClenWebpackPlugin</span>(),</span><br><span class="line">  \],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加载器-loader"><a href="#加载器-loader" class="headerlink" title="加载器 loader"></a>加载器 loader</h2><p>非 <code>.js</code> 后缀模块<code>webpack</code>默认处理不了只能理解 <code>JavaScript</code> 和 <code>JSON</code> 文件，需要调用<code>loader</code>加载器才可以正常打包</p>
<p><code>loader</code> 加载器的作用：<strong>导出为函数的 <code>JavaScript</code> 模块</strong>。比如：</p>
<blockquote>
<ul>
<li>css-loader 打包处理 .css 相关的文件</li>
<li>less-loader 打包处理 .less 相关的文件</li>
<li>babel-loader 打包处理 webpack 无法处理的高级 js 语法</li>
</ul>
</blockquote>
<h3 id="loader-调用流程"><a href="#loader-调用流程" class="headerlink" title="loader 调用流程"></a>loader 调用流程</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ce4b9fc6f334ca6a27cfb9a444f03d4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211225143748510"></p>
<h3 id="打包-css"><a href="#打包-css" class="headerlink" title="打包 css"></a>打包 css</h3><h4 id="安装-4"><a href="#安装-4" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i style-loader@3.0.0 css-loader@5.2.6 -D</span><br></pre></td></tr></table></figure>
<h4 id="配置-3"><a href="#配置-3" class="headerlink" title="配置"></a>配置</h4><p>其中，<code>test</code> 表示匹配的文件类型（用正则）， <code>use</code> 表示对应要调用的 <code>loader</code> 注意：</p>
<ul>
<li><code>use</code> 数组中指定的 <code>loader</code> 顺序是固定的</li>
<li><code>loader</code>调用顺序是：从右往左</li>
</ul>
<p>在 <code>webpack.config.js</code> 的 <code>module</code> 进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: \[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: \[<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>\],</span><br><span class="line">      &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="打包-less"><a href="#打包-less" class="headerlink" title="打包 less"></a>打包 less</h3><h4 id="安装-5"><a href="#安装-5" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i less-loader@10.0.1 less@4.1.1 -D</span><br></pre></td></tr></table></figure>
<h4 id="配置-4"><a href="#配置-4" class="headerlink" title="配置"></a>配置</h4><p>在 <code>webpack.config.js</code> 的 <code>module</code> 进行配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  //...</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: \[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">test</span>: /\\.less$/,</span><br><span class="line">        use: \[<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>,<span class="string">&#x27;less-loader\],</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">    \],</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>其他的 css 打包处理也一样安装指定的加载器</p>
<h3 id="打包文件"><a href="#打包文件" class="headerlink" title="打包文件"></a>打包文件</h3><p><code>loader</code>除了能打包<code>css</code>的之外，我们使用 <code>file-loader``url-loader</code>还可以对<code>url</code>引用的图片进行处理</p>
<h4 id="安装-6"><a href="#安装-6" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i url-loader@4.1.1 file-loader@6.2.0 -D</span><br></pre></td></tr></table></figure>
<h4 id="配置-5"><a href="#配置-5" class="headerlink" title="配置"></a>配置</h4><p>在 <code>webpack.config.js</code> 的 <code>module</code> 进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: \[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\\.jpg|png|gif$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">           	<span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">limit</span>: <span class="number">77777</span>,</span><br><span class="line">                <span class="attr">outputPath</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>options</code>是 <code>loader</code> 的参数项：</p>
<p><code>limit</code> 用来指定图片的大小，单位是字节（byte）只有 ≤ limit 大小的图片，才会被转为 base64 格式的图片</p>
<p><code>outputPath</code>:是指定的存储文件夹 <code>dist/image</code> 把图片文件统一生成到 image 目录中</p>
</blockquote>
<h3 id="babel-loader-简单使用"><a href="#babel-loader-简单使用" class="headerlink" title="babel-loader 简单使用"></a>babel-loader 简单使用</h3><p>借助于 <code>babel-loader</code> 进行打包处理 js 中的高级语法</p>
<h4 id="安装-7"><a href="#安装-7" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-loader@8.2.2 @babel/core@7.14.6 @babel/plugin-proposal-decorators@7.14.5 -D</span><br></pre></td></tr></table></figure>
<h4 id="配置-6"><a href="#配置-6" class="headerlink" title="配置"></a>配置</h4><p>在 <code>webpack.config.js</code> 的 <code>module</code> 进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: \[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：记得使用<code>exclude</code>排除掉 <code>/node_modules/</code>下面的模块</p>
</blockquote>
<p>在项目根目录下，创建 <code>babel.config.js</code> 文件进行配置</p>
<p>声明 <code>babel</code> 可用的插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: \[\[<span class="string">&#x27;@babel/plugin-proposal-decorators&#x27;</span>, &#123; <span class="attr">legacy</span>: <span class="literal">true</span> &#125;\]\],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="打包发布"><a href="#打包发布" class="headerlink" title="打包发布"></a>打包发布</h2><p>开发环境打包生成的文件不会进行代码压缩和性能优化，而且存放在内存中，所以在生产环境中打包发布</p>
<p>在 <code>package.json</code>的<code>scripts</code>中新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --mode production&quot;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>之后使用 <code>npm run build</code> 就直接打包发布了，这个 <code>--model</code> 是 <code>production</code> 代表生产环境，会对打包生成的文件 进行代码压缩和性能优化。 这里覆盖 <code>webpack.config.js</code> 中的 <code>model</code> 选项</p>
<h2 id="webpack-创建-Vue-项目"><a href="#webpack-创建-Vue-项目" class="headerlink" title="webpack 创建 Vue 项目"></a>webpack 创建 Vue 项目</h2><p>其实大家使用 <code>vue-cli</code> 和 <code>vue ui</code> 搭建出来的<code>vue</code>项目<code>webpack</code>都帮我们配置好了，这里我介绍下如何用 <code>webpack</code> 创建 <code>vue</code> 项目。</p>
<h3 id="初始化项目目录"><a href="#初始化项目目录" class="headerlink" title="初始化项目目录"></a>初始化项目目录</h3><p>建立项目文件夹之后初始化<code>package.json</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<p>在项目根目录创建 webpack 配置文件 <code>webpack.config.js</code> 在真正的开发中分开发环境和生产环境，这里为了方便就只写一个。</p>
<p><code>index.js</code>:入口文件</p>
<p><code>index.html</code>:入口文件模板</p>
<p><code>babel.config.js</code>：babel 配置文件（先创建之后在说）</p>
<p>项目结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">project_name</span><br><span class="line">|—— src</span><br><span class="line">|    |—— index.js</span><br><span class="line">|    |—— App.vue</span><br><span class="line">|—— index.html</span><br><span class="line">|—— package.json</span><br><span class="line">|—— webpack.config.js</span><br><span class="line">|—— babel.config.js</span><br></pre></td></tr></table></figure>
<h3 id="安装配置-webpack-相关"><a href="#安装配置-webpack-相关" class="headerlink" title="安装配置 webpack 相关"></a>安装配置 webpack 相关</h3><p>安装 <code>webpack``webpack-cli``webpack-dev-server</code> 依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack@5.42.1 webpack-cli@4.9.0 webpack-dev-server@3.11.2 -D</span><br></pre></td></tr></table></figure>
<p>配置 <code>package.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack-dev-server --open --hot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --mode=development --progress --hide-modules&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>配置 <code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./src/index.js&quot;</span>),</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="安装配置-Vue-相关"><a href="#安装配置-Vue-相关" class="headerlink" title="安装配置 Vue 相关"></a>安装配置 <code>Vue</code> 相关</h3><p>安装 <code>vue</code> 需要的依赖 <code>vue-loader``vue-template-compiler</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-loader vue-template-compiler -D</span><br></pre></td></tr></table></figure>
<p>如果项目没有 <code>vue</code> 记得装 <code>vue</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue</span><br></pre></td></tr></table></figure>
<p>配置 <code>webpack.config.js</code></p>
<blockquote>
<p>注意要引入 <code>VueLoaderPlugin</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">VueLoaderPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;vue-loader/lib/plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line"> <span class="attr">module</span>: &#123;</span><br><span class="line">      <span class="attr">rules</span>: \[</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\\.vue$/</span>,</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      \]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: \[</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>()</span><br><span class="line">  \]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><p><code>html-webpack-plugin</code>和<code>clean-webpack-plugin</code>插件，这两个插件我们都上面都有介绍过</p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin@5.3.2 clean-webpack-plugin@3.0.0 -D</span><br></pre></td></tr></table></figure>
<p>配置 <code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">	<span class="attr">plugins</span>: \[</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">     		<span class="attr">template</span>:<span class="string">&#x27;./index.html&#x27;</span>,</span><br><span class="line">		&#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">	\],</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="安装加载器"><a href="#安装加载器" class="headerlink" title="安装加载器"></a>安装加载器</h3><p><code>style-loader</code>、<code>css-loader</code>、 <code>file-loader``url-loader</code>等等我们上面都有介绍如果需要<code>sass</code>、<code>less</code>加载器可自行安装，这里我安装的是<code>sass</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install style-loader@3.0.0 css-loader@5.2.6 url-loader@4.1.1 file-loader@6.2.0 sass-loader node-sass -D</span><br></pre></td></tr></table></figure>
<p>配置 <code>webpack.config.js</code></p>
<blockquote>
<p><code>sass</code>要把 <code>node_modules</code> 排除</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">   <span class="attr">module</span>: &#123;</span><br><span class="line">       <span class="attr">rules</span>: \[</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="attr">test</span>: <span class="regexp">/\\.css$/</span>,</span><br><span class="line">               <span class="attr">use</span>: \[</span><br><span class="line">                   <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">               \]</span><br><span class="line">           &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">           <span class="attr">test</span>: <span class="regexp">/\\.jpg|png|gif$/</span>,</span><br><span class="line">           <span class="attr">use</span>: &#123;</span><br><span class="line">               <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">               <span class="attr">options</span>: &#123;</span><br><span class="line">                   <span class="attr">limit</span>: <span class="number">77777</span>,</span><br><span class="line">                   <span class="attr">outputPath</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">               	&#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">           &#123;</span><br><span class="line">             <span class="attr">test</span>: <span class="regexp">/\\.sass$/</span>,</span><br><span class="line">             <span class="attr">use</span>:\[<span class="string">&#x27;vue-style-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span></span><br><span class="line">             \],</span><br><span class="line">             <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname + <span class="string">&#x27;/src/&#x27;</span>),</span><br><span class="line">             <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">           &#125;,</span><br><span class="line">       \]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="安装-bable"><a href="#安装-bable" class="headerlink" title="安装 bable"></a>安装 bable</h3><p>这里我安装几个常用的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install  babel-loader @babel/core @babel/cli @babel/preset-env -D</span><br><span class="line">npm install  @babel/runtime @babel/plugin-transform-runtime -D</span><br><span class="line">npm install  @babel/plugin-transform-arrow-functions -D</span><br></pre></td></tr></table></figure>
<p>配置 <code>webpack.config.js</code></p>
<blockquote>
<p>同样的和上面一样要把 <code>node_modules</code> 排除</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">   <span class="attr">module</span>: &#123;</span><br><span class="line">       <span class="attr">rules</span>: \[</span><br><span class="line"></span><br><span class="line">           &#123;</span><br><span class="line">               <span class="attr">test</span>: <span class="regexp">/\\.js$/</span>,</span><br><span class="line">               <span class="attr">use</span>: \[</span><br><span class="line">                   <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">               \],</span><br><span class="line">               <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">           &#125;,</span><br><span class="line">       \]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置 <code>babel.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">api</span>) &#123;</span><br><span class="line">    api.<span class="title function_">cache</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> presets = \[</span><br><span class="line">        <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">    \];</span><br><span class="line">    <span class="keyword">const</span> plugins = \[</span><br><span class="line">        <span class="string">&#x27;@babel/plugin-transform-arrow-functions&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span></span><br><span class="line">    \];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      presets,</span><br><span class="line">      plugins</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最后我们就可以通过 <code>npm run serve</code>来启动<code>vue</code>项目了</p>
<h2 id="往期精彩："><a href="#往期精彩：" class="headerlink" title="往期精彩："></a>往期精彩：</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7015476516196712462" title="https://juejin.cn/post/7015476516196712462">快速入手 Electron，拥有一个自己的桌面应用</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7006518993385160711" title="https://juejin.cn/post/7006518993385160711">还不会 Vue3？一篇笔记带你快速入门</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6999440503712251935" title="https://juejin.cn/post/6999440503712251935">还不会 TS？ 带你 TypeScript 快速入门</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6994337441314242590" title="https://juejin.cn/post/6994337441314242590">快速上手 Vuex 到 手写简易 Vuex</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6990582632270528525" title="https://juejin.cn/post/6990582632270528525">从了解到深入虚拟 DOM 和实现 diff 算法</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6989106100582744072" title="https://juejin.cn/post/6989106100582744072">手写一个简易 vue 响应式带你了解响应式原理</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6988316779818778631" title="https://juejin.cn/post/6988316779818778631">从使用到自己实现简单 Vue Router 看这个就行了</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6983934602196811789" title="https://juejin.cn/post/6983934602196811789">前端面试必不可少的基础知识，虽然少但是你不能不知道</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/10/05/09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/10/05/09/" class="post-title-link" itemprop="url">快速入手Electron 拥有一个自己的桌面应用</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-05 08:01:09" itemprop="dateCreated datePublished" datetime="2021-10-05T08:01:09+08:00">2021-10-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="快速入手Electron，拥有一个自己的桌面应用在这里小浪会简单介绍Elctron的一些基本使用，和如何快速用Eletr"><a href="#快速入手Electron，拥有一个自己的桌面应用在这里小浪会简单介绍Elctron的一些基本使用，和如何快速用Eletr" class="headerlink" title="快速入手Electron，拥有一个自己的桌面应用在这里小浪会简单介绍Elctron的一些基本使用，和如何快速用Eletr"></a>快速入手Electron，拥有一个自己的桌面应用在这里小浪会简单介绍Elctron的一些基本使用，和如何快速用Eletr</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7015476516196712462">https://juejin.cn/post/7015476516196712462</a></p>
<blockquote>
<p>前言</p>
</blockquote>
<p>小浪学习<code>electron</code>的原因是软件构造课需要交一个软件作业，不想用<code>java</code>写，还不能是网页，一开始想到的是用<code>uniapp</code>写个项目打包成<code>APP</code>，然后想了想，一直听说 <code>electron</code> 可以把前端页面(<code>原生</code>/<code>h5</code>/<code>vue</code>/<code>react</code>…)打包成桌面应用，把前端页面当做<code>GUI</code>这岂不是很<code>Nice</code>,<code>Typora</code> 就是 <code>electron</code> 做的，很好奇，就去学学看，下面是小浪学习 <code>electron</code> 的笔记，希望能给大家一点帮助，学习 <code>electron</code> 教程好像很多，但是还是官方文档比较清晰全面，有可能你在视频教程里看见的能使用的，自己去敲的时候发现各种问题，还以为是自己哪里拼错了，一看是官方文档更新了…</p>
<h2 id="1-基础使用"><a href="#1-基础使用" class="headerlink" title="1.基础使用"></a>1.基础使用</h2><p>要想弄个桌面端的应用，那我们得快速的去了解它</p>
<h3 id="1-1终端乱码问题"><a href="#1-1终端乱码问题" class="headerlink" title="1.1终端乱码问题"></a>1.1终端乱码问题</h3><blockquote>
<p><code>tip</code>: electron 控制打印会出现中文乱码</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/415ede9a1d404238b155cab94420d9f7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211004134055911"></p>
<p>只需要在终端（<code>cmd</code>）输入 <code>chcp 65001</code> 运行下就行了</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1cc9e6036f4949e5becdd4c2bec3badb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211004134132071"></p>
<h3 id="1-2安装"><a href="#1-2安装" class="headerlink" title="1.2安装"></a>1.2安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 如果没有node 的话先装 node</span><br><span class="line">http://nodejs.cn/download/</span><br><span class="line"></span><br><span class="line">// 在当前目录安装最新</span><br><span class="line">npm i -D electron</span><br><span class="line"></span><br><span class="line">// 全局安装最新</span><br><span class="line">cnpm install electron -g</span><br><span class="line"></span><br><span class="line">// 当然你可以指定版本号安装</span><br><span class="line">npm i -D electron@11.0.4</span><br></pre></td></tr></table></figure>
<p><code>node -v``electron -v</code>查看是否安装成功</p>
<h3 id="1-3快速创建"><a href="#1-3快速创建" class="headerlink" title="1.3快速创建"></a>1.3快速创建</h3><blockquote>
<p>开始创建一个 electron</p>
</blockquote>
<ul>
<li>首先说下目录必须包括：<code>package.json</code> 这个文件</li>
<li>然后要有个入口文件下面这个例子我用 <code>index.js</code>举例，不过一般写成 <code>main.js</code>比较好</li>
<li>起码你需要个展示的GUI界面，一般是前端页面，也可以直接放个网址</li>
</ul>
<p>新建一个目录(项目):</p>
<p>初始化<code>package.json</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>描述记得写，这个<code>electron</code> 打包的时候我记得需要描述</p>
<p>启动命令写 <code>&quot;test&quot;: &quot;nodemon --watch index.js --exec electron .&quot;</code> ，这样子最后在终端输入 <code>npm test</code>这样每次修改<code>index.js</code> 主进程文件都会重新启动项目了，<code>index.js</code>可以自行修改 <code>main.js</code>等等</p>
<p>来看看最后的的 <code>package.json</code>文件吧</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;electron_demo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;\\&quot;</span>这是一个electron demo\\<span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;nodemon --watch index.js --exec electron .&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我的目录下放了以下几个文件</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c71f4ff2f1af4b369da5a8faf9ca4aaa~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211002115657083"></p>
<p><code>electron</code> 分为两个进程 <strong>主进程</strong> 和 <strong>渲染进程</strong></p>
<blockquote>
<p><code>index.js</code> 这个文件是 <strong>主进程</strong></p>
</blockquote>
<p>官方是这样写的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createWindow</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  win.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(createWindow)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">quit</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="title function_">createWindow</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我看其他人差不多是这样写的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attr">resizable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">icon</span>: iconPath,</span><br><span class="line">    <span class="attr">minWidth</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">minHeight</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">maxWidth</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">maxHeight</span>: <span class="number">600</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">webPreferences</span>:&#123;</span><br><span class="line">      <span class="attr">backgroundThrottling</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">nodeIntegration</span>:<span class="literal">true</span>,</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">on</span>(<span class="string">&#x27;closed&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">      win = <span class="literal">null</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;窗口全部都关闭了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>index.html</code>是<strong>渲染进程</strong>也就是前端页面里面随便写点东西，这里相当是把前端当成 GUI 了</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>electron test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    electron demo</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样使用 <code>npm test</code> 就可以出来这么一个界面了，<code>test</code>这个命令 是 <code>package.json``script</code> 中配的</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72537c1239d349bd96e785df06c7364f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211003211108491"></p>
<h2 id="2-Remote-模块"><a href="#2-Remote-模块" class="headerlink" title="2.Remote 模块"></a>2.Remote 模块</h2><p>在渲染进程里（比如<code>index.html</code>里面加载了一些<strong>js文件</strong>，那里面的<strong>js</strong>如果要使用到 <strong>BrowserWindow</strong> 这些属性的话就必须使用 <code>remote</code>）</p>
<p>使用 <code>remote</code> 模块, 你可以调用 <code>main</code><strong>进程对象的方法</strong></p>
<h3 id="2-1-electron14-0之前版本使用"><a href="#2-1-electron14-0之前版本使用" class="headerlink" title="2.1.electron14.0之前版本使用"></a>2.1.<strong>electron14.0</strong>之前版本使用</h3><blockquote>
<p>在主进程的窗口中加入<code>enableRemoteModule: true</code>参数才能够调用remote模块</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">enableRemoteModule</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    win = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;窗口全部都关闭了&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后在渲染进程里写，这里我直接内嵌js了</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>electron test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    electron demo</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>添加新的窗口<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; log &#125; = <span class="variable language_">console</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>).<span class="property">remote</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      btn.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> newWin = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">width</span>: <span class="number">800</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">height</span>: <span class="number">600</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        win.<span class="title function_">loadFile</span>(<span class="string">&#x27;index2.html&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        newWin.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          newWin = <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里点击按钮，就又可以创建一个新的窗口了</p>
<h3 id="2-2-electron14-0版本API修改"><a href="#2-2-electron14-0版本API修改" class="headerlink" title="2.2.electron14.0版本API修改"></a>2.2.<strong>electron14.0</strong>版本API修改</h3><blockquote>
<p>但是这里是有版本的区分的，这里一开始也困扰了我很久很久…最后看了下文档<code>14.0</code>后 改了，我用的<code>15</code>。。。</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12832ff7f85c4ab89c34aaeebed3132f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211003215043335"></p>
<blockquote>
<p>1.还得自行安装 <code>remote</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @electron/remote</span><br></pre></td></tr></table></figure>
<blockquote>
<p>2.主进程中导入</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="built_in">require</span>(<span class="string">&#x27;@electron/remote/main&#x27;</span>).<span class="title function_">initialize</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3.渲染进程中</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@electron/remote&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="3-创建系统菜单"><a href="#3-创建系统菜单" class="headerlink" title="3.创建系统菜单"></a>3.创建系统菜单</h2><blockquote>
<p>1.新建一个 menu.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Menu</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = \[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;菜单一&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">submenu</span>: \[</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">label</span>: <span class="string">&#x27;子菜单一&#x27;</span> ,</span><br><span class="line"></span><br><span class="line">          <span class="attr">accelerator</span>: <span class="string">&#x27;ctrl+n&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单二&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单三&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单四&#x27;</span> &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;菜单二&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">submenu</span>: \[</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单一&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单二&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单三&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单四&#x27;</span> &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">\]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myMenu = <span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Menu</span>.<span class="title function_">setApplicationMenu</span>(myMenu)</span><br></pre></td></tr></table></figure>
<p><code>accelerator: &#39;ctrl+n&#39;</code>可以指定菜单的快捷键</p>
<blockquote>
<p>2.随便写个页面</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>自定义菜单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    自定义菜单</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>3.写 main.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> win = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./menu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  win.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>()</span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&#x27;./index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    win = <span class="literal">null</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>npm test启动</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ab8963721d54f73a508a93088ef71f6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="46"></p>
<h2 id="4-给菜单添加事件"><a href="#4-给菜单添加事件" class="headerlink" title="4.给菜单添加事件"></a>4.给菜单添加事件</h2><blockquote>
<p>比如给子菜单添加一个点击事件新建一个窗口</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Menu</span>, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = \[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;菜单一&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">submenu</span>: \[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&#x27;子菜单一&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> sonWin = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">            <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="number">200</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">          sonWin.<span class="title function_">loadFile</span>(<span class="string">&#x27;./index2.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">          sonWin.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            sonWin = <span class="literal">null</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单二&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单三&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单四&#x27;</span> &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;菜单二&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">submenu</span>: \[</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单一&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单二&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单三&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">label</span>: <span class="string">&#x27;子菜单四&#x27;</span> &#125;,</span><br><span class="line">    \],</span><br><span class="line">  &#125;,</span><br><span class="line">\]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myMenu = <span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Menu</span>.<span class="title function_">setApplicationMenu</span>(myMenu)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>效果图</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68fdf9ed39c0403188c1193c1021b9b5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="47"></p>
<blockquote>
<p>上面的的开发者工具和<strong>chrome/edge浏览器</strong>一样，在菜单栏的<code>View -&gt; Toggle Developer Tools</code>，或者 <code>Ctrl + Shift + I</code>就能调用出来，用来调试页面</p>
</blockquote>
<h2 id="5-使用Node-js-模块-API"><a href="#5-使用Node-js-模块-API" class="headerlink" title="5.使用Node.js 模块/API"></a>5.使用Node.js 模块/API</h2><p>比如写个<strong>读写文件</strong>例子</p>
<p>在主线程创建窗口的时候 <code>webPreferences</code>一定在加上 <code>nodeIntegration: true</code>，<code>contextIsolation: false</code></p>
<p>这样在渲染进程才能使用<code>node</code> 的一些语法</p>
<blockquote>
<p>main.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  mainWindow.<span class="title function_">loadFile</span>(<span class="string">&#x27;./main.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  mainWindow.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    mainWindow = <span class="literal">null</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>main.html 主要的渲染文件</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>读写文件测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;readFile()&quot;</span>&gt;</span>读取文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;writeFile()&quot;</span>&gt;</span>写入文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;show\_file\_content&quot;</span>&gt;</span>页面内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>index.js 加载需要的js</p>
</blockquote>
<p>可以看出，在渲染进程中，就是<code>main.html</code> 里面加载的 <code>index.js</code> 中，既可以使用 <code>docment.getElementById</code> 这些 <code>WebAPI</code>,又能使用用 <code>node</code> 的模块进行混写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; log &#125; = <span class="variable language_">console</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> showContent = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;show\_file\_content&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取文件&#x27;</span>)</span><br><span class="line">  fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/test.txt&#x27;</span>), <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(err, <span class="string">&#x27;读取文件失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    showContent.<span class="property">innerText</span> = data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = <span class="string">&#x27;今天是国庆的第二天，在学 electron&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">writeFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  fs.<span class="title function_">writeFile</span>(</span><br><span class="line">    path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/test.txt&#x27;</span>),</span><br><span class="line">    content,</span><br><span class="line">    <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(err, <span class="string">&#x27;读取文件失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">log</span>(<span class="string">&#x27;写入文件成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试用的 txt</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">今天是国庆的第二天，在学 electron</span><br></pre></td></tr></table></figure>
<blockquote>
<p>项目的目录</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/261e3ccd1caf4d26847e861205d73278~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211002155537033"></p>
<blockquote>
<p>效果图</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e392606cde154267aed6ff0c08c57c09~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="45"></p>
<h2 id="6-设置无边框"><a href="#6-设置无边框" class="headerlink" title="6.设置无边框"></a>6.设置无边框</h2><blockquote>
<p>在创建窗口的时候 可以设置无边框，带的菜单也消失了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">frame</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>菜单其实它还在，你仍然可以通过快捷键调用出菜单，可以直接删除菜单<code>win.removeMenu()</code></p>
<blockquote>
<p>没有菜单栏怎么去拖拽窗口</p>
</blockquote>
<p>在css中你可以设置哪个可以进行拖拽/禁止拖拽</p>
<p>比如 <code>body&#123; -webkit-app-region: drag | no-drag;&#125;</code></p>
<blockquote>
<p>效果图：无边框，在<code>body</code>设置可拖拽</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76910042f01a4848abb0948cdc20a828~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="44"></p>
<h2 id="7-系统托盘"><a href="#7-系统托盘" class="headerlink" title="7.系统托盘"></a>7.系统托盘</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7b3e10d88f54101a7889b42f01d5aa6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211004102538924"></p>
<p>看到上面这个图大家都应该清楚吧，当我们关闭一个应用程序的时候，它其实关闭了，但是没有完全关闭，只是隐藏了，有的就存在系统托盘中，那么如何在<code>electron</code> 设置系统托盘呢</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.electronjs.org%2Fdocs%2Ftutorial%2Ftray" title="https://www.electronjs.org/docs/tutorial/tray">官方文档：Tray</a></p>
<blockquote>
<p>主进程 index.js</p>
</blockquote>
<p>在<code>electron</code> 这里一开始我就添加系统托盘，当然你可以监听窗口被关闭的时候在创建托盘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span>, <span class="title class_">Tray</span>, <span class="title class_">Menu</span>, nativeImage &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win, tray</span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> icon = nativeImage.<span class="title function_">createFromPath</span>(</span><br><span class="line">    path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;/static/icon.png&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  tray = <span class="keyword">new</span> <span class="title class_">Tray</span>(icon)</span><br><span class="line"></span><br><span class="line">  tray.<span class="title function_">setToolTip</span>(<span class="string">&#x27;electron demo is running&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  tray.<span class="title function_">setTitle</span>(<span class="string">&#x27;electron demo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  tray.<span class="title function_">on</span>(<span class="string">&#x27;right-click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> tempate = \[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&#x27;无操作&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&#x27;退出&#x27;</span>,</span><br><span class="line">        <span class="attr">click</span>: <span class="function">() =&gt;</span> app.<span class="title function_">quit</span>(),</span><br><span class="line">      &#125;,</span><br><span class="line">    \]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> menuConfig = <span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>(tempate)</span><br><span class="line"></span><br><span class="line">    tray.<span class="title function_">popUpContextMenu</span>(menuConfig)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  tray.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (win.<span class="title function_">isVisible</span>()) &#123;</span><br><span class="line">      win.<span class="title function_">hide</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      win.<span class="title function_">show</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  win = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;窗口全部都关闭了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>效果图</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7baeb0d2309f4c38bb107a22a3690f49~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="48"></p>
<h2 id="8-进程间通信"><a href="#8-进程间通信" class="headerlink" title="8.进程间通信"></a>8.进程间通信</h2><p><code>electron</code>中主进程和渲染进程两者之间需要通信</p>
<blockquote>
<p>官方文档：</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.electronjs.org%2Fdocs%2Fapi%2Fipc-main" title="https://www.electronjs.org/docs/api/ipc-main">ipcMain</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.electronjs.org%2Fdocs%2Fapi%2Fipc-renderer" title="https://www.electronjs.org/docs/api/ipc-renderer">ipcRenderer</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.electronjs.org%2Fdocs%2Fapi%2Fweb-contents%23contentssendchannel-args" title="https://www.electronjs.org/docs/api/web-contents#contentssendchannel-args">webContents</a></p>
</blockquote>
<p><strong>主线程</strong> 到 <strong>渲染线程</strong> 通过 <code>webContents.send</code> 来发送 —-&gt;<code>ipcRenderer.on</code> 来监听</p>
<p><strong>渲染线程</strong> 到 <strong>主线程</strong> 需要通过 <code>ipcRenderer.send</code>发送 —-> <code>ipcMain.on</code>来监听</p>
<h3 id="8-1-主进程到渲染进程"><a href="#8-1-主进程到渲染进程" class="headerlink" title="8.1.主进程到渲染进程"></a>8.1.主进程到渲染进程</h3><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.electronjs.org%2Fdocs%2Fapi%2Fweb-contents%23contentssendchannel-args" title="https://www.electronjs.org/docs/api/web-contents#contentssendchannel-args"><code>webContents.send(channel, ...args)</code></a></p>
<ul>
<li><code>channel</code> String</li>
<li><code>...args</code> any[]</li>
</ul>
<blockquote>
<p>主进程 <code>mian.js</code></p>
</blockquote>
<p>在主进程中使用 <code>webContents.send</code> 发送消息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">enableRemoteModule</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    win.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&#x27;mainMsg&#x27;</span>, <span class="string">&#x27;我是主线程发送的消息&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">  win.<span class="title function_">loadFile</span>(<span class="string">&#x27;main.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  win = <span class="literal">null</span></span><br><span class="line">  app.<span class="title function_">quit</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;窗口全部都关闭了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>渲染进程 <code>main.html</code> 外链一个 <code>render.js</code></p>
</blockquote>
<p>在渲染线程中使用 <code>ipcRenderer.on</code>来进行监听</p>
<p><code>ipcRenderer.on(channel, listener)</code></p>
<ul>
<li><code>channel</code> String</li>
<li><code>listener</code> Function</li>
</ul>
<p>监听 <code>channel</code>, 当有新消息到达，使用 <code>listener(event, args...)</code> 调用 <code>listener</code> .</p>
<p>还有个监听一次的消息<code>ipcRenderer.once(channel, listener)</code></p>
<p>为这个事件添加一个一次性 <code>listener</code> 函数.这个 <code>listener</code> 将在下一次有新消息被发送到 <code>channel</code> 的时候被请求调用，之后就被删除了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>通信测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    通信测试</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;receive&quot;</span>&gt;</span>接收信息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./render.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; ipcRenderer &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; log &#125; = <span class="variable language_">console</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">log</span>(ipcRenderer)</span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&#x27;mainMsg&#x27;</span>, <span class="function">(<span class="params">event, task</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">log</span>(task)</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;receive&#x27;</span>).<span class="property">innerText</span> = task</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>效果图</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/087129ad564a42d8b54b1d1785710231~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="49"></p>
<h3 id="8-2-渲染进程到主进程"><a href="#8-2-渲染进程到主进程" class="headerlink" title="8.2.渲染进程到主进程"></a>8.2.渲染进程到主进程</h3><blockquote>
<p><code>render.js</code> 渲染线程中进行发送 <code>ipcRenderer.send</code></p>
</blockquote>
<p><code>ipcRenderer.send(channel\[, arg1\]\[, arg2\]\[, ...\])</code></p>
<ul>
<li><code>channel</code> String</li>
<li><code>arg</code> (可选)</li>
</ul>
<p>还有发送同步消息的<code>ipcRenderer.sendSync(channel\[, arg1\]\[, arg2\]\[, ...\])</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>通信测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    通信测试</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;receive&quot;</span>&gt;</span>接收信息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMain()&quot;</span>&gt;</span>发送消息给主线程<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./render.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; ipcRenderer &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendMain</span>(<span class="params"></span>) &#123;</span><br><span class="line">  ipcRenderer.<span class="title function_">send</span>(<span class="string">&#x27;task&#x27;</span>, <span class="string">&#x27;退出程序&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>main.js</code> 主进程里面 <code>ipcMain.on</code> 进行监听，这里退出程序</p>
</blockquote>
<p><code>ipcMain.on(channel, listener)</code></p>
<ul>
<li><code>channel</code> String</li>
<li><code>listener</code> Function</li>
</ul>
<p>监听 <code>channel</code>, 当新消息到达，将通过 <code>listener(event, args...)</code> 调用 <code>listener</code>.</p>
<p>还有个 <code>ipcMain.once(channel, listener)</code>为事件添加一个一次性用的<code>listener</code> 函数.这个 <code>listener</code> 只有在下次的消息到达 <code>channel</code> 时被请求调用，之后就被删除了.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span>, ipcMain &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ipcMain.<span class="title function_">on</span>(<span class="string">&#x27;task&#x27;</span>, <span class="function">(<span class="params">event, info</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (info === <span class="string">&#x27;退出程序&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">quit</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>效果图</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/22c4401cffd7415ba5a167dc9778bd48~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="50"></p>
<p>这样就方便里我做一些窗口交互，比如<code>todoList</code>,到时间了右下角弹出一个新的窗口进行提醒</p>
<h3 id="8-3渲染进程到渲染进程"><a href="#8-3渲染进程到渲染进程" class="headerlink" title="8.3渲染进程到渲染进程"></a>8.3渲染进程到渲染进程</h3><p><code>ipcRenderer.sendTo(webContentsId, channel, ...args)</code></p>
<ul>
<li><code>webContentsId</code> Number</li>
<li><code>channel</code> String</li>
<li><code>...args</code> any[]</li>
</ul>
<p>通过 <code>channel</code> 发送消息到带有 <code>webContentsId</code> 的窗口.</p>
<p>前提是要知道对应的渲染进程的<code>ID</code></p>
<p>当然也可以让主进程作为中转站，先发到主进程在到其他的渲染进程</p>
<h2 id="9-Vue-Electron"><a href="#9-Vue-Electron" class="headerlink" title="9.Vue + Electron"></a>9.Vue + Electron</h2><p>那么 <code>Vue</code> 怎么使用 <code>Electron</code> 打包呢？毕竟学习这个初衷，就是把 <code>Vue</code> 项目变成一个桌面应用，前面讲的都是原生的方法，那么继续往下面看吧</p>
<h3 id="9-1你需要有个Vue项目"><a href="#9-1你需要有个Vue项目" class="headerlink" title="9.1你需要有个Vue项目"></a>9.1你需要有个Vue项目</h3><p>如果手上没有，那么用 <code>vue ui</code> 创建一个<code>Vue</code>项目/或者直接在命令行里用 <code>vue create</code> 创建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue ui</span><br></pre></td></tr></table></figure>
<p>相信大家都会，这里我就是简单用<code>vue ui</code>的建一个，这里大家可以略过</p>
<p>默认打开一个8000端口的服务，一个可视化的UI界面就出来了</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2e6923ef74c4f6ea63a1242f4666123~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005094817591"></p>
<blockquote>
<p>选择左下角 更多—-&gt;项目管理器</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76c99d4115fc4fa59562e91cb4f75002~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005095048918"></p>
<blockquote>
<p>创建</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/afac3ffe606b4b46aa755acfaa838f9c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005095255377"></p>
<blockquote>
<p>选择好目录后在此创建</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e5f0460dcf54e77905a256fc9656569~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005095412222"></p>
<blockquote>
<p>填写一些基本信息，包管理我这里用 npm ，然后下一步</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90b600e4a09446b6996e52bf2d466ccb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005095517636"></p>
<blockquote>
<p>选择预设，我这里选手动</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f993f6435df4dc1acfbaba2a455f9b9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005095738225"></p>
<blockquote>
<p>需要哪些插件选哪些，我这里就默认了，因为是个简单的例子</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ccff58b126f4525bc3aedae85b20d37~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005095856488"></p>
<blockquote>
<p>选择 Vue 的版本2.x 还是 3这些按照你的习惯来，平时写什么选什么,下面的选项我选择的标准</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2c5865a163f451697b9b683f23e7c02~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005100020344"></p>
<blockquote>
<p>创建项目</p>
</blockquote>
<p>我这里就不保存预设了，然后就是漫长的等待<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e1fba4cee344604850def265dbb9951~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005100221788"></p>
<blockquote>
<p>创建完毕后运行改项目</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0711e3fde3644d1689b574ac2e353d5f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005102004448"></p>
<blockquote>
<p>启动项目</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36896a3101db45069c8dbd833f950a0a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005102132311"></p>
<p>就会得到一个这样的默认页面</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33574a90ca55482faca8c36cffbb22fb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005102159772"></p>
<p>好了创建项目完毕，继续</p>
<h3 id="9-2添加-electron-插件"><a href="#9-2添加-electron-插件" class="headerlink" title="9.2添加 electron 插件"></a>9.2添加 <code>electron</code> 插件</h3><blockquote>
<p>在插件—&gt;添加插件 搜索 <code>vue-cli-plugin-electron-builder</code>,安装第一个</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ef4ce8185e84d56b9e7378bf43633aa~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005102527050"></p>
<blockquote>
<p>我这里默认选择electorn 13.0.0版本</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0273671757f4d6285f2780955188d7a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005102834003"></p>
<blockquote>
<p>安装完成后会出现在已安装插件里面</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98682a2056cd495abd173a697421790b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005103108921"></p>
<p>当然也可以在 命令行中进行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue add electron-builder</span><br></pre></td></tr></table></figure>
<h3 id="9-3运行"><a href="#9-3运行" class="headerlink" title="9.3运行"></a>9.3运行</h3><blockquote>
<p>在当前vue项目下的命令行输入下面的命令运行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run electron:serve</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d5fc62b8e1b40eda84c32e1bd3c2080~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005103731994"></p>
<p>很好，已经运行出来了</p>
<h3 id="9-4-package-json-background-js"><a href="#9-4-package-json-background-js" class="headerlink" title="9.4 package.json``background.js"></a>9.4 <code>package.json``background.js</code></h3><p>查看<code>package.json</code>文件找找主进程文件在哪</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a9c7dd81b6f458bb0e26835c0c9c2b4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005104023792"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33301c3825a44c6a81a1dfde40a3ad0f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005104135614"></p>
<blockquote>
<p>主进程文件是 <code>background.js</code>，这个文件在 <code>Vue项目/src/下面</code></p>
</blockquote>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; app, protocol, <span class="title class_">BrowserWindow</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createProtocol &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class="line"><span class="keyword">import</span> installExtension, &#123; <span class="variable constant_">VUEJS_DEVTOOLS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;electron-devtools-installer&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isDevelopment = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">protocol.<span class="title function_">registerSchemesAsPrivileged</span>(\[</span><br><span class="line">  &#123; <span class="attr">scheme</span>: <span class="string">&#x27;app&#x27;</span>, <span class="attr">privileges</span>: &#123; <span class="attr">secure</span>: <span class="literal">true</span>, <span class="attr">standard</span>: <span class="literal">true</span> &#125; &#125;</span><br><span class="line">\])</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createWindow</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="attr">nodeIntegration</span>: process.<span class="property">env</span>.<span class="property">ELECTRON</span>\_NODE\_INTEGRATION,</span><br><span class="line">      <span class="attr">contextIsolation</span>: !process.<span class="property">env</span>.<span class="property">ELECTRON</span>\_NODE\_INTEGRATION</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">WEBPACK</span>\_DEV\_SERVER_URL) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> win.<span class="title function_">loadURL</span>(process.<span class="property">env</span>.<span class="property">WEBPACK</span>\_DEV\_SERVER_URL)</span><br><span class="line">    <span class="keyword">if</span> (!process.<span class="property">env</span>.<span class="property">IS_TEST</span>) win.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">createProtocol</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    win.<span class="title function_">loadURL</span>(<span class="string">&#x27;app://./index.html&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">quit</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isDevelopment &amp;&amp; !process.<span class="property">env</span>.<span class="property">IS_TEST</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">installExtension</span>(<span class="variable constant_">VUEJS_DEVTOOLS</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class="title function_">toString</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createWindow</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isDevelopment) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> === <span class="string">&#x27;win32&#x27;</span>) &#123;</span><br><span class="line">    process.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data === <span class="string">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class="line">        app.<span class="title function_">quit</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    process.<span class="title function_">on</span>(<span class="string">&#x27;SIGTERM&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      app.<span class="title function_">quit</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到上面的主进程文件是不是很熟悉，你可以像以前一样做一些操作，使用node混写完成一些功能</p>
<h3 id="9-5打包"><a href="#9-5打包" class="headerlink" title="9.5打包"></a>9.5打包</h3><p>上面我们只是运行出来了，上交的软件，老师总不会还特意去配环境，然后<code>npm run electron:serve</code>吧，显然是不可能的，那我们继续进行打包成一个可执行的文件exe</p>
<p>命令行执行下面的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run electron:build</span><br></pre></td></tr></table></figure>
<h4 id="打包出现的问题"><a href="#打包出现的问题" class="headerlink" title="打包出现的问题"></a>打包出现的问题</h4><blockquote>
<p>我在打包的时候特别不顺利… 查来查去原来<code>electron</code> 是有问题</p>
</blockquote>
<p>我给出的建议就是 把<code>node_modules</code>目录下的 <strong>electron 删除</strong></p>
<p>用<code>cnpm</code> 安装 <code>electron</code></p>
<p>如果没有 <code>cnpm</code> 先进行安装</p>
<blockquote>
<p>全局安装<code>cnpm</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">cnpm -v</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重新安装 <code>electron</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i electron</span><br></pre></td></tr></table></figure>
<blockquote>
<p>打包</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run <span class="attr">electron</span>:build</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7678cbda1804561935ae8ef6de76dcc~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005131543735"></p>
<p>打包完成，打包的文件就放在项目下的 <code>dist_electron</code> 里面</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/724e565bb55544f2875b79dcf918c8f2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005131647326"></p>
<h3 id="9-6安装"><a href="#9-6安装" class="headerlink" title="9.6安装"></a>9.6安装</h3><blockquote>
<p>双击就自动安装了</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e0725f12ac14e968284a61308834a68~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005131805110"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c6ffdb7f54c428fb7bd774222edee60~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005131940327"></p>
<p>桌面上就出现这么一个应用图标</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47def2592a1543b0901f34313dc75466~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005132041458"></p>
<h3 id="9-7自定义"><a href="#9-7自定义" class="headerlink" title="9.7自定义"></a>9.7自定义</h3><p>点进去查看没有问题，但是是不是太low 了，一点击就是自动安装，而且使用的默认图标</p>
<blockquote>
<p>安装打包工具</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i electron-builder --D</span><br></pre></td></tr></table></figure>
<h4 id="9-7-1-首先找一个-icon-图片"><a href="#9-7-1-首先找一个-icon-图片" class="headerlink" title="9.7.1.首先找一个 icon 图片"></a>9.7.1.首先找一个 <code>icon</code> 图片</h4><p>好像有插件可以把图片转为各种大小的<code>icon</code></p>
<p>安装下，这样就不用网站上转图片了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i electron-icon-builder</span><br></pre></td></tr></table></figure>
<p>需要在<code>package.json</code>中<code>scripts</code>添加<code>build-icon</code>指令</p>
<p><code>longzhu.jpg</code> 这个图片自己找的 卡卡罗特 可以自行修改</p>
<p><code>output</code> 是输出文件夹</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build-icon&quot;</span>: <span class="string">&quot;electron-icon-builder --input=./public/longzhu.jpg --output=build --flatten&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>命令行输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build-icon</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ceecc86d39184d8c8d1703b4bfbe28a8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005141605242"></p>
<p>build完成之后，生成了不同大小的图片</p>
<h4 id="9-7-2-vue-config-js"><a href="#9-7-2-vue-config-js" class="headerlink" title="9.7.2.vue.config.js"></a>9.7.2.vue.config.js</h4><p>因为我们之前安装的插件是 <code>vue-cli-plugin-electron-builder</code> ，而不是<code>electron-builder</code></p>
<p><code>electron-builder</code>打包普通项目，<code>build</code> 配置直接在<code>package.json</code> 里面写</p>
<p><code>vue-cli-plugin-electron-builder</code>的 <code>build</code> 配置是需要在 项目根目录下 <code>vue.config.js</code> 里面配置</p>
<p>如果没有请新建</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="attr">electronBuilder</span>: &#123;</span><br><span class="line">      <span class="attr">builderOptions</span>: &#123;</span><br><span class="line">        <span class="attr">appId</span>: <span class="string">&quot;com.test.app&quot;</span>,</span><br><span class="line">        <span class="attr">productName</span>: <span class="string">&quot;Lang&quot;</span>,</span><br><span class="line">        <span class="attr">copyright</span>: <span class="string">&quot;Copyright © 2021&quot;</span>,</span><br><span class="line">        <span class="attr">directories</span>: &#123;</span><br><span class="line">          <span class="attr">output</span>: <span class="string">&quot;./dist&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">win</span>: &#123;</span><br><span class="line"></span><br><span class="line">          <span class="attr">icon</span>: <span class="string">&quot;./build/icons/icon.ico&quot;</span>,</span><br><span class="line">          <span class="attr">target</span>: \[</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">target</span>: <span class="string">&quot;nsis&quot;</span>,</span><br><span class="line">              <span class="attr">arch</span>: \[</span><br><span class="line">                <span class="string">&quot;x64&quot;</span>,</span><br><span class="line">                <span class="string">&quot;ia32&quot;</span></span><br><span class="line">              \]</span><br><span class="line">            &#125;</span><br><span class="line">          \]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">nsis</span>: &#123;</span><br><span class="line">          <span class="attr">oneClick</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">language</span>: <span class="string">&quot;2052&quot;</span>,</span><br><span class="line">          <span class="attr">perMachine</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">allowToChangeInstallationDirectory</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="9-7-3-执行打包"><a href="#9-7-3-执行打包" class="headerlink" title="9.7.3.执行打包"></a>9.7.3.执行打包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run electron:build</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41fdf3c10fae49f8afccb04c8ec79a21~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005143529020"></p>
<p>OK，打包成功！</p>
<p><strong>可能遇到的问题</strong></p>
<p>打包的路上不是一帆风顺的，在这一步打包失败了，因为打包的时候去下载一些依赖，然后下载失败了</p>
<p>解决方法1：梯子</p>
<p>解决方法2： <a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fwm9028%2Farticle%2Fdetails%2F114583011" title="https://blog.csdn.net/wm9028/article/details/114583011">可以参考这个</a></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25942115043b41e1ab4d86fbd36b72ef~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005143747806"></p>
<blockquote>
<p>打包好的东西</p>
</blockquote>
<p>打包好的东西放在我们之前配置的<code>build``output: &quot;./dist&quot;</code> //输出文件路径</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ac1db1992be43e2982b9ef0292e8189~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005144321420"></p>
<p>可以看出图标变了</p>
<p><img src="https://juejin.cn/post/%E5%B0%8F%E6%B5%AA%E5%AD%A6%E4%B9%A0Electron.assets/image-20211005144400797.png" alt="image-20211005144400797"></p>
<p>我们可以自定义安装文件夹了</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7e48cb6089941d4931870360c333b94~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005144559596"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4e56d80bc164586b8379113709c42cd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20211005144749686"></p>
<p>好了，基础的打包工作就这么结束了，大家可以自己写属于自己的软件，这里只是一个简单的应用教学</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><code>Electron</code> 真的不错诶，建议大家学习的时候多看看官方的文档，虽然官方文档还有很多地方没有翻译完整，但是并不影响我们去学习他的热情，感觉版本迭代很快，官方文档显得又多又乱，大家可以在文档上面搜索</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.electronjs.org%2Fdocs" title="https://www.electronjs.org/docs">Electron官方文档</a></p>
<blockquote>
<p>往期精彩</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7006518993385160711" title="https://juejin.cn/post/7006518993385160711">还不会Vue3？一篇笔记带你快速入门</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6999440503712251935" title="https://juejin.cn/post/6999440503712251935">还不会TS？ 带你 TypeScript 快速入门</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6994337441314242590" title="https://juejin.cn/post/6994337441314242590">快速上手Vuex 到 手写简易 Vuex</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6990582632270528525" title="https://juejin.cn/post/6990582632270528525">从了解到深入虚拟DOM和实现diff算法</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6989106100582744072" title="https://juejin.cn/post/6989106100582744072">手写一个简易vue响应式带你了解响应式原理</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6988316779818778631" title="https://juejin.cn/post/6988316779818778631">从使用到自己实现简单Vue Router看这个就行了</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6983934602196811789" title="https://juejin.cn/post/6983934602196811789">前端面试必不可少的基础知识，虽然少但是你不能不知道</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/09/11/12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/09/11/12/" class="post-title-link" itemprop="url">还不会Vue3？一篇笔记带你快速入门</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-11 09:11:12" itemprop="dateCreated datePublished" datetime="2021-09-11T09:11:12+08:00">2021-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="还不会Vue3？一篇笔记带你快速入门"><a href="#还不会Vue3？一篇笔记带你快速入门" class="headerlink" title="还不会Vue3？一篇笔记带你快速入门"></a>还不会Vue3？一篇笔记带你快速入门</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7006518993385160711">https://juejin.cn/post/7006518993385160711</a></p>
<blockquote>
<p>前言：</p>
</blockquote>
<p>一直都没有去接触 Vue3，在之前暑假的时间，就趁这个机会去好好的学习一下，这篇文章就是我之前学习 Vue3 做的笔记，做笔记一方面让自己更加理解和掌握新的特性这些知识点，另一方面也希望能让大家入门Vue3，自己学到了才是赚到了，结语注明参考资料</p>
<h2 id="Vue3简介"><a href="#Vue3简介" class="headerlink" title="Vue3简介"></a>Vue3简介</h2><p><strong>面临的问题</strong>：随着功能的增长，复杂组件的代码变得难以维护，<code>Vue3</code> 就随之而来，<code>TypeScript</code> 使用的越来越多，<code>Vue3</code>就是 <code>TS</code> 写的所以能够更好的支持 <code>TypeScript</code></p>
<p>在这里介绍就这么简单</p>
<p><code>vue2</code> 的绝大多数的特性 在 <code>Vue3</code> 都能使用，毕竟 <code>Vue</code> 是渐进式的</p>
<p>响应式原理进行使用 <code>Proxy</code> 实现，<code>v-model</code> 可以传参了等等新特性</p>
<h2 id="基础工作"><a href="#基础工作" class="headerlink" title="基础工作"></a>基础工作</h2><p>使用<code>Vue3</code>的话，那么必须通过使用构建工具创建一个 <code>Vue3</code> 项目</p>
<h3 id="安装-vue-cli"><a href="#安装-vue-cli" class="headerlink" title="安装 vue-cli"></a>安装 vue-cli</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br><span class="line"></span><br><span class="line">yarn global add @vue/cli</span><br></pre></td></tr></table></figure>
<h3 id="创建一个项目"><a href="#创建一个项目" class="headerlink" title="创建一个项目"></a>创建一个项目</h3><p>使用 <code>create</code> 命令行创建 或者 用 <code>ui</code> 可视化创建</p>
<p>大家用 <code>Vue</code> 都用了这么久，我就不一一说怎么去创建了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名</span><br><span class="line"></span><br><span class="line">vue ui</span><br></pre></td></tr></table></figure>
<p>当然也可以选择 <code>vite</code> ，<code>vite</code> 创建的速度比 上面的方法快了一些</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm init vite-app 项目名</span><br><span class="line"><span class="built_in">cd</span> 项目名</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
<h2 id="Vue3入门"><a href="#Vue3入门" class="headerlink" title="Vue3入门"></a>Vue3入门</h2><h3 id="Composition-API"><a href="#Composition-API" class="headerlink" title="Composition API"></a><code>Composition API</code></h3><blockquote>
<p><code>Vue3</code> 提出了 <code>Composition API</code></p>
</blockquote>
<p>在 <strong>Vue2.X</strong> 我们使用的是 <strong>OptionAPI</strong> 里面有我们熟悉的 <code>data</code>、<code>computed</code>、<code>methods</code>、<code>watch</code>…</p>
<p>在 <code>Vue3</code> 中，我们依旧可以使用 <strong>OptionAPI</strong>当然不建议 和 <code>Vue3</code> 混用</p>
<p>在 <code>Vue2</code> 中，我们实现一个功能得分到不同的地方，把数据放在 <code>data</code> ,<code>computed</code> 方法放在 <code>methods</code> 里面，分开的太散乱了，几个功能还好，几十个上百个，那就有点…</p>
<p>所以 <code>Vue3</code> 提出了 <strong>Composition API</strong> ，它可以把 <code>一个逻辑的代码都收集在一起</code> 单独写个<code>hook</code>,然后再引入，这样就不到处分布，显得很乱了</p>
<h3 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a><code>Fragment</code></h3><blockquote>
<p>在 <code>template</code> 中不再需要一个根元素包裹</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;Vue logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">msg</span>=<span class="string">&quot;Welcome to Your Vue.js + TypeScript App&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>实际上内部会将多个标签包含在一个<code>Fragment</code>虚拟元素中</p>
<p>好处: 减少标签层级, 减小内存占用</p>
<h3 id="script-差异"><a href="#script-差异" class="headerlink" title="script 差异"></a><code>script</code> 差异</h3><blockquote>
<p>来看看 <code>script</code> 和 <code>Vue2</code> 的区别</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>可以再 <code>script</code> 使用 <code>ts</code> 只需 设置 <code>lang</code> 即可</li>
<li><code>defineComponent</code> 方法创建一个组件</li>
<li><code>export default</code> 直接导出一个组件</li>
</ul>
<h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a><code>setup</code></h3><blockquote>
<p><code>setup</code> 是 <code>Composition API</code>的入口</p>
</blockquote>
<h4 id="setup-执行顺序"><a href="#setup-执行顺序" class="headerlink" title="setup 执行顺序"></a><code>setup</code> 执行顺序</h4><p>它在<code>beforeCreate</code><strong>之前执行一次</strong>，<code>beforeCreate</code>这个钩子 的任务就是初始化，在它之前执行，那么 <code>this</code> 就没有被初始化 <code>this = undefined</code> 这样就不能通过 <code>this</code> 来调用方法 和 获取属性</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b06890efbd304516b23df723ad9352dd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811132514039"></p>
<h4 id="setup-返回值"><a href="#setup-返回值" class="headerlink" title="setup 返回值"></a><code>setup</code> 返回值</h4><p><code>setup</code> 返回的是一个<strong>对象</strong>，这个对象的属性会与组件中 <code>data</code> 函数返回的对象进行<strong>合并</strong>，返回的方法和 <code>methods</code> 合并，合并之后直接可以在模板中使用，如果有重名的情况，会使用 <code>setup</code> 返回的<strong>属性</strong>和<strong>方法</strong>，<code>methods</code> 和 <code>data</code> 能够拿到 <code>setup</code> 中的方法应该进行了合并，反之 <code>setup</code> 不能拿到它们的属性和方法，因为这个时候 <code>this</code> = <code>undefined</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8635a4c729ac41d281020edc5c9569e9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811134028917"></p>
<h4 id="Suspense-组件"><a href="#Suspense-组件" class="headerlink" title="Suspense 组件"></a><code>Suspense</code> 组件</h4><blockquote>
<p><code>setup</code> 使用 <code>async</code>/<code>await</code></p>
</blockquote>
<p>我们需要 <code>setup</code> 返回数据那么它肯定就不能使用 <code>async</code> 修饰，这样返回 <code>promise</code> 是我们不想看见情况，如果我们硬要用 <code>async</code> 修饰，我们就得用的在它的父组件外层需要嵌套一个<code>suspense</code>(不确定)内置组件，里面放置一些不确定的操作，比如我们就可以把异步组件放入进去</p>
<h5 id="1-子组件"><a href="#1-子组件" class="headerlink" title="1.子组件"></a>1.子组件</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  &#123;&#123; res &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Son&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> res = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;地址&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      res,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-父组件"><a href="#2-父组件" class="headerlink" title="2.父组件"></a>2.父组件</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Son</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="setup-参数"><a href="#setup-参数" class="headerlink" title="setup 参数"></a><code>setup</code> 参数</h4><blockquote>
<p><code>setup</code>(<code>props</code>, <code>context</code>)</p>
</blockquote>
<p><code>setup</code> 函数中的第一个参数是 <code>props</code>。它接收父组件传递的值，是的就是父子组件信息传递的 <code>props</code></p>
<p>第二个参数是 <code>context</code> 里面包含3个属性 <code>&#123; attrs, slots, emit &#125;</code>，这三个属性大家看名字就应该知道是什么吧 分别对应 <code>this.$attrs</code>，<code>this.$slots</code>，<code>this.$emit</code></p>
<ul>
<li><code>attrs</code>: 除了 <code>props</code> 中的其他属性</li>
<li><code>slots</code>: 父组件传入插槽内容的对象</li>
<li><code>emit</code>: 和用于父子组件通信</li>
</ul>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a><code>ref</code></h3><blockquote>
<p>定义/转为 响应式</p>
</blockquote>
<p>在上面 <code>setup</code> 写的数据都<strong>不是响应式的</strong>，修改了数据，视图并不会更新</p>
<p>在 <code>Vue3</code> 中提供了两种方式定义响应式数据，先来介绍下 <code>ref</code></p>
<p>导入 <code>ref</code> 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>你可以先声明一个<strong>基本类型</strong>变量后再当做 <code>ref</code> 的形参穿进去</li>
<li><p>或者直接在 <code>ref</code> 中传入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> number1 = <span class="title function_">ref</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> number2 = <span class="title function_">ref</span>(num)</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>来查看一下 <code>number1</code> 是什么吧</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6225b7f5b79d4f4cb1431c64518be657~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811183344632"></p>
<p>可以看见的是 <code>number1</code> 是一个 <code>Ref</code> 对象，我们设置的 <code>10</code> 这个值在这个对象的 <code>value</code> 属性上</p>
<p>也就是说我们修改的时候必须要修改的是 <code>number1.value</code></p>
<p>通过给<code>value</code>属性添加 <code>getter</code>/<code>setter</code> 来实现对数据的劫持</p>
<p>但是在模板上使用的时候 不用写 <code>number1.value</code> 直接写 <code>number1</code> 即可</p>
<p>在模板编译的时候回自动加上 <code>value</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  &#123;&#123; number1 &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateNum&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Son&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> number1 = <span class="title function_">ref</span>(<span class="number">10</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateNum</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      number1.<span class="property">value</span>++</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      number1,</span></span><br><span class="line"><span class="language-javascript">      updateNum,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5b9e88c52c84261aa28e6cc5cd74bf5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="35"></p>
<p>使用起来完全没有问题</p>
<p>刚才强调了说 <code>ref</code> 接收 基本类型的数据，那么它可以接收 复杂类型吗，<code>object</code> 类型等，当然可以</p>
<p>给 <code>ref</code> 传入复杂类型，其实它是调用 <code>reactive</code> 来实现的</p>
<p><code>reactive</code> 下面会提到</p>
<h3 id="ref-获取元素"><a href="#ref-获取元素" class="headerlink" title="ref 获取元素"></a><code>ref</code> 获取元素</h3><p>同样的 <code>ref</code> 还可以用了获取元素</p>
<p>大家在 <code>Vue2.X</code> 中是怎么获取的呢，先在 标签上定义 <code>:ref=&#39;XXX&#39;</code> 然后 <code>this.$refs.XXX</code> 来获取</p>
<p>在 <code>Vue3</code> 上获取元素就有些许不同了</p>
<blockquote>
<p>1.首先在 模板元素上 <code>ref=&#39;XXX&#39;</code> 这里不用 <code>v-bind</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;haha&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;haha&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>2.在 <code>setup</code> 中</p>
</blockquote>
<p>得给 <code>ref</code> 指定类型 <code>HTMLElement</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> haha = ref&lt;<span class="title class_">HTMLElement</span>|<span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(haha)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    haha,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>如果在组件中需要使用到 <code>haha</code> ，就必须把 <code>haha``return</code> 出去合并 <code>data</code></p>
<p>我们来看看打印的是什么</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c17d2e13f4941d7a37281eef673cfcf~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811230220185"></p>
<p>可以看见的是 <code>haha</code> 是个 <code>Ref</code> 对象，<code>value</code> 值就是我们想要获取到的元素</p>
<p>然后我们可以对 <code>haha</code> 这个 <code>DOM</code> 元素进行操作，比如这个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">haha.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&#x27;20px&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a><code>reactive</code></h3><p><code>reactive</code> 接收一个普通对象然后返回该普通对象的响应式<code>代理对象</code></p>
<p>没错 它的底层就是使用 <code>Proxy</code> 进行代理</p>
<blockquote>
<p>简单写个Vue3响应式例子来说下 <code>Proxy</code></p>
</blockquote>
<p><code>new Proxy(target, handler)</code></p>
<ul>
<li><code>target</code> ：要使用 <code>Proxy</code> 包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）</li>
<li><code>handler</code>：一个通常以函数作为属性的对象，各属性中的函数分别定义了在执行各种操作时代理 <code>p</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> target\[key\]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newValue</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (target\[key\] === newValue) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        target\[key\] = newValue</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">textContent</span> = target\[key\]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>reactive</code> 基础用法</p>
</blockquote>
<p>导入，当然写的时候，<code>vscode</code> 会自动帮你引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure>
<p>简单使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        obj,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来看看返回的 <code>Proxy</code> 对象吧</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/596efb4256c74cc19feb6f6b365bdb90~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811191209064"></p>
<p>数据都在 <code>target</code> 中，</p>
<p>在模板使用直接 <code>&#123;&#123;obj.name&#125;&#125;</code> 即可</p>
<p>修改直接修改 <code>obj\[name\]``=``‘xxx’</code></p>
<p>操作代理对象,obj中的数据也会随之变化，同时如果想要在操作数据的时候,界面也要跟着重新更新渲染,那么也是操作代理对象</p>
<blockquote>
<p>响应式的数据是深层次的（递归深度响应式）</p>
</blockquote>
<p>对于多层嵌套的数据也是响应式的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="attr">phone</span>: &#123;</span><br><span class="line">            <span class="attr">p_name</span>: <span class="string">&#x27;小米&#x27;</span>,</span><br><span class="line">            <span class="attr">p_apps</span>: &#123;</span><br><span class="line">                <span class="attr">app_name</span>: <span class="string">&#x27;小米运动&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">upadateName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        obj.<span class="property">phone</span>.<span class="property">p</span>\_apps.<span class="property">app</span>\_name = <span class="string">&#x27;掘金&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        obj,</span><br><span class="line">        upadateName,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa30d692e14e40cf962235006245e4c5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="36"></p>
<blockquote>
<p><code>shallowReactive</code></p>
</blockquote>
<p>它是一个简单的 reactive ，只把第一层的对象改为响应式，这里就不多说了</p>
<blockquote>
<p>使用 <code>ref</code> 传入对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = <span class="title function_">ref</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        obj,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/782b587ab1384163a505b3694b4eaab8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811191739873"></p>
<p>实际上是 <code>ref</code> 使用 <code>reactive</code> 来进行操作的</p>
<h3 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a><code>toRefs</code></h3><p>这个方法可以把 <code>reactive</code> 响应式对象，转化为 普通对象，普通对象的每个属性都是 <code>Ref</code> 对象，这样的话保证了 <code>reactive</code> 的每个属性还是响应式的，我们还可以把每个属性进行分解使用，这样在组件就不用 <strong>obj[属性]</strong>，代码量减轻了，yyds</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> userObj = <span class="title function_">toRefs</span>(user)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(userObj)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d44ff7b5950843c781ead5e0d1d64f2b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811223510320"></p>
<p>可以看见 <code>name</code> 和 <code>age</code> 已经变成了 <code>Ref</code> 对象</p>
<p>我们可以解构 出 <code>name</code> 和 <code>age</code> 单独使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> userObj = <span class="title function_">toRefs</span>(user)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...userObj,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="toRef"><a href="#toRef" class="headerlink" title="toRef"></a><code>toRef</code></h3><p>还有一个 <code>toRef</code> 方法，它的作用和 <code>toRefs</code> 差不多，但是它只能把响应式对象/普通对象的<strong>某一个</strong>属性变为 <code>Ref</code> 对象</p>
<blockquote>
<p>可以用来为源响应式对象上的 <code>property</code> 性创建一个 <code>ref</code>。然后可以将 <code>ref</code> 传递出去，从而保持对其源 <code>property</code> 的响应式连接。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="title function_">useSomeFeature</span>(<span class="title function_">toRef</span>(props, <span class="string">&#x27;foo&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useSomeFeature</span>(<span class="params">foo: Ref</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拷贝了一份新的数据值单独操作, 更新时相互不影响</p>
<p>当您要将 <code>prop</code> 的 <code>ref</code> 传递给复合函数时，<code>toRef</code> 很有用</p>
<p>可以从官方文档看出，用于在于组件之前的传递数据 从 <code>props</code> 拿出 <code>&#39;foo&#39;</code> 属性给复合函数，复合函数 <code>useSomeFeature</code>，接收的参数 <code>foo</code> 为 <code>Ref</code> 类型，刚好可以使用<code>toRef</code> 来进行转化</p>
<h3 id="判断响应式"><a href="#判断响应式" class="headerlink" title="判断响应式"></a>判断响应式</h3><blockquote>
<p>几个判断是否哪种响应式创建的方法</p>
</blockquote>
<p>1.<code>isRef</code>: 检查一个值是否为一个 ref 对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ref1 = <span class="title function_">ref</span>(<span class="number">1</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isRef</span>(ref1))</span><br></pre></td></tr></table></figure>
<p>2.<code>isReactive</code>: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ref2 = <span class="title function_">reactive</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isReactive</span>(ref2))</span><br></pre></td></tr></table></figure>
<p>3.<code>isReadonly</code>: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ref3 = <span class="title function_">readonly</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isReadonly</span>(ref3))</span><br></pre></td></tr></table></figure>
<p>4.<code>isProxy</code>: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ref2 = <span class="title function_">reactive</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isProxy</span>(ref2))</span><br><span class="line"><span class="keyword">let</span> ref3 = <span class="title function_">readonly</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isProxy</span>(ref3))</span><br></pre></td></tr></table></figure>
<h3 id="customRef"><a href="#customRef" class="headerlink" title="customRef"></a><code>customRef</code></h3><p>上面提到了这么多的 <code>Ref</code> 都是 Vue 帮我们内置的，</p>
<p>我们可以通过 <code>customRef</code> 实现我们自己的 <code>Ref</code></p>
<blockquote>
<p>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。它需要一个工厂函数，该函数接收 <code>track</code> 和 <code>trigger</code> 函数作为参数，并应返回一个带有 <code>get</code> 和 <code>set</code> 的对象。</p>
</blockquote>
<p>官方文档给了一个防抖的例子，我们也写个来看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>App<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span>/&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;keyword&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  customRef</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> useDebouncedRef&lt;T&gt;(<span class="attr">value</span>: T, delay = <span class="number">200</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">let</span> <span class="attr">timeout</span>: number</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> <span class="title function_">customRef</span>(<span class="function">(<span class="params">track, trigger</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">track</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> value</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">set</span>(<span class="params">newValue: T</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="built_in">clearTimeout</span>(timeout)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          value = newValue</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">trigger</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;, delay)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span> () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> keyword = <span class="title function_">useDebouncedRef</span>(<span class="string">&#x27;&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      keyword</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="shallowRef-和-shallowReactive"><a href="#shallowRef-和-shallowReactive" class="headerlink" title="shallowRef 和 shallowReactive"></a><code>shallowRef</code> 和 <code>shallowReactive</code></h3><p>浅的响应式，一般用的不多，我们使用 <code>ref</code> 和 <code>reactive</code> 比较多</p>
<blockquote>
<p><code>shallowReactive</code></p>
</blockquote>
<p>对象结构多层嵌套，但是我们的需求只需要修改最外层的数据，就不用把里面的嵌套结构都转为响应式，这样使用浅的响应式提高性能，只有最外一层是响应式</p>
<p>比较容易理解，我这就里就不举例子了</p>
<blockquote>
<p><code>shallowRef</code></p>
</blockquote>
<p>我们之前说过 <code>ref</code> 也能传入一个对象，实际上还是调用 <code>reactive</code> 返回 <code>Proxy</code> 代理对象，如果内层还有对象，还是使用 <code>reactive</code> 进行处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">ref</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">reactive</span>(&#123; <span class="attr">value</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span> &#125; &#125;)</span><br></pre></td></tr></table></figure>
<p>同样的 <code>shallowRef</code> 处理 对象类型，是交给 <code>shallowReactive</code> 去完成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">shallowRef</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">shallowReactive</span>(&#123; <span class="attr">value</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span> &#125; &#125;)</span><br></pre></td></tr></table></figure>
<p>这样子我们就明白了，为啥 只处理了 <code>value</code> 的响应式，不进行对象的 <code>reactive</code>处理，适用于会被替换的数据</p>
<p><code>【注意】</code>：<code>shallowRef</code> 创建一个 <code>ref</code> ，将会追踪它的 <code>value</code> 更改操作，但是并不会对变更后的 <code>value</code> 做响应式代理转换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> info1 = <span class="title function_">ref</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">notebook</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;小米笔记本&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">let</span> info2 = <span class="title function_">shallowRef</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">    <span class="attr">notebook</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;小米笔记本&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info1, info2)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    info1,</span><br><span class="line">    info2,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>我们来打印下两个对象</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d3bce8ea859452dbea0388766f8308c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210812113721281"></p>
<p>可以看见的是 <code>Ref</code> 的 <code>value</code> 值是用 <code>reactive</code> 返回的 <code>Proxy</code> 对象，</p>
<p><code>shallowRef</code> 的 <code>value</code> 是普通对象</p>
<h3 id="readonly-和-shallowReadonly"><a href="#readonly-和-shallowReadonly" class="headerlink" title="readonly 和 shallowReadonly"></a><code>readonly</code> 和 <code>shallowReadonly</code></h3><blockquote>
<p><code>readonly</code> 深度只读</p>
</blockquote>
<p>设置普通对象或者是响应式对象为只读，不能进行修改，看上面的名字就知道是深度的，深度是什么概念大家差不多都清楚，递归把内层的每一个属性都设置为只读，进行修改操作就会报错，提高了安全性</p>
<p>基本使用：</p>
<p>用什么就导入什么</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, readonly &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure>
<p>果然在编译之前就报错了 <code>Error</code>: <code>无法分配到 &quot;name&quot; ，因为它是只读属性</code></p>
<p>无论是内层还是外层都只读，是深度检测的</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44875ed772764e8c9ccbf2eefc863c0e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210812121429275"></p>
<blockquote>
<p><code>shallowReadonly</code> 浅度只读</p>
</blockquote>
<p>浅度的话只针对最外面一层不关心 内层</p>
<p>可以看下面的例子 只有外层的 <code>name</code> 报错，修改内层没有错误</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6262c6d96b44fcdb7012bd7f8da863e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210812121747662"></p>
<h3 id="toRaw-和-markRaw"><a href="#toRaw-和-markRaw" class="headerlink" title="toRaw 和 markRaw"></a><code>toRaw</code> 和 <code>markRaw</code></h3><blockquote>
<p>这两个用的还是比较少</p>
</blockquote>
<p>我这里就简单的过一下</p>
<blockquote>
<p><code>toRaw</code>: 将一个响应式对象转为普通对象</p>
</blockquote>
<p>简单使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> info1 = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">notebook</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;小米笔记本&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> rawInfo = <span class="title function_">toRaw</span>(info1)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(info1)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rawInfo)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d99a9bfaa684c269495f99a48945ae7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210812123328497"></p>
<p>两个打印出来，一个是响应式对象，通过 <code>toRaw</code> 后变成了普通对象</p>
<blockquote>
<p><code>markRaw</code>: 标记一个对象，让它永远不会转为响应式对象，返回值是本身</p>
</blockquote>
<p>比如： 一些不变的数据死数据，还有一些第三方类实例，不用转为响应式对象，提高性能</p>
<p>简单使用：</p>
<p>这里使用 两个一样的对象，一个进行 <code>markRaw</code> 处理，一个不进行 <code>markRaw</code> 处理</p>
<p>然后同样使用 <code>reactive</code> 转为 响应式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">notebook</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;小米笔记本&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> markRawObj = <span class="title function_">markRaw</span>(obj)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> reactObj = <span class="title function_">reactive</span>(markRawObj)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">notebook</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;小米笔记本&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> reactObj2 = <span class="title function_">reactive</span>(obj2)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(reactObj)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(reactObj2)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看看打印的，被标记过的 <code>obj</code> 并没有转为 <code>Proxy</code> 响应式代理对象</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/04c6d80e6fb74a4d81b5e3167010ef79~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210812124720404"></p>
<h3 id="computed-计算属性"><a href="#computed-计算属性" class="headerlink" title="computed 计算属性"></a><code>computed</code> 计算属性</h3><p>在<code>Vue3</code>中使用<code>computed</code> 和<code>Vue2.X</code> 有些不同，这里 <code>computed</code>是一个方法</p>
<blockquote>
<p>首先还是得导入 <code>computed</code> 方法</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>参数为一个回调 默认为 <code>get</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;getInfo&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;小浪&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> getInfo = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`我的名字：<span class="subst">$&#123;name.value&#125;</span>,今年<span class="subst">$&#123;age.value&#125;</span>，请多多指教`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name,</span><br><span class="line">        age,</span><br><span class="line">        getInfo,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/336f33d348ed4e908e016a8c9eacb796~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="37"></p>
<p>这里没有实现 <code>set</code> 方法，所以修改下面没有用</p>
<blockquote>
<p>参数为一个<strong>对象</strong> 在这里写 <code>get``set</code></p>
</blockquote>
<p>模板和上面一样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;小浪&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> getInfo = <span class="title function_">computed</span>(&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;name.value&#125;</span>,<span class="subst">$&#123;age.value&#125;</span>`</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="title function_">set</span>(<span class="params">val: string</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> arr = val.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            name.<span class="property">value</span> = arr\[<span class="number">0</span>\]</span><br><span class="line">            age.<span class="property">value</span> = <span class="built_in">parseInt</span>(arr\[<span class="number">1</span>\])</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name,</span><br><span class="line">        age,</span><br><span class="line">        getInfo,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb1487dddb3f425e9d9aa2460d202b5c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="38"></p>
<h3 id="watch-侦听器"><a href="#watch-侦听器" class="headerlink" title="watch 侦听器"></a><code>watch</code> 侦听器</h3><p>和 Vue2.X 的 Watch 使用方法差不多</p>
<blockquote>
<p>介绍</p>
</blockquote>
<p>watch(data,handler,object)</p>
<ol>
<li><code>data</code>：可以是返回值的 <code>getter</code> 函数，也可以是 <code>ref</code></li>
<li><code>handler</code>：回调函数</li>
<li><code>object</code>：可选配置项 <code>&#123; immediate: true &#125;</code></li>
</ol>
<blockquote>
<p>引入</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>data</code> 为一个 <code>ref</code></p>
</blockquote>
<p>回调函数的参数是 (新值,旧值)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;小浪&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> watchName = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="title function_">watch</span>(name, <span class="function">(<span class="params">newName, oldName</span>) =&gt;</span> &#123;</span><br><span class="line">        watchName.<span class="property">value</span> = <span class="string">`我是新姓名<span class="subst">$&#123;newName&#125;</span></span></span><br><span class="line"><span class="string">		我是老姓名<span class="subst">$&#123;oldName&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name,</span><br><span class="line">        age,</span><br><span class="line">        watchName,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7d69bf6172f4f68be61571853880c41~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210811204502523"></p>
<p>可以看见页面第三栏没有显示，因为 <code>name</code> 值没有变化，所以就不用改变，<code>watch</code>的第三个参数是 配置对象，我们在里面可以设置 立即执行 <code>&#123; immediate: true &#125;</code></p>
<p>就会执行一次 当然这个时候 <code>oldName</code> 为 <code>undefined</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  name,</span><br><span class="line">  <span class="function">(<span class="params">newName, oldName</span>) =&gt;</span> &#123;</span><br><span class="line">    watchName.<span class="property">value</span> = <span class="string">`我是新姓名<span class="subst">$&#123;newName&#125;</span></span></span><br><span class="line"><span class="string">  我是老姓名<span class="subst">$&#123;oldName&#125;</span>`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e35c8ce9360449e9edaa4bbaa00336a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="39"></p>
<blockquote>
<p><code>data</code> 为一个 <code>getter</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>haha,<span class="function">(<span class="params">newName, oldName</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>()=\&gt; haha</code> 直接返回一个值，相当于 <code>getter</code> 简写,<code>haha</code>可以不是响应式数据</p>
<blockquote>
<p><code>data</code> 为多个 <code>ref</code></p>
</blockquote>
<p>模板还是之前那个</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;getInfo&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们可以把多个 <code>ref</code> 放进一个数组里面</p>
<p><code>newNameAndAge</code>，<code>oldNameAndAge</code>为一个数组保存着 新 和 旧的 [name,age]</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="title function_">ref</span>(<span class="string">&#x27;小浪&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> age = <span class="title function_">ref</span>(<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> watchName = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="title function_">watch</span>(</span><br><span class="line">      \[name, age\],</span><br><span class="line">      <span class="function">(<span class="params">newNameAndAge, oldNameAndAge</span>) =&gt;</span> &#123;</span><br><span class="line">        watchName.<span class="property">value</span> = <span class="string">`new: <span class="subst">$&#123;newNameAndAge&#125;</span></span></span><br><span class="line"><span class="string">        old: <span class="subst">$&#123;oldNameAndAge&#125;</span>`</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name,</span><br><span class="line">        age,</span><br><span class="line">        watchName,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60adfa12c0dc42239985d630a0a9e46d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="40"></p>
<blockquote>
<p><code>data</code> 为 <code>reactive</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> watchInfo = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="title function_">watch</span>(</span><br><span class="line">    user,</span><br><span class="line">    <span class="function">(<span class="params">newInfo, oldInfo</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(newInfo === oldInfo)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里是对象 会出现问题，立即执行后，</p>
<p>如果加上 立即执行 除了第一次 <code>newInfo</code>为 <code>&#123;name: &#39;小浪&#39;,age: 21&#125;</code></p>
<p><code>oldInfo</code> 为 <code>undefined</code> ，之后<strong>始终返回该对象的当前值</strong></p>
<p>所以 <code>newInfo</code> = <code>oldInfo</code></p>
<p>对于这个问题，我们得加上配置对象 <code>&#123;deep: true&#125;</code>进行深度检测</p>
<p>深度检测还可以判断多重嵌套</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  user,</span><br><span class="line">  <span class="function">(<span class="params">newInfo, oldInfo</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newInfo === oldInfo)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a><code>watchEffect</code></h3><p>这个也是用来监听数据变化，默认就会执行一次所以这里就不需要配置，而且不用指定 <code>data</code>,使用哪些响应式数据就监听哪些</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;小浪&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">name</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide / inject"></a>provide / inject</h3><p>提供 和 注入 是很简单理解的</p>
<blockquote>
<p>实现跨层级组件(祖孙)间通信</p>
</blockquote>
<p>在多层嵌套组件中使用，不需要将数据一层一层地向下传递</p>
<p>可以实现 跨层级组件 通信</p>
<p>在 父组件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Vue3学习&#x27;</span></span><br><span class="line">        <span class="attr">date</span>: <span class="string">&#x27;2021/7/23&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;info&#x27;</span>, info)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        info</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 子孙 层级组件使用注入就能够获取到了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> color = <span class="title function_">inject</span>(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        info</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Teleport-传送组件"><a href="#Teleport-传送组件" class="headerlink" title="Teleport 传送组件"></a><code>Teleport</code> 传送组件</h3><p>这个组件特别有趣，可以把组件进行传送</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">to</span>=<span class="string">&quot;.test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dog&quot;</span>&gt;</span>狗子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>to</code> 是目标的地址 <code>body</code> , <code>#XXX</code> , <code>.XXX</code> 这些都是 <code>css</code> 选择器</p>
<p>下面写个例子大家看下就明白了</p>
<blockquote>
<p>模板</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li_1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li_2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li_3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">teleport</span> <span class="attr">:to</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img0.baidu.com/it/u=3077713857,1222307962&amp;fm=26&amp;fmt=auto&amp;gp=0.jpg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btnGroup&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;target = &#x27;.li_1&#x27;&quot;</span>&gt;</span>传送1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;target = &#x27;.li_2&#x27;&quot;</span>&gt;</span>传送2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;target = &#x27;.li_3&#x27;&quot;</span>&gt;</span>传送3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>setup</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> target = <span class="title function_">ref</span>(<span class="string">&#x27;.li_1&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    target,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>利用 按钮 点击来控制 <code>teleport</code> 是否显示， <code>teleport</code> 一渲染，就会跑到 <code>li</code> 下面</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/083b7f7bcd8b46179188e4a5cfc31454~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="42"></p>
<h3 id="Vue3-生命周期"><a href="#Vue3-生命周期" class="headerlink" title="Vue3 生命周期"></a><code>Vue3</code> 生命周期</h3><blockquote>
<p><code>Vue2.X</code> 对应 <code>Vue3</code>组合API</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>Vue2.X</code></th>
<th><code>Vue3</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>beforeCreate</td>
<td>—-&gt;</td>
<td><code>setup()</code></td>
</tr>
<tr>
<td>created</td>
<td>—-&gt;</td>
<td><code>setup()</code></td>
</tr>
<tr>
<td>beforeMount</td>
<td>—-&gt;</td>
<td>onBeforeMount</td>
</tr>
<tr>
<td>mounted</td>
<td>—-&gt;</td>
<td>onMounted</td>
</tr>
<tr>
<td>beforeUpdate</td>
<td>—-&gt;</td>
<td>onBeforeUpdate</td>
</tr>
<tr>
<td>updated</td>
<td>—-&gt;</td>
<td>onUpdated</td>
</tr>
<tr>
<td>beforeDestroy</td>
<td>—-&gt;</td>
<td><code>onBeforeUnmount</code></td>
</tr>
<tr>
<td>destroyed</td>
<td>—-&gt;</td>
<td><code>onUnmounted</code></td>
</tr>
<tr>
<td>activated</td>
<td>—-&gt;</td>
<td>onActivated</td>
</tr>
<tr>
<td>deactivated</td>
<td>—-&gt;</td>
<td>onDeactivated</td>
</tr>
<tr>
<td>errorCaptured</td>
<td>—-&gt;</td>
<td>onErrorCaptured</td>
</tr>
<tr>
<td>onRenderTriggered</td>
</tr>
<tr>
<td>onRenderTracked</td>
</tr>
</tbody>
</table>
</div>
<p>可以看出</p>
<p><code>beforeCreate</code> 和 <code>created</code> 在Vu3还是能正常使用，在Vue3我们可以用更好更快的 <code>setup</code> 代替</p>
<p><code>on</code>开头的 生命周期需要 通过 <code>import</code> 导入，在 <code>setup</code> 函数中使用</p>
<p><code>Vue3</code> 的生命周期 比 <code>Vue2.X</code> 的生命周期快</p>
<p>举个例子: <code>onBeforeMount</code> 比 <code>beforeMount</code> 快 其他同理</p>
<p>还多个两个钩子:</p>
<ul>
<li><code>onRenderTriggered</code> 跟踪虚拟 DOM 重新渲染时调用</li>
<li><code>onRenderTracked</code> 当虚拟 DOM 重新渲染被触发时调用</li>
</ul>
<h3 id="全局API-转移"><a href="#全局API-转移" class="headerlink" title="全局API 转移"></a>全局<code>API</code> 转移</h3><p><code>Vue2.X</code> 中 <code>Vue</code> 上面的全局API ，比如自定义指令 <code>Vue.directive</code>，全局组件 <code>Vue.component</code> 在Vue3都进行改变，不再提供 <code>Vue</code> ，而是提供 <code>app</code></p>
<p>具体改变可以看下面</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Vue2.X</th>
<th>Vue3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vue.config</td>
<td>app.config</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td>移除</td>
</tr>
<tr>
<td>Vue.config.ignoredElements</td>
<td>app.config.isCustomElement</td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
<tr>
<td>new Vue().$mount(‘#app’)</td>
<td>createApp(App).mount(‘#app’)</td>
</tr>
</tbody>
</table>
</div>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>到了这里我们基本都了解了 <code>Vue3</code> 的一些特性</p>
<ul>
<li>新的脚手架工具<code>vite</code></li>
<li>在 <code>Vue3</code> 仍然支持 <code>Vue2</code> 中的大多数特性</li>
<li><code>Vue</code> 组合<code>APi</code>代替了<code>Vue2</code>中的<code>option API</code> ，同一逻辑集中起来，复用性更强了</li>
<li><code>Vue3</code> 使用 <code>TS</code> 编写更好的支持TS</li>
<li><code>Vue3</code> 使用<code>Proxy</code> 代替了<code>Vue2</code>中<code>Object.defineProperty()</code> 实现响应式原理</li>
<li>介绍了新的组件: <code>Fragment``Teleport``Suspense</code></li>
</ul>
<p>这里还没有提到的 <code>Vue3</code> 重写了 <strong>虚拟DOM</strong> ，提高了性能</p>
<p>希望这篇笔记能够帮助到大家，如果我写的不清楚，具体的还得看 <code>官方文档</code> yyds，最近开学了，学校里面的事情也多了…</p>
<p>(o゜▽゜)o☆</p>
<blockquote>
<p>参考资料：</p>
</blockquote>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fvue3js.cn%2Fdocs%2Fzh" title="https://vue3js.cn/docs/zh">Vue3官网文档</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Zy4y1K7SH%3Fp%3D156" title="https://www.bilibili.com/video/BV1Zy4y1K7SH?p=156">B站资料</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/08/23/10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/08/23/10/" class="post-title-link" itemprop="url">还不会TS？带你TypeScript快速入门TS</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-23 06:12:10" itemprop="dateCreated datePublished" datetime="2021-08-23T06:12:10+08:00">2021-08-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="还不会TS？-带你-TypeScript-快速入门TS"><a href="#还不会TS？-带你-TypeScript-快速入门TS" class="headerlink" title="还不会TS？ 带你 TypeScript 快速入门TS"></a>还不会TS？ 带你 TypeScript 快速入门TS</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6999440503712251935">https://juejin.cn/post/6999440503712251935</a></p>
<blockquote>
<p>前言</p>
</blockquote>
<p>TS 现在使用地越来越多，学计算机的就得不断的学习，才能更好的追逐这个时代，这是小浪以前学习TS时候的总结，能快速的帮助大家入门 TS，这里列举不是很全列举一些常用的，但是能满足平时的需求，具体的可以看官方的文档哈，这里只是简单的入门，希望能够帮助到大家</p>
<blockquote>
<p>往期精彩：</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6994337441314242590" title="https://juejin.cn/post/6994337441314242590">快速上手Vuex 到 手写简易 Vuex</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6990582632270528525" title="https://juejin.cn/post/6990582632270528525">从了解到深入虚拟DOM和实现diff算法</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6989106100582744072" title="https://juejin.cn/post/6989106100582744072">手写一个简易vue响应式带你了解响应式原理</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6988316779818778631" title="https://juejin.cn/post/6988316779818778631">从使用到自己实现简单Vue Router看这个就行了</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6983934602196811789" title="https://juejin.cn/post/6983934602196811789">前端面试必不可少的基础知识，虽然少但是你不能不知道</a></p>
</blockquote>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><p><code>TS</code> 的优点和缺点就不一一赘述了，下面直接进入正题</p>
<blockquote>
<p>进行全局安装</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g typescript</span><br></pre></td></tr></table></figure>
<h2 id="2-原始数据类型"><a href="#2-原始数据类型" class="headerlink" title="2.原始数据类型"></a>2.原始数据类型</h2><p>掘金代码高亮我觉得和主题有冲突，这里代码代码都是比较简单，我就直接截图了哈</p>
<blockquote>
<p>我们在变量后面添加 <code>: 类型</code> 就可以规定数据的类型，设置其他类型就会报错</p>
<p>我们这里先来了解下基础的类型</p>
</blockquote>
<h3 id="1-字符串-string"><a href="#1-字符串-string" class="headerlink" title="1.字符串 string"></a>1.字符串 <code>string</code></h3><blockquote>
<p>双引号（<code>&quot;</code>）或单引号（<code>&#39;</code>）表示字符串</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41ea8b9ef5f1447a8a247fb03764c170~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809093951818"></p>
<h3 id="2-数字-number"><a href="#2-数字-number" class="headerlink" title="2.数字 number"></a>2.数字 <code>number</code></h3><blockquote>
<p>支持 十/十六/二/八 进制</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55a20a97c3b6463ca7e278c7330620da~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809094238590"></p>
<h3 id="3-布尔-boolean"><a href="#3-布尔-boolean" class="headerlink" title="3.布尔 boolean"></a>3.布尔 <code>boolean</code></h3><blockquote>
<p>只能是 <code>true</code>/<code>false</code></p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68898b41d2a248aa9c6b6afa39fe8bad~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809094357439"></p>
<h3 id="4-undefined"><a href="#4-undefined" class="headerlink" title="4.undefined"></a>4.<code>undefined</code></h3><blockquote>
<p>用处不是很大</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4adbd43b75849fc9d01b4a6008e9da7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809094430315"></p>
<h3 id="5-null"><a href="#5-null" class="headerlink" title="5.null"></a>5.<code>null</code></h3><blockquote>
<p>用处不是很大</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16172c44cf944880b314d28b20470663~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809094458172"></p>
<h3 id="6-空-void"><a href="#6-空-void" class="headerlink" title="6.空 void"></a>6.空 <code>void</code></h3><blockquote>
<p>没有任何类型，函数的没用返回值的使用 <code>void</code> ,返回值为空（ <code>undefined</code> ）</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/534b91390cb1492bbc462b152d5682d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210810194819203"></p>
<h3 id="7-任意类型-any"><a href="#7-任意类型-any" class="headerlink" title="7.任意类型 any"></a>7.任意类型 <code>any</code></h3><blockquote>
<p>这里当类型不确定的时候，就可以使用 <code>any</code> 任意类型，不到万不得已不使用</p>
<p><code>Unknow</code> 类型和 <code>any</code> 一样可以容纳任意类型比 <code>any</code> 安全</p>
<p>平时用的不多，就不介绍了</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdbd6793bacc4e9da6c199f3a312469f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809094624551"></p>
<h3 id="7-字面量"><a href="#7-字面量" class="headerlink" title="7.字面量"></a>7.字面量</h3><blockquote>
<p>定义什么就只能赋值什么</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/678078f02de34b5fb5c56bd9eb06ca9c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809154738126"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1d0fb316f0248bf872054508e89de4f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809154921672"></p>
<h2 id="3-复杂类型"><a href="#3-复杂类型" class="headerlink" title="3.复杂类型"></a>3.复杂类型</h2><h3 id="1-数组-array"><a href="#1-数组-array" class="headerlink" title="1.数组 array"></a>1.数组 <code>array</code></h3><blockquote>
<p>设置数组的类型 比如这个例子 <code>true</code> 这个就会报错，不属于<code>number</code>，数组的元素必须是规定好的类型 其他类型同理</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/689ff60c586342f9b8789a4e67eabf73~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808213454745"></p>
<h3 id="2-元组-tuple"><a href="#2-元组-tuple" class="headerlink" title="2.元组 tuple"></a>2.元组 <code>tuple</code></h3><blockquote>
<p>学习过 <code>Python</code> 的同学应该不太陌生，其实可以把它看做一个数组，可以声明多个类型的数组，这样就能插入多个数据类型的数据，就是长度固定的数组</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cc91183e9954989b20f51d3a94d01f3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808214401857"></p>
<h3 id="3-接口-interface"><a href="#3-接口-interface" class="headerlink" title="3.接口 interface"></a>3.接口 <code>interface</code></h3><blockquote>
<p>它能很方便的帮我们定义 <code>Ojbect</code> 类型，它是非常的灵活可以描述对象的各种类型</p>
</blockquote>
<p>与 <code>java</code> 的 <code>interface</code> 有些区别，下面简单了看下，具体的下面有介绍</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af7ba1b2e9a2457ca6838804c421dd97~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808215444817"></p>
<blockquote>
<p>在 <code>interface</code> 属性中添加 <code>？</code>可以<strong>省略</strong></p>
</blockquote>
<p>下面我们给 <code>height</code> 添加 <code>?</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c096e986c2ad491280a6679cecadb753~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808215805574"></p>
<blockquote>
<p><code>readonly</code> 不可改变的，定义完后就不能修改，是不是和 <code>const</code> 有点像，不过 <code>const</code> 是针对变量， <code>readonly</code> 是针对属性</p>
</blockquote>
<p>下面我们把 <code>id</code> 添加上 <code>readonly</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/25cd6d6c64b14e21996955f12f45b33c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808220259826"></p>
<h3 id="4-函数-funtion"><a href="#4-函数-funtion" class="headerlink" title="4.函数 funtion"></a>4.函数 <code>funtion</code></h3><blockquote>
<p>我们要规定函数的 <strong>输入类型</strong> 和 <strong>返回类型</strong></p>
<p>在<strong>形参后面</strong>接冒号声明 形参的类型，在 <code>()后面</code>冒号声明 返回值类型</p>
</blockquote>
<p>传入多余的参数会报错</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63e8e40c28bc46bc9921e922820f1126~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808221913660"></p>
<p>我们也可以为函数添加<strong>可选参数</strong> 这里用 <code>?</code> 即可，这样我们就可以调用两个参数或者三个参数不报错</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/faa3922132a24f9fba068c2c82019387~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808221628843"></p>
<p>可选参数之后不能再加规定类型的形参</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cabe6ec6e988433ebb31d567865ef40b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808222057869"></p>
<p>我们可以把它添加个 <code>？</code>变为可选参数</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f52ec760d2e1416daa2fdd2fad66866d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808222200172"></p>
<p>除了上面这种声明式写法还有一种表达式写法</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1083fbd7400e4e12a755bc472050e818~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808222347710"></p>
<blockquote>
<p>有了上面的了解后我们来说下 <strong>定义函数类型</strong> 的变量</p>
</blockquote>
<p>这里这个函数还是上面那个</p>
<p>我们定义<code>mysum</code> 指定它 的类型 来接收 我们上面定义的函数</p>
<p><code>()</code> 里面是输入的形参的 类型</p>
<p><code>=&gt;</code> 代表是 <strong>返回值</strong> 的类型</p>
<p><code>:</code> 后面的都是声明类型，和代码逻辑没有什么关系</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6c6a8e940be4b32af49d561abf47f4c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808223036183"></p>
<blockquote>
<p>我们刚才说了 <code>interface</code> 可以描述各种类型，那么我们用 <code>interface</code> 来描述下函数类型</p>
</blockquote>
<p>注意一点 之前用的 <code>=&gt;</code> 来表示返回值类型</p>
<p>这里是在 <code>()</code>后 <code>: 返回值类型</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43b0ca286db34783b0d0609b8083fbbd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210808223626451"></p>
<h3 id="5-联合类型-union-types"><a href="#5-联合类型-union-types" class="headerlink" title="5.联合类型 union types"></a>5.联合类型 <code>union types</code></h3><blockquote>
<p>但对于一个变量的类型可能是几种类型的时候我们可以使用 <code>any</code> ，但是 <code>any</code> 的范围是不是有点大了，不到<strong>万不得已</strong>不使用，</p>
<p>我们如果知道是其中的哪几种类型的话，我们就可以使用 <strong>联合类型</strong> 用 <code>|</code> 分隔</p>
</blockquote>
<p>比如下面的例子，<code>haha</code> 可能是 <code>number</code> 或者 <code>string</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0c6c42d49bf415290f1e4bf5be2263b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809090557218"></p>
<p><strong>注意</strong>：在没有赋值之前，只能访问<strong>共同的方法、属性</strong>，比如下面的例子,<code>number</code> 没有<code>length</code> 属性</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/200ea90d1743410c9234f98644aa7238~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809091710353"></p>
<h3 id="6-对象-object"><a href="#6-对象-object" class="headerlink" title="6.对象 object"></a>6.对象 <code>object</code></h3><blockquote>
<p>我们 直接 <code>let a: object;</code> 是不是没有什么意义，因为 <code>js</code> 中对象太多了。。</p>
</blockquote>
<p>我们可以这样来用</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8656e57cf2984664a4de36aa97e764f8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809113126137"></p>
<p>属性必须在类型 <code>&#123; name: string; age: number; &#125;</code> 中</p>
<h2 id="4-断言-type-inference"><a href="#4-断言-type-inference" class="headerlink" title="4.断言 type inference"></a>4.断言 <code>type inference</code></h2><blockquote>
<p>当在上面联合类型的变量传入的时候，我们声明了这个类型为 <code>number | string</code> 它不能不能调用 <code>length</code> 方法</p>
<p>机器没法判断这个类型，但是我们比机器更了解这个类型，我们人为可以指定类型 <code>string</code> 这里我们就可以用到 <strong>类型断言</strong></p>
</blockquote>
<h3 id="1-我们就用-as-来进行断言"><a href="#1-我们就用-as-来进行断言" class="headerlink" title="1.我们就用 as 来进行断言"></a>1.我们就用 <code>as</code> 来进行断言</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/763c3ce74ada44f98a4fd99b12e2ce02~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809093348502"></p>
<h3 id="2-还有一种写法-lt-类型-gt-两者的功能都是一样的"><a href="#2-还有一种写法-lt-类型-gt-两者的功能都是一样的" class="headerlink" title="2.还有一种写法 &lt;类型&gt; 两者的功能都是一样的"></a>2.还有一种写法 <code>&lt;类型&gt;</code> 两者的功能都是一样的</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f334abbe81545dd8830b65ad21a7bb0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809093854727"></p>
<h2 id="5-类型守卫-type-guard"><a href="#5-类型守卫-type-guard" class="headerlink" title="5.类型守卫 type guard"></a>5.类型守卫 <code>type guard</code></h2><blockquote>
<p>遇到联合类型的时候，使用 类型守卫可以 缩小范围</p>
</blockquote>
<p>实现以下和上面一样的方法</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4682cf9bc4ae407abd342a06a211bda4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809101137657"></p>
<p>类型守卫 除了 <code>typeof</code> 之外 ，还有 <code>instanceof</code>、 <code>in</code></p>
<h2 id="6-类-class"><a href="#6-类-class" class="headerlink" title="6.类 class"></a>6.类 <code>class</code></h2><p>在 <code>ES6</code> 中就有 类的概念了，在 <code>TS</code> 中对类添加一些功能，这里只说下几个常用的</p>
<blockquote>
<p>先写个基础的 类</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4b2d90218ed46cbad97df2377f99170~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809115531683"></p>
<blockquote>
<p>我们先来说下 3个访问修饰符</p>
</blockquote>
<p><code>Public</code>:修饰的属性或方法是共有的 在 <strong>任何地方</strong> 都能访问</p>
<p><code>Private</code>:修饰的属性或方法是私有的 只有 <strong>本类</strong> 中访问</p>
<p><code>Protected</code>:修饰的属性或方法是受保护的 在 <strong>本类</strong> 和 <strong>子类中</strong> 能够访问</p>
<p>比如指定父类中 <code>money</code> 访问权限为 <code>private</code> ,只能在 <code>Parent</code> 访问，子类访问会出错</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2c9b4551ad74c868d8f0ac0207bc4b2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809121311868"></p>
<p>我们可以设置访问权限为 <code>protected</code> ，这样子类就能访问</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fbf27f0252a40dc996c6d9c7d6c4bf9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809121140659"></p>
<blockquote>
<p>静态属性 <code>static</code></p>
</blockquote>
<p>上面的 <code>name``money</code> 这两个属性都是通过 实例 去访问的</p>
<p>使用 <code>static</code> 修饰的属性是通过 类 去访问，是每个实例共有的</p>
<p>同样 <code>static</code> 可以修饰 方法，用 <code>static</code> 修饰的方法称为 类方法，可以使用类直接调用</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1b4ced0010547dd8f6e1aa9218a001e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809121921373"></p>
<blockquote>
<p>只读 <code>readonly</code></p>
</blockquote>
<p>我们给属性添加上 <code>readonly</code> 就能保证该属性<strong>只读</strong>，<strong>不能修改</strong>，如果存在 <code>static</code> 修饰符，写在其后</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/262d1bbd34a24c2cb01a7b94e39450b6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809122359082"></p>
<blockquote>
<p>抽象类 <code>abstract</code></p>
</blockquote>
<p><code>TS</code> 新增的抽象类，还是简单说下概念吧，我们写一个类的时候，不希望直接使用该类创建实例<strong>（不能被new）</strong>那么我们把它设置为抽象类，让它不能被实例化</p>
<p>只能被继承</p>
<p>在 <code>class</code> 前面 添加 <code>abstract</code> 修饰符，</p>
<p>在抽象类中 可以写 <strong>抽象方法</strong> ，抽象类没有方法体</p>
<p>举个例子：一个动物的抽象类，有个叫的方法，不可能 每个动物的叫声一样吧，我们可以把它设置为抽象方法，具体功能子类进行实现（该怎么叫就由子类来写）</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88c739a6e6854eab9ac07c5ec02bb356~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809124627979"></p>
<p>属性的封装和 <code>java</code> 一样，这里就不说了…</p>
<h2 id="7-接口-interface"><a href="#7-接口-interface" class="headerlink" title="7.接口 interface"></a>7.接口 <code>interface</code></h2><blockquote>
<p>为什么会出现接口</p>
</blockquote>
<p>为了解决 继承 的困境(一个类只能继承另一个类不能实现多继承)</p>
<p>还有一种情况，<strong>人</strong>能够洗衣服，<strong>洗衣机</strong>也能洗衣服，洗衣机和人找不到一个共同的父类，我们可以把洗衣服这个功能抽离出来写成接口，<strong>人</strong> 和 <strong>洗衣机</strong> 去实现这个接口就行</p>
<blockquote>
<p>我们可以用 <code>implements</code> 来实现接口</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78fa2ff70b50464b94b89b08797eae53~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809130103041"></p>
<blockquote>
<p>接口可以多实现</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cd58b7a85bd4d1a9b6bc26ff7e188a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809130403175"></p>
<blockquote>
<p>接口之前可以继承</p>
</blockquote>
<p>下面这个例子接口继承了另一个接口，这样人类只需实现一个接口就行</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44f273eeece14d24be94b6131b84d977~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809130537563"></p>
<h2 id="8-枚举-enum"><a href="#8-枚举-enum" class="headerlink" title="8.枚举 enum"></a>8.枚举 <code>enum</code></h2><blockquote>
<p>常量是在项目中经常使用，虽然 <code>const</code> 可以声明常量，但是有的常量取值是在一个范围里的，这里我们就需要使用 <code>enum</code> 来进行处理</p>
</blockquote>
<h3 id="1-数字枚举"><a href="#1-数字枚举" class="headerlink" title="1.数字枚举"></a>1.数字枚举</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63548257df9d4b21bae08e82b5799450~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809132958670"></p>
<blockquote>
<p>可以修改枚举中的初始值</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38e0a36b9d8145deba2e99edbe329911~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809133132496"></p>
<h3 id="2-字符串枚举"><a href="#2-字符串枚举" class="headerlink" title="2.字符串枚举"></a>2.字符串枚举</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be606dacb6ad4cbd8c6f72421222dfb6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809133851968"></p>
<h3 id="3-常量枚举"><a href="#3-常量枚举" class="headerlink" title="3.常量枚举"></a>3.常量枚举</h3><p>在 <code>enum</code> 前面添加一个 <code>const</code> 即可，它提高了性能</p>
<p>为什么这么说呢，我就把上面字符串枚举编译成 <code>js</code> 例子，和 常量枚举编译 贴出来对比一下</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26a0909e7ab940ae9dc280e3407d96ac~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809135017124"></p>
<p>常量枚举直接找出 <code>Week.Tuesday</code> 上面一截都没了</p>
<h2 id="9-泛型"><a href="#9-泛型" class="headerlink" title="9.泛型"></a>9.泛型</h2><blockquote>
<p>泛型就像一个占位符一个变量，在使用的时候我们可以将定义好的类型像参数一样传入，原封不动的输出</p>
</blockquote>
<p>比如这个例子我们就想返回一个值，在这里我写死是 <code>number</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b1314d6d7704533bc7faa49c1a81fba~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809140308402"></p>
<p>在实际中，未必就是 <code>number</code>，我们就可以通过泛型来解决，定义好的类型传入进去，返回什么类型出来</p>
<blockquote>
<p>泛型简单介绍</p>
</blockquote>
<p>这里 <code>T</code> 是相当于一个占位符,在方法(变量，接口….等等)后面添加 <code>&lt;T&gt;</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d74cce6b3334748a7fac4123d5682ac~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809140625111"></p>
<p>是不是看起来这么简单，其实还真是</p>
<p>然后我在使用 getValue这个方法的时候 只需要在 <strong>实参</strong> 规定好类型，编译器它也不笨，能够知道我们的参数类型，并将它们赋值给 <code>T</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f32f6b469fbf42888e7161cd3831df05~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809141357325"></p>
<blockquote>
<p>多个参数</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d526a01bd72840b99b9563aa289a972f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809141619617"></p>
<p>在使用的时候，聪明的就判断出 传入的类型，并修改了 <code>T</code>,<code>U</code>，真的很方便</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e322ee42d054492db39710761cda5f57~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809141716507"></p>
<blockquote>
<p>我们可以使用 <code>interface</code> 来约束 泛型</p>
</blockquote>
<p>在 <code>T</code> 后面 <code>extends Ilen</code> ，定义 <code>Ilen</code> 里面代码表示，<code>T</code> 必须要有 <code>length</code> 属性</p>
<p>这样在 方法里面调用 <code>params.length</code> 就不会报错</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffcaa4d26f164af690b0a3ec35687bd2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809151050324"></p>
<blockquote>
<p>在 <strong>类</strong>使用泛型</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b956da6a7f504af2baaafa45be79a88c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809152239297"></p>
<blockquote>
<p>在 <strong>接口</strong> 使用泛型</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ba740d5d0d144f3b97581d308271fae~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809152813026"></p>
<blockquote>
<p>在 <strong>数组</strong> 使用泛型</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf14ea4ef16b42d3bf21186fb1245119~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809153225159"></p>
<p>其实泛型还有很多很多使用方法，这里就简单地入门下</p>
<h2 id="10-类型别名"><a href="#10-类型别名" class="headerlink" title="10.类型别名"></a>10.类型别名</h2><blockquote>
<p>使用 <code>type</code> 给类型取别名</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/023c42358ecb40e995422df4febe9067~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809154354725"></p>
<h2 id="11-交叉类型"><a href="#11-交叉类型" class="headerlink" title="11.交叉类型"></a>11.交叉类型</h2><blockquote>
<p>用 <code>&amp;</code> 进行连接</p>
</blockquote>
<p>把类型都组合起来，变量赋值必须满足 交叉类型</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d117a98220c64842b191bfd52bc87b0a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210809155259634"></p>
<h2 id="结语："><a href="#结语：" class="headerlink" title="结语："></a>结语：</h2><blockquote>
<p>这篇文章是小浪3月多学TS时做的总结，写的不全面写的都是一些经常用到的，全面的话还得写很多很多。。。官方的文档 yyds ，不过大家可以通过这篇文章进行快速入门，，其实小浪用了TS一段时间了，感觉就是有些泛型写的很复杂，规范性很强，很多第三方库隐藏的类型搞不清楚，刚写的完全看不懂，每次写一个东西都要想着去定义类型，恨不得把电脑砸了…开玩笑的，还是得耐心</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a31f26491f7948689a2919d10e902e4a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<p>参考资料：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.tslang.cn%2Fdocs%2Fhandbook%2Fbasic-types.html" title="https://www.tslang.cn/docs/handbook/basic-types.html">TS官方文档</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/08/09/14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/08/09/14/" class="post-title-link" itemprop="url">快速上手 Vuex 到 手写简易 Vuex</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-09 02:11:14" itemprop="dateCreated datePublished" datetime="2021-08-09T02:11:14+08:00">2021-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="快速上手-Vuex-到-手写简易-Vuex"><a href="#快速上手-Vuex-到-手写简易-Vuex" class="headerlink" title="快速上手 Vuex 到 手写简易 Vuex"></a>快速上手 Vuex 到 手写简易 Vuex</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6994337441314242590">https://juejin.cn/post/6994337441314242590</a></p>
<blockquote>
<p>前言</p>
</blockquote>
<p>首先感谢各位这段时间对小浪的支持，小浪会继续努力的</p>
<p>今天本篇文章是关于 <code>Vuex</code>，大家使用 <code>Vue</code> 不会陌生吧</p>
<p>今天我们先对 <code>Vuex</code> 进行了解，然后讲下基本的用法，然后我们自己实现一个简易的 <code>Vuex</code></p>
<p>最后希望大家能给小浪一个 <strong>赞</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59bed0b088244e09ac9f88194d1dd7d0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<blockquote>
<p>往期精彩：</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6990582632270528525" title="https://juejin.cn/post/6990582632270528525">从了解到深入虚拟 DOM 和实现 diff 算法</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6989106100582744072" title="https://juejin.cn/post/6989106100582744072">手写一个简易 vue 响应式带你了解响应式原理</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6988316779818778631" title="https://juejin.cn/post/6988316779818778631">从使用到自己实现简单 Vue Router 看这个就行了</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6983934602196811789" title="https://juejin.cn/post/6983934602196811789">前端面试必不可少的基础知识，虽然少但是你不能不知道</a></p>
</blockquote>
<h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><blockquote>
<p><strong>Vuex</strong> 状态管理插件</p>
</blockquote>
<p>在<code>Vue</code> 最重要就是 <strong>数据驱动</strong> 和 <strong>组件化</strong>，每个 组件都有自己 <code>data</code> ,<code>template</code> 和 <code>methods</code>, <code>data</code>是数据，我们也叫做状态，通过<code>methods</code>中方法改变 状态来更新视图，在单个组件中修改状态更新视图是很方便的，但是实际开发中是多个组件（还有多层组件嵌套）共享同一个状态时，这个时候传参就会很繁琐，我们这里就引进 <code>Vuex</code> 来进行状态管理，负责组件中的通信，方便维护代码</p>
<blockquote>
<p>Vuex 主要解决的问题</p>
</blockquote>
<ul>
<li>多个视图依赖同一个状态</li>
<li>来自不同视图的行为需要变更同一个状态</li>
</ul>
<blockquote>
<p>使用 Vuex 的好处</p>
</blockquote>
<ul>
<li>能够在 <code>vuex</code> 中集中管理共享的数据，易于开发和后期维护</li>
<li>能够高效地实现组件之间的数据共享，提高开发效率</li>
<li>在 <code>vuex</code> 中的数据都是响应式的</li>
</ul>
<h2 id="2-Vuex-基础使用"><a href="#2-Vuex-基础使用" class="headerlink" title="2.Vuex 基础使用"></a>2.Vuex 基础使用</h2><blockquote>
<p>首先在 Vue 中添加 Vuex 插件</p>
</blockquote>
<p>通过 <code>vue-cli</code> 添加了 <code>Vuex</code> 后，在项目的 <code>src</code> 目录下会多出一个 <code>store</code> 目录，目录下会有个 <code>index.js</code></p>
<p>当然也通过 <code>npm</code> 进行安装 <code>Vuex</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex --save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在开发环境开启严格模式 这样修改数据 就必须通过 mutation 来处理</p>
</blockquote>
<p>在 package.json 文件 scripts 中可以设置环境，当我们处于开发环境时，可以开启严格模式</p>
<p>开启严格模式的方式也是很简单的一行代码就可以</p>
<p><code>strict:products.env.NODE_ENV !== &#39;production&#39;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue from <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vuex from <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.Store(&#123;</span><br><span class="line"></span><br><span class="line"> strict:products.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line"></span><br><span class="line"> state: &#123;</span><br><span class="line"> &#125;,</span><br><span class="line"></span><br><span class="line"> mutations: &#123;</span><br><span class="line"> &#125;,</span><br><span class="line"></span><br><span class="line"> actions: &#123;</span><br><span class="line"> &#125;,</span><br><span class="line"></span><br><span class="line"> modules: &#123;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要使用 store 就在把 store 挂载到 Vue 中</p>
</blockquote>
<p>把 store 挂载到 Vue 之后 ，所有的组件就可以直接从 store 中获取全局数据了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">&#125;).$mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="1-state"><a href="#1-state" class="headerlink" title="1.state"></a>1.state</h3><blockquote>
<p>在 state 中添加数据</p>
</blockquote>
<p>我们需要共享的状态都放在写在 state 对象里面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>组件中获取 state 中的数据</p>
</blockquote>
<p>获取到 <code>state</code> 有两种方式</p>
<h4 id="1-直接使用-this-store-state-属性-，（this-可以省略）"><a href="#1-直接使用-this-store-state-属性-，（this-可以省略）" class="headerlink" title="1.直接使用 this.$store.state\[属性\] ，（this 可以省略）"></a>1.直接使用 <code>this.$store.state\[属性\]</code> ，（<code>this</code> 可以省略）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; this.$store.state.name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &#123;&#123; this.$store.state.age &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-使用-mapState"><a href="#2-使用-mapState" class="headerlink" title="2.使用 mapState"></a>2.使用 <code>mapState</code></h4><p>通过 <code>mapState</code>把 <code>store</code> 映射到 组件的计算属性，就相当于组件内部有了 <code>state</code> 里的属性</p>
<p>知道这里为啥要用 <code>...</code>展开吗，到时候实现 <code>mapState</code> 时就知道了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &#123;&#123; age &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(\[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
</blockquote>
<p>当 store 中的值 和 当前组件有相同的状态，我们可以在 mapState 方法里传递一个对象 而不是一个数组，在对象中给状态起别名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line"></span><br><span class="line">    ...<span class="title function_">mapState</span>(&#123; <span class="attr">name2</span>: <span class="string">&#x27;name&#x27;</span>, <span class="attr">age2</span>: <span class="string">&#x27;age&#x27;</span>&#125;\])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Mutation"><a href="#2-Mutation" class="headerlink" title="2.Mutation"></a>2.Mutation</h3><p><code>Store</code> 中的状态不能直接对其进行操作，我们得使用 <code>Mutation</code> 来对 <code>Store</code> 中的状态进行修改，虽然看起来有些繁琐，但是方便集中监控数据的变化</p>
<p><code>state</code> 的更新必须是 <code>Mutation</code> 来处理</p>
<blockquote>
<p>我们现在 mutaions 里定义个方法</p>
</blockquote>
<p>如果想要定义的方法能够修改 <code>Store</code> 中的状态，需要参数就是 <code>state</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line"> <span class="attr">state</span>: &#123;</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">   <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">mutations</span>: &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    \*</span><br><span class="line">    \* @param &#123;*&#125; state 第一个参数是 <span class="title class_">Store</span> 中的状态(必须传递)</span><br><span class="line">    \* @param &#123;*&#125; newName 传入的参数 后面是多个</span><br><span class="line">    */</span><br><span class="line">   <span class="title function_">changeName</span>(<span class="params">state, newName</span>) &#123;</span><br><span class="line"></span><br><span class="line">     state.<span class="property">name</span> = newName</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">actions</span>: &#123;&#125;,</span><br><span class="line"> <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在组件中使用 mutations 中的方法</p>
</blockquote>
<p>同样有两种方法在组件触发 <code>mutations</code> 中的方法</p>
<h4 id="1-this-store-commit-触发"><a href="#1-this-store-commit-触发" class="headerlink" title="1.this.$store.commit() 触发"></a>1.this.$store.commit() 触发</h4><p>在 <code>methods</code> 中定义一个方法，在这个方法里面进行触发 <code>mutations</code> 中的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>方式1 按钮使用 mutation 中方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(\[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;changeName&#x27;</span>, <span class="string">&#x27;小浪&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="2-使用-mapMutations"><a href="#2-使用-mapMutations" class="headerlink" title="2.使用 mapMutations"></a>2.使用 <code>mapMutations</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName(&#x27;小浪&#x27;)&quot;</span>&gt;</span>方式2 按钮使用 mutation 中方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(\[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapMutations</span>(\[<span class="string">&#x27;changeName&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="3-Action"><a href="#3-Action" class="headerlink" title="3.Action"></a>3.Action</h3><blockquote>
<p><code>Action</code> 和 <code>Mutation</code> 区别</p>
</blockquote>
<p><code>Action</code> 同样也是用来处理任务，不过它处理的是异步任务，异步任务必须要使用 <code>Action</code>，通过 <code>Action</code> 触发 <code>Mutation</code> 间接改变状态，不能直接使用 <code>Mutation</code> 直接对异步任务进行修改</p>
<blockquote>
<p>先在 <code>Action</code> 中定义一个异步方法来调用 <code>Mutation</code> 中的方法</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line"> <span class="attr">state</span>: &#123;</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">   <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">mutations</span>: &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    \*</span><br><span class="line">    \* @param &#123;*&#125; state 第一个参数是 <span class="title class_">Store</span> 中的状态(必须传递)</span><br><span class="line">    \* @param &#123;*&#125; newName 传入的参数 后面是多个</span><br><span class="line">    */</span><br><span class="line">   <span class="title function_">changeName</span>(<span class="params">state, newName</span>) &#123;</span><br><span class="line"></span><br><span class="line">     state.<span class="property">name</span> = newName</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">actions</span>: &#123;</span><br><span class="line"></span><br><span class="line">    \*</span><br><span class="line">    \* @param &#123;*&#125; context 上下文默认传递的参数</span><br><span class="line">    \* @param &#123;*&#125; newName 自己传递的参数</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">   <span class="title function_">changeNameAsync</span>(<span class="params">context, newName</span>) &#123;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">       context.<span class="title function_">commit</span>(<span class="string">&#x27;changeName&#x27;</span>, newName)</span><br><span class="line">     &#125;, <span class="number">2000</span>)</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在组件中是 Action 中的异步方法也是有两种方式</p>
<h4 id="1-this-store-dispatch"><a href="#1-this-store-dispatch" class="headerlink" title="1.this.$store.dispatch()"></a>1.<code>this.$store.dispatch()</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName2(&#x27;小浪&#x27;)&quot;</span>&gt;</span>方式1 按钮使用 action 中方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(\[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">changeName2</span>(<span class="params">newName</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;changeNameAsync&#x27;</span>, newName)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="2-使用-mapActions"><a href="#2-使用-mapActions" class="headerlink" title="2.使用 mapActions"></a>2.使用 <code>mapActions</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeNameAsync(&#x27;小浪&#x27;)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      方式2 按钮使用 action 中方法</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapMutations, mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(\[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapActions</span>(\[<span class="string">&#x27;changeNameAsync&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="4-Getter"><a href="#4-Getter" class="headerlink" title="4.Getter"></a>4.Getter</h3><blockquote>
<p>简介</p>
</blockquote>
<p><code>Getter</code> 类似于计算属性，但是我们的数据来源是 <code>Vuex</code> 中的 <code>state</code> ,所以就使用 <code>Vuex</code> 中的 <code>Getter</code> 来完成</p>
<blockquote>
<p>应用场景</p>
</blockquote>
<p>需要对 <code>state</code> 做一些包装简单性处理 展示到视图当中</p>
<blockquote>
<p>先来写个 Getter</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line"> <span class="attr">state</span>: &#123;</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">   <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">getters</span>: &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    \*</span><br><span class="line">    \* @param &#123;*&#125; state 状态 如果要使用 state 里面的数据，第一个参数默认就是 state ，名字随便取</span><br><span class="line">    \* @returns</span><br><span class="line">    */</span><br><span class="line">   <span class="title function_">decorationName</span>(<span class="params">state</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">`大家好我的名字叫<span class="subst">$&#123;state.name&#125;</span>今年<span class="subst">$&#123;state.age&#125;</span>岁`</span></span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当然 <code>Getter</code> 也有两种方式导入</p>
<h4 id="1-this-store-getters-名称"><a href="#1-this-store-getters-名称" class="headerlink" title="1.this.$store.getters\[名称\]"></a>1.<code>this.$store.getters\[名称\]</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; this.$store.getters.decorationName &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-使用-mapGetters"><a href="#2-使用-mapGetters" class="headerlink" title="2.使用 mapGetters"></a>2.使用 <code>mapGetters</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; decorationName &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapGetters</span>(\[<span class="string">&#x27;decorationName&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="5-Module"><a href="#5-Module" class="headerlink" title="5.Module"></a>5.Module</h3><p>为了避免在一个复杂的项目 <code>state</code> 中的数据变得臃肿，<code>Vuex</code> 允许将 <code>Store</code> 分成不同的模块，每个模块都有属于自己的 <code>state</code>，<code>getter</code>，<code>action</code>，<code>mutation</code></p>
<blockquote>
<p>我们这里新建一个 <code>animal.js</code> 文件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">animalName</span>: <span class="string">&quot;狮子&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">setName</span>(<span class="params">state, newName</span>) &#123;</span><br><span class="line">    state.<span class="property">animalName</span> = newName;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 <code>store/index.js</code>中的 <code>modules</code> 进行挂载这个模块</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> animal <span class="keyword">from</span> <span class="string">&quot;./animal&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    animal,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后我们就可以在组件中使用了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; this.$store.state.animal.animalName &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;setName&#x27;, &#x27;老虎&#x27;)&quot;</span>&gt;</span>改名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p><code>$store.state\[在module中挂载的模块名\]\[挂载的模块里的属性\]</code></p>
<p>是不是觉得这种模式很复杂</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2984822b759a4bb8a8c04c4748c5f9f2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<blockquote>
<p>添加命名空间</p>
</blockquote>
<p>其实也可以使用 <code>mapXXX</code> 方法进行映射，不过写法有些许不同，先在导出的添加一个<strong>命名空间</strong><code>namespaced: true</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">animalName</span>: <span class="string">&quot;狮子&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">setName</span>(<span class="params">state, newName</span>) &#123;</span><br><span class="line">    state.<span class="property">animalName</span> = newName;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>方式 2</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; animalName &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;setName(&#x27;老鹰&#x27;)&quot;</span>&gt;</span>改名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(<span class="string">&#x27;animal&#x27;</span>, \[<span class="string">&#x27;animalName&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapMutations</span>(<span class="string">&#x27;animal&#x27;</span>, \[<span class="string">&#x27;setName&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="3-模拟一个简单的-Vuex"><a href="#3-模拟一个简单的-Vuex" class="headerlink" title="3.模拟一个简单的 Vuex"></a>3.模拟一个简单的 Vuex</h2><p>上面我们已经介绍了 <code>Vuex</code> 的基本使用，现在我们来自己动手写个简单 <code>Vuex</code></p>
<p>代码我都会写满注释方便大家观看，代码很少，有兴趣，大家耐心观看 ヽ(￣ ▽ ￣)ﾉ</p>
<h3 id="1-index-js"><a href="#1-index-js" class="headerlink" title="1.index.js"></a>1.index.js</h3><blockquote>
<p>先搭个基本的架子</p>
</blockquote>
<p>我们在 <code>src</code> 目录下 建立一个属于我们自己的 <code>Vuex</code> 的文件夹，并且在这个目录下添加一个 <code>index.js</code> 文件，我们要模拟的这个 <code>Vuex</code> 就会放在这里面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install,</span><br><span class="line">  <span class="title class_">Store</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2-install-方法"><a href="#2-install-方法" class="headerlink" title="2.install 方法"></a>2.install 方法</h3><blockquote>
<p>因为 Vuex 插件 需要 Vue.use() 安装，所以我们必须要有个 install 方法，第一个参数 传入 Vue</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line">  _Vue = <span class="title class_">Vue</span>;</span><br><span class="line"></span><br><span class="line">  _Vue.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">    <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">store</span>) &#123;</span><br><span class="line">        _Vue.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">store</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3.我们继续来实现 <code>Store</code> 类</p>
</blockquote>
<p>先完成基础的 构造方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> state = options.<span class="property">state</span> || &#123;&#125;</span><br><span class="line">   <span class="keyword">const</span> mutations = options.<span class="property">mutations</span> || &#123;&#125;</span><br><span class="line">   <span class="keyword">const</span> actions = options.<span class="property">actions</span> || &#123;&#125;</span><br><span class="line">   <span class="keyword">const</span> getters = options.<span class="property">getters</span> || &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着，我们来实现 <code>state</code>,<code>getters</code>,<code>mutations</code>,<code>actions</code>,<code>commit</code>,<code>dispatch</code> 吧</p>
<p>( ﾟ ▽ ﾟ)/</p>
<h3 id="3-state"><a href="#3-state" class="headerlink" title="3.state"></a>3.state</h3><p>是不是超简单，直接调用 <code>Vue</code> 的 <code>observable</code> 把 <code>state</code> 变成响应式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = _Vue.<span class="title function_">observable</span>(state);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-getters"><a href="#4-getters" class="headerlink" title="4.getters"></a>4.getters</h3><p>为每一个 <code>getters</code> 里面的 方法添加了一个 <code>get</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">getters</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="title class_">Object</span>.<span class="title function_">keys</span>(getters).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>.<span class="property">getters</span>, key, &#123;</span><br><span class="line"></span><br><span class="line">       <span class="attr">get</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> getters\[key\].<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">       &#125;,</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-mutations"><a href="#5-mutations" class="headerlink" title="5.mutations"></a>5.mutations</h3><p>这里改变 <code>this</code> 指向</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">mutations</span> = &#123;&#125;</span><br><span class="line">   <span class="title class_">Object</span>.<span class="title function_">keys</span>(mutations).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">mutations</span>\[key\] = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">       mutations\[key\].<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">state</span>, params)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-actions"><a href="#6-actions" class="headerlink" title="6.actions"></a>6.actions</h3><p>其实呢，和上面的 <code>mutations</code> 处理方式差不多，不过参数 传递的不一样，需要传递 上下文 <code>context</code> 也就是 <code>Store</code> 的一个实例，这里就是 <code>this</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">actions</span> = &#123;&#125;</span><br><span class="line">   <span class="title class_">Object</span>.<span class="title function_">keys</span>(actions).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">actions</span>\[key\] = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">       actions\[key\].<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>, params)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-commit"><a href="#7-commit" class="headerlink" title="7.commit"></a>7.commit</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> commit = <span class="function">(<span class="params">eventName, params</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">mutations</span>\[eventName\](params)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-dispatch"><a href="#8-dispatch" class="headerlink" title="8.dispatch"></a>8.dispatch</h3><p><code>dispatch</code> 和 <code>commit</code> 实现差不多</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> dispatch = <span class="function">(<span class="params">eventName, params</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">actions</span>\[eventName\](params)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，到了这里差不多，一个丐版的 <code>Vuex</code> 就这样诞生了，我们写个例子去测试下吧</p>
<h3 id="9-测试例子"><a href="#9-测试例子" class="headerlink" title="9.测试例子"></a>9.测试例子</h3><blockquote>
<p>先导入我们自己写的 <code>Vuex</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;../my-vuex/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">changeName</span>(<span class="params">state, newName</span>) &#123;</span><br><span class="line">      state.<span class="property">name</span> = newName;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">changeNameAsync</span>(<span class="params">context, newName</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        context.<span class="title function_">commit</span>(<span class="string">&quot;changeName&quot;</span>, newName);</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title function_">decorationName</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`大家好我的名字叫<span class="subst">$&#123;state.name&#125;</span>今年<span class="subst">$&#123;state.age&#125;</span>岁`</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一个简单的 <code>vue</code> 组件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是 state 测试：&#123;&#123; this.$store.state.name &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是 getters 测试:&#123;&#123; this.$store.getters.decorationName &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;changeName&#x27;, &#x27;mutations 按钮&#x27;)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      mutations 按钮</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.dispatch(&#x27;changeNameAsync&#x27;, &#x27;actions 按钮&#x27;)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      actions 按钮</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 mian.js 还是之前一样的挂载没改</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">&#125;).$mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子预览</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9cd6338c699643dc9ca1b853d7749170~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="27"></p>
<p>到了这里并不是结束了，不如简单实现一下 几个 <code>mapXXX</code> ,实现起来都差不多</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df85a4edd845442292c66c3fc9fff38d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<h3 id="10-mapSate"><a href="#10-mapSate" class="headerlink" title="10.mapSate"></a>10.mapSate</h3><p><code>...mapSate(\[&#39;age&#39;,\[&#39;name&#39;\]\])</code> ,最后 <code>computed</code> 得到的就是 <code>age</code>: <code>21</code>, <code>name</code> : <code>&#39;张三&#39;</code> 这样，就可以在 组件中直接使用了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">mapState</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    obj\[item\] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>\[item\]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-mapMutations"><a href="#11-mapMutations" class="headerlink" title="11.mapMutations"></a>11.mapMutations</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">mapMutations</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    obj\[item\] = <span class="keyword">function</span>(<span class="params">params</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(item, params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-mapActions"><a href="#12-mapActions" class="headerlink" title="12.mapActions"></a>12.mapActions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">mapActions</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    obj\[item\] = <span class="keyword">function</span>(<span class="params">params</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(item, params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-mapGetters"><a href="#13-mapGetters" class="headerlink" title="13.mapGetters"></a>13.mapGetters</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">mapGetters</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    obj\[item\] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>\[item\]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-导出和使用"><a href="#14-导出和使用" class="headerlink" title="14.导出和使用"></a>14.导出和使用</h3><blockquote>
<p>最后就是导出</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; mapState, mapMutations, mapActions, mapGetters &#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用方法和之前一样</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName(&#x27;狗子&#x27;)&quot;</span>&gt;</span>mapMutations<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeNameAsync(&#x27;狗2子&#x27;)&quot;</span>&gt;</span>mapMutations<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; decorationName &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &#123;&#123; age &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapMutations, mapActions, mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;./my-vuex/index&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>(\[<span class="string">&#x27;age&#x27;</span>\]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapGetters</span>(\[<span class="string">&#x27;decorationName&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapMutations</span>(\[<span class="string">&#x27;changeName&#x27;</span>\]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapActions</span>(\[<span class="string">&#x27;changeNameAsync&#x27;</span>\])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">...</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-结语"><a href="#3-结语" class="headerlink" title="3.结语"></a>3.结语</h2><p>好了到了这里，关于 <code>Vuex</code> 本文就结束了，我们从 <code>Vuex</code> 是啥，怎么使用，动手实现一个简单 <code>Vuex</code> 我们都完成了，希望大家有所收获</p>
<p>下面把完成的我们模拟的 <code>Vuex</code> 代码贴出，欢迎大家，多多交流，有什么写错的地方，请大家指出</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7625b7e187b4616bb13da4653decfef~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p>
<h3 id="模拟-Vuex-完整代码"><a href="#模拟-Vuex-完整代码" class="headerlink" title="模拟 Vuex 完整代码"></a>模拟 <code>Vuex</code> 完整代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> state = options.<span class="property">state</span> || &#123;&#125;</span><br><span class="line">   <span class="keyword">const</span> mutations = options.<span class="property">mutations</span> || &#123;&#125;</span><br><span class="line">   <span class="keyword">const</span> actions = options.<span class="property">actions</span> || &#123;&#125;</span><br><span class="line">   <span class="keyword">const</span> getters = options.<span class="property">getters</span> || &#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">state</span> = _Vue.<span class="title function_">observable</span>(state)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">getters</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="title class_">Object</span>.<span class="title function_">keys</span>(getters).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>.<span class="property">getters</span>, key, &#123;</span><br><span class="line"></span><br><span class="line">       <span class="attr">get</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> getters\[key\].<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">       &#125;,</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">mutations</span> = &#123;&#125;</span><br><span class="line">   <span class="title class_">Object</span>.<span class="title function_">keys</span>(mutations).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">mutations</span>\[key\] = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">       mutations\[key\].<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">state</span>, params)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">actions</span> = &#123;&#125;</span><br><span class="line">   <span class="title class_">Object</span>.<span class="title function_">keys</span>(actions).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">actions</span>\[key\] = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">       actions\[key\].<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>, params)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> commit = <span class="function">(<span class="params">eventName, params</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">mutations</span>\[eventName\](params)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> dispatch = <span class="function">(<span class="params">eventName, params</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">actions</span>\[eventName\](params)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line"> _Vue = <span class="title class_">Vue</span></span><br><span class="line"></span><br><span class="line"> _Vue.<span class="title function_">mixin</span>(&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">store</span>) &#123;</span><br><span class="line"></span><br><span class="line">       _Vue.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$store</span> = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">store</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapState</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">   obj\[item\] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>\[item\]</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapMutations</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">   obj\[item\] = <span class="keyword">function</span>(<span class="params">params</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(item, params)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapActions</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">   obj\[item\] = <span class="keyword">function</span>(<span class="params">params</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(item, params)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapGetters</span> = (<span class="params">params</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(params))</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;抱歉，当前是丐版的Vuex，只支持数组参数&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> params.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">   obj\[item\] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>\[item\]</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; mapState, mapMutations, mapActions, mapGetters &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> install,</span><br><span class="line"> <span class="title class_">Store</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/07/30/13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/07/30/13/" class="post-title-link" itemprop="url">从了解到深入虚拟dom和实现diff算法虚拟dom算法</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-30 09:14:13" itemprop="dateCreated datePublished" datetime="2021-07-30T09:14:13+08:00">2021-07-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="从了解到深入虚拟DOM和实现diff算法虚拟DOM-和-diff-算法"><a href="#从了解到深入虚拟DOM和实现diff算法虚拟DOM-和-diff-算法" class="headerlink" title="从了解到深入虚拟DOM和实现diff算法虚拟DOM 和 diff 算法"></a>从了解到深入虚拟DOM和实现diff算法虚拟DOM 和 diff 算法</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6990582632270528525">https://juejin.cn/post/6990582632270528525</a></p>
<blockquote>
<p>前言</p>
</blockquote>
<p><code>虚拟DOM</code> 和 <code>diff</code> 算法 ，大家有的时候就会经常听到，那么它们是什么实现的呢，这是小浪我在学习的 <code>虚拟DOM</code> 和 <code>diff</code> 的时候总结，在这里就来带大家来深入了解 <code>virtual DOM</code> 和 <code>diff</code> 算法，从 <strong>snabbdom</strong> 的基础使用 ,到自己实现一个丐版 <strong>snabbdom</strong>，自己实现 <strong>h函数</strong>(创建虚拟DOM) <strong>patch</strong>函数(通过比较新旧虚拟DOM更新视图)，这里我也画了几个动图 来帮助大家理解 <strong>diff</strong> 的四种优化策略，文章有点长，希望大家耐心阅读，最后会贴出所有代码，大家可以动手试试喔</p>
<p>最后希望大家能给小浪一个 <strong>赞</strong></p>
<blockquote>
<p>往期精彩：</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6989106100582744072" title="https://juejin.cn/post/6989106100582744072">手写一个简易vue响应式带你了解响应式原理</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6988316779818778631" title="https://juejin.cn/post/6988316779818778631">从使用到自己实现简单Vue Router看这个就行了</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6983934602196811789" title="https://juejin.cn/post/6983934602196811789">前端面试必不可少的基础知识，虽然少但是你不能不知道</a></p>
</blockquote>
<h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><blockquote>
<p><strong>Virtual DOM</strong> 简单的介绍</p>
</blockquote>
<p>是<code>JavaScript</code>按照<code>DOM</code>的结构来创建的虚拟树型结构对象，是对<code>DOM</code>的抽象，比<code>DOM</code>更加轻量型</p>
<blockquote>
<p>为啥要使用<strong>Virtual DOM</strong></p>
</blockquote>
<ul>
<li>当然是前端优化方面，避免频繁操作<code>DOM</code>，频繁操作<code>DOM</code>会可能让浏览器回流和重绘，性能也会非常低，还有就是手动操作 <code>DOM</code> 还是比较麻烦的，要考虑浏览器兼容性问题，当前<code>jQuery</code>等库简化了 <code>DOM</code>操作，但是项目复杂了，<code>DOM</code>操作还是会变得复杂，数据操作也变得复杂</li>
<li>并不是所有情况使用虚拟<code>DOM</code> 都提高性能，是针对在复杂的的项目使用。如果简单的操作，使用虚拟<code>DOM</code>,要创建虚拟<code>DOM</code>对象等等一系列操作，还不如普通的<code>DOM</code> 操作</li>
<li>虚拟<code>DOM</code> 可以实现跨平台渲染，服务器渲染 、小程序、原生应用都使用了虚拟<code>DOM</code></li>
<li>使用虚拟<code>DOM</code>改变了当前的状态不需要立即的去更新<code>DOM</code> 而且更新的内容进行更新，对于没有改变的内容不做任何操作，通过前后两次差异进行比较</li>
<li>虚拟 DOM 可以维护程序的状态，跟踪上一次的状态</li>
</ul>
<h2 id="2-snabbdom-介绍"><a href="#2-snabbdom-介绍" class="headerlink" title="2.snabbdom 介绍"></a>2.snabbdom 介绍</h2><blockquote>
<p>首先来介绍下 snabbdom</p>
</blockquote>
<p>我们要了解虚拟DOM ，那么就先了解它的始祖，也就是 <strong>snabbdom</strong></p>
<p><strong>snabbdom</strong> 是一个开源的项目，<strong>Vue</strong> 里面的 虚拟<strong>DOM</strong> 当初是借鉴了 <strong>snabbdom</strong>,我们可以通过了解<strong>snabbdom</strong> 的虚拟<strong>DOM</strong> 来理解 <strong>Vue</strong> 的虚拟<strong>DOM</strong>,<strong>Vue</strong> 的源码太多，<strong>snabbdom</strong> 比较简洁，所以用它来展开 虚拟 <strong>DOM</strong> 的研究</p>
<p>通过npm 进行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install snabbdom</span><br></pre></td></tr></table></figure>
<h3 id="1-snabbdom简单使用"><a href="#1-snabbdom简单使用" class="headerlink" title="1.snabbdom简单使用"></a>1.snabbdom简单使用</h3><blockquote>
<p>下面来写个简单的例子使用下 snabbdom</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/test.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>写个 test.js 进行使用</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, init, thunk &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> patch = <span class="title function_">init</span>(\[\])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode = <span class="title function_">h</span>(<span class="string">&#x27;div#box&#x27;</span>, <span class="string">&#x27;测试&#x27;</span>, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;ul.list&#x27;</span>, \[</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">  \]),</span><br><span class="line">\])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oldNode = <span class="title function_">patch</span>(app, vnode)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> vNode = <span class="title function_">h</span>(<span class="string">&#x27;div#box&#x27;</span>, <span class="string">&#x27;重新获取了数据&#x27;</span>, \[</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;ul.list&#x27;</span>, \[</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;通过path判断了差异性&#x27;</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;更新了数据&#x27;</span>),</span><br><span class="line">    \]),</span><br><span class="line">  \])</span><br><span class="line"></span><br><span class="line">  <span class="title function_">patch</span>(oldNode, vNode)</span><br><span class="line">&#125;, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93f5b5f17b44461485732581e68afd90~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210726224703891"></p>
<p>可以看见把 虚拟<strong>DOM</strong>更新到了 真实<strong>DOM</strong> ,直接 把之前的 <strong>div#app</strong> 给替换更新了</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33bb43d23ef649e58cca26cf4e6290a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="9"></p>
<p>过了3秒进行对比虚拟<strong>DOM</strong> 的 差异来添加到真实<strong>DOM</strong> ，这里改变了第二个和第三个 <strong>li</strong> 用h函数渲染成虚拟<strong>DOM</strong> 和<strong>oldNode</strong> 不一样所以进行了对比更新</p>
<h3 id="2-介绍下-snabbdom中的模块"><a href="#2-介绍下-snabbdom中的模块" class="headerlink" title="2.介绍下 snabbdom中的模块"></a>2.介绍下 snabbdom中的模块</h3><blockquote>
<p>几个模块 这里简单过一下</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>模块名</th>
<th>简介</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>attributes</strong></td>
<td>DOM 自定义属性，包括两个布尔值 <code>checked``selected</code>，通过<code>setAttribute()</code> 设置</td>
</tr>
<tr>
<td><strong>props</strong></td>
<td>是DOM 的 property属性，通过 <code>element\[attr\] = value</code> 设置</td>
</tr>
<tr>
<td><strong>dataset</strong></td>
<td>是 <code>data-</code> 开头的属性 data-src…</td>
</tr>
<tr>
<td><strong>style</strong></td>
<td>行内样式</td>
</tr>
<tr>
<td><strong>eventListeners</strong></td>
<td>用来注册和移除事件</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>有了上面的介绍，那我们就来简单的使用一下</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, init &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> attr <span class="keyword">from</span> <span class="string">&#x27;snabbdom/modules/attributes&#x27;</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;snabbdom/modules/style&#x27;</span></span><br><span class="line"><span class="keyword">import</span> eventListeners <span class="keyword">from</span> <span class="string">&#x27;snabbdom/modules/eventlisteners&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> patch = <span class="title function_">init</span>(\[attr, style, eventListeners\])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode = <span class="title function_">h</span>(</span><br><span class="line">  <span class="string">&#x27;div#app&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">attrs</span>: &#123;</span><br><span class="line">      <span class="attr">myattr</span>: <span class="string">&#x27;我是自定义属性&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">      <span class="attr">fontSize</span>: <span class="string">&#x27;29px&#x27;</span>,</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;skyblue&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">on</span>: &#123;</span><br><span class="line">      <span class="attr">click</span>: clickHandler,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;我是内容&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clickHandler</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> elm = <span class="variable language_">this</span>.<span class="property">elm</span></span><br><span class="line">  elm.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;red&#x27;</span></span><br><span class="line">  elm.<span class="property">textContent</span> = <span class="string">&#x27;我被点击了&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">patch</span>(app, vnode)</span><br></pre></td></tr></table></figure>
<p>然后再 <code>html</code> 中引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/module_test.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>来看看效果</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1875f83c496e4ad282639c099b510ac9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="11"></p>
<p>可以看见的是 自定义属性 ，行内样式 ，点击事件都被 <strong>h()</strong> 渲染出来了</p>
<p>上面的使用都简单地过了一遍，那么我们就来看看 <strong>snabbdom</strong> 中的源码吧</p>
<h2 id="3-虚拟DOM-例子"><a href="#3-虚拟DOM-例子" class="headerlink" title="3.虚拟DOM 例子"></a>3.虚拟DOM 例子</h2><p>说了这么久的 <strong>h()</strong> 函数和 虚拟<strong>DOM</strong> 那么 渲染出来的 虚拟<strong>DOM</strong> 是什么样呢</p>
<blockquote>
<p>真实DOM 结构</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>哈哈<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>转为为 虚拟DOM 之后的结构</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;sel&quot;</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;class&quot;</span>: &#123; <span class="string">&quot;container&quot;</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;elm&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;key&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;children&quot;</span>: \[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;elm&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">      <span class="string">&quot;key&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">      <span class="string">&quot;sel&quot;</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">      <span class="string">&quot;data&quot;</span>: &#123; <span class="string">&quot;text&quot;</span>: <span class="string">&quot;哈哈&quot;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;elm&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">      <span class="string">&quot;key&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">      <span class="string">&quot;sel&quot;</span>: <span class="string">&quot;ul&quot;</span>,</span><br><span class="line">      <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;class&quot;</span>: &#123; <span class="string">&quot;list&quot;</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;children&quot;</span>: \[</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;elm&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">          <span class="string">&quot;sel&quot;</span>: <span class="string">&quot;li&quot;</span>,</span><br><span class="line">          <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;children&quot;</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;elm&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="literal">undefined</span>,</span><br><span class="line">          <span class="string">&quot;sel&quot;</span>: <span class="string">&quot;li&quot;</span>,</span><br><span class="line">          <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;children&quot;</span>: <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">      \]</span><br><span class="line">    &#125;</span><br><span class="line">  \]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在之前提到的 <code>snabbdom</code> 中 <code>patch</code>方法</p>
<p>就是对 <strong>新的虚拟DOM</strong> 和 <strong>老的虚拟DOM</strong> 进行<strong>diff</strong>(精细化比较)，找出最小量更新 是在虚拟<strong>DOM</strong> 比较</p>
<p>不可能把所有的 <strong>DOM</strong> 都拆掉 然后全部重新渲染</p>
<h2 id="4-h-函数"><a href="#4-h-函数" class="headerlink" title="4.h 函数"></a>4.h 函数</h2><p>在上面我们体验了<strong>虚拟DOM</strong>的使用 ，那么我们现在来实现一个 丐版的 <strong>snabbdom</strong></p>
<blockquote>
<p>h 函数在介绍下</p>
</blockquote>
<p>在 <strong>snabbdom</strong> 我们也使用了多次的 <strong>h</strong> 函数，主要作用是创建 虚拟节点</p>
<p><strong>snabbdom</strong> 使用 <strong>TS</strong> 编写, 所以 <strong>h</strong> 函数中做了 <strong>方法重载</strong> 使用起来灵活</p>
<p>下面是 <strong>snabbdom</strong> 中 <strong>h</strong> 函数，可以看出 参数的有好几种方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> declare <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">sel: string</span>): <span class="title class_">VNode</span>;</span><br><span class="line"><span class="keyword">export</span> declare <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">sel: string, data: VNodeData</span>): <span class="title class_">VNode</span>;</span><br><span class="line"><span class="keyword">export</span> declare <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">sel: string, children: VNodeChildren</span>): <span class="title class_">VNode</span>;</span><br><span class="line"><span class="keyword">export</span> declare <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">sel: string, data: VNodeData, children: VNodeChildren</span>): <span class="title class_">VNode</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实现 vnode 函数</p>
</blockquote>
<p>在写 <strong>h</strong> 函数之前 先实现 <strong>vnode</strong> 函数，<strong>vnode</strong> 函数要在 <strong>h</strong> 中使用， 其实这个 <strong>vnode</strong> 函数实现功能非常简单 在 <strong>TS</strong> 里面规定了很多类型，不过我这里和之后都是 用 <strong>JS</strong> 去写</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">\* 把传入的 参数 作为 对象返回</span><br><span class="line"> \* @param &#123;string&#125; sel 选择器</span><br><span class="line"> \* @param &#123;object&#125; data 数据</span><br><span class="line"> \* @param &#123;array&#125; children 子节点</span><br><span class="line"> \* @param &#123;string&#125; text 文本</span><br><span class="line"> \* @param &#123;dom&#125; elm <span class="variable constant_">DOM</span></span><br><span class="line"> \* @returns object</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">sel, data, children, text, elm</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; sel, data, children, text, elm &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实现简易 h 函数</p>
</blockquote>
<p>这里写的 h 函数 只实现主要功能，没有实现重载，直接实现 3个 参数的 h 函数</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&#x27;./vnode&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;string&#125; a sel</span><br><span class="line"> \* @param &#123;object&#125; b data</span><br><span class="line"> \* @param &#123;any&#125; c 是子节点 可以是文本，数组</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &lt; <span class="number">3</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;请检查参数个数&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> c === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> c === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(a, b, <span class="literal">undefined</span>, c, <span class="literal">undefined</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(c)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> children = \[\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!(<span class="keyword">typeof</span> c\[i\] === <span class="string">&#x27;object&#x27;</span> &amp;&amp; c\[i\].<span class="property">sel</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;第三个参数为数组时只能传递 h() 函数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      children.<span class="title function_">push</span>(c\[i\])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(a, b, children, <span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> c === <span class="string">&#x27;object&#x27;</span> &amp;&amp; c.<span class="property">sel</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> children = \[c\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(a, b, children, <span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是不是很简单呢，他说起来也不是递归，像是一种嵌套，不断地收集 <strong>{sel,data,children,text,elm}</strong></p>
<p><strong>chirldren</strong> 里面再套 <strong>{sel,data,children,text,elm}</strong></p>
<blockquote>
<p>举个例子</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h <span class="keyword">from</span> <span class="string">&#x27;./my-snabbdom/h&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode = <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123;&#125;,</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">  ),</span><br><span class="line">\])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vnode)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/virtualdir/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/942b20c050664ddb82a4073c95198075~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210727204731661"></p>
<p><strong>OK</strong>，写的 <strong>h</strong> 函数没有问题，生成了虚拟<strong>DOM</strong> 树，生成了虚拟 DOM,我们之后 就会用的到</p>
<p>简单说下流程吧</p>
<p>大家都知道<code>js</code> 函数执行，当然是先执行最里面的 函数</p>
<ul>
<li><p>1.<code>h(&#39;li&#39;, &#123;&#125;, &#39;我是一个li&#39;)</code>第一个执行 返回的 <code>&#123;sel,data,children,text,elm&#125;</code> 连续三个 li 都是这个</p>
</li>
<li><p>2.接着就是 <code>h(&#39;ul&#39;, &#123;&#125;, \[\])</code> 进入到了第二个判断是否为数组，然后 把每一项 进行判断是否对象 和 有<strong>sel</strong> 属性，然后添加到 <strong>children</strong> 里面又返回了出去 <code>&#123;sel,data,children,text,elm&#125;</code></p>
</li>
<li><p>3.第三就是执行 <code>h(&#39;div&#39;, &#123;&#125;,h())</code> 了， 第三个参数 直接是 <code>h()</code>函数 = <code>&#123;sel,data,children,text,elm&#125;</code> ，他的 <strong>children</strong> 把他用 <strong>[ ]</strong> 包起来</p>
<p>再返回给 <strong>vnode</strong></p>
</li>
</ul>
<h2 id="5-patch-函数"><a href="#5-patch-函数" class="headerlink" title="5.patch 函数"></a>5.patch 函数</h2><blockquote>
<p>简介</p>
</blockquote>
<p>在 <strong>snabbdom</strong> 中我们 通过 <strong>init()</strong> 返回了一个 <strong>patch</strong> 函数，通过 <strong>patch</strong> 进行吧比较两个 虚拟 DOM 然后添加的 真实的 <strong>DOM</strong> 树上，中间比较就是我们等下要说的 <strong>diff</strong></p>
<p>先来了解下 <strong>patch</strong>里面做了什么</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58f567538c1d4cffa7264cf5467ed271~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210728172052418"></p>
<p>按照上面的流程我们来写个简单的 <strong>patch</strong></p>
<h3 id="1-patch"><a href="#1-patch" class="headerlink" title="1.patch"></a>1.patch</h3><blockquote>
<p>先写个sameVnode</p>
</blockquote>
<p>用来对比两个虚拟<strong>DOM</strong> 的 <strong>key</strong> 和 <strong>sel</strong></p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">\* 判断两个虚拟节点是否是同一节点</span><br><span class="line"> \* @param &#123;vnode&#125; vnode1 虚拟节点<span class="number">1</span></span><br><span class="line"> \* @param &#123;vnode&#125; vnode2 虚拟节点<span class="number">2</span></span><br><span class="line"> \* @returns boolean</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">sameVnode</span>(<span class="params">vnode1, vnode2</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    (vnode1.<span class="property">data</span> ? vnode1.<span class="property">data</span>.<span class="property">key</span> : <span class="literal">undefined</span>) ===</span><br><span class="line">      (vnode2.<span class="property">data</span> ? vnode2.<span class="property">data</span>.<span class="property">key</span> : <span class="literal">undefined</span>) &amp;&amp; vnode1.<span class="property">sel</span> === vnode2.<span class="property">sel</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>写个基础的patch</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&#x27;./vnode&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;vnode/<span class="variable constant_">DOM</span>&#125; oldVnode</span><br><span class="line"> \* @param &#123;vnode&#125; newVnode</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">oldVnode, newVnode</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!oldVnode.<span class="property">sel</span>) &#123;</span><br><span class="line"></span><br><span class="line">    oldVnode = <span class="title function_">emptyNodeAt</span>(oldVnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldVnode, newVnode)) &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  newVnode.<span class="property">elm</span> = oldVnode.<span class="property">elm</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newVnode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \* 转为 虚拟 <span class="variable constant_">DOM</span></span><br><span class="line"> \* @param &#123;<span class="variable constant_">DOM</span>&#125; elm <span class="variable constant_">DOM</span>节点</span><br><span class="line"> \* @returns &#123;object&#125;</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emptyNodeAt</span>(<span class="params">elm</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">vnode</span>(elm.<span class="property">tagName</span>.<span class="title function_">toLowerCase</span>(), <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, elm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在要处理是否是 同一个虚拟节点的问题</p>
<h3 id="2-createElm"><a href="#2-createElm" class="headerlink" title="2.createElm"></a>2.createElm</h3><blockquote>
<p>先来处理不是同一个虚拟节点</p>
</blockquote>
<p>处理这个我们得去写个 创建节点的方法 这里就放到 <strong>createElm.js</strong> 中完成</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">\* 创建元素</span><br><span class="line"> \* @param &#123;vnode&#125; vnode 要创建的节点</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createElm</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> node = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">sel</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    vnode.<span class="property">text</span> !== <span class="string">&#x27;&#x27;</span> &amp;&amp;</span><br><span class="line">    (vnode.<span class="property">children</span> === <span class="literal">undefined</span> || vnode.<span class="property">children</span>.<span class="property">length</span> === <span class="number">0</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line"></span><br><span class="line">    node.<span class="property">textContent</span> = vnode.<span class="property">text</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>) &amp;&amp; vnode.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> children = vnode.<span class="property">children</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> ch = children\[i\]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> chDom = <span class="title function_">createElm</span>(ch)</span><br><span class="line"></span><br><span class="line">      node.<span class="title function_">appendChild</span>(chDom)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vnode.<span class="property">elm</span> = node</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的 <strong>createElm</strong> 就是使用了递归的方式去创建子节点 ，然后我们就去 patch 中 具体的调用这个 创建节点的方法</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&#x27;./vnode&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createElm <span class="keyword">from</span> <span class="string">&#x27;./createElm&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;vnode/<span class="variable constant_">DOM</span>&#125; oldVnode</span><br><span class="line"> \* @param &#123;vnode&#125; newVnode</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">oldVnode, newVnode</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!oldVnode.<span class="property">sel</span>) &#123;</span><br><span class="line"></span><br><span class="line">    oldVnode = <span class="title function_">emptyNodeAt</span>(oldVnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldVnode, newVnode)) &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newNode = <span class="title function_">createElm</span>(newVnode)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">elm</span>.<span class="property">parentNode</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> parentNode = oldVnode.<span class="property">elm</span>.<span class="property">parentNode</span></span><br><span class="line"></span><br><span class="line">      parentNode.<span class="title function_">insertBefore</span>(newNode, oldVnode.<span class="property">elm</span>)</span><br><span class="line"></span><br><span class="line">      parentNode.<span class="title function_">removeChild</span>(oldVnode.<span class="property">elm</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  newVnode.<span class="property">elm</span> = oldVnode.<span class="property">elm</span></span><br><span class="line">  <span class="keyword">return</span> newVnode</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在递归添加子节点 到了最后我们在 <strong>patch</strong> 添加到 真实的 <strong>DOM</strong> 中，移除之前的老节点</p>
<p>写到这里了来试试 不同节点 是否真的添加</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h <span class="keyword">from</span> <span class="string">&#x27;./my-snabbdom/h&#x27;</span></span><br><span class="line"><span class="keyword">import</span> patch <span class="keyword">from</span> <span class="string">&#x27;./my-snabbdom/patch&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个p&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个p&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个p&#x27;</span>),</span><br><span class="line">  \]),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123;&#125;, <span class="string">&#x27;我是一个li&#x27;</span>),</span><br><span class="line">\])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oldVnode = <span class="title function_">patch</span>(app, vnode)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>hellow<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/virtualdir/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6be430ef040d448b8b2b059b4823dfc2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210728164308771"></p>
<p>把 <strong>div#app</strong> 给替换了，并且成功替换</p>
<h3 id="3-patchVnode"><a href="#3-patchVnode" class="headerlink" title="3.patchVnode"></a>3.patchVnode</h3><blockquote>
<p>我们现在来实现同一个虚拟 DOM 的处理</p>
</blockquote>
<p>在 patchVnode 中</p>
<p>步骤都是按照 之前那个流程图进行编写,我们把比较两个<strong>相同</strong>的 虚拟 DOM 代码写在 <strong>patchVnode.js</strong>中</p>
<p>在比较 两个相同的虚拟节点分支 有好几种情况</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElm <span class="keyword">from</span> <span class="string">&#x27;./createElm&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;vnode&#125; oldVnode 老的虚拟节点</span><br><span class="line"> \* @param &#123;vnode&#125; newVnode 新的虚拟节点</span><br><span class="line"> \* @returns</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">patchVnode</span>(<span class="params">oldVnode, newVnode</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;同一个虚拟节点&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (oldVnode === newVnode) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newVnode.<span class="property">text</span> &amp;&amp; !newVnode.<span class="property">children</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">text</span> !== newVnode.<span class="property">text</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文字不相同&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      oldVnode.<span class="property">elm</span>.<span class="property">textContent</span> = newVnode.<span class="property">text</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">children</span>) &#123;</span><br><span class="line">      ...这里新旧节点都存在children 这里要使用 updateChildren 下面进行实现</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;old没有children，new有children&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      oldVnode.<span class="property">elm</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> newChildren = newVnode.<span class="property">children</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newChildren.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> node = <span class="title function_">createElm</span>(newChildren\[i\])</span><br><span class="line"></span><br><span class="line">        oldVnode.<span class="property">elm</span>.<span class="title function_">appendChild</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按照流程图进行编码，现在要处理 <strong>newVnode</strong> 和 <strong>oldVnode</strong> 都存在 <strong>children</strong> 的情况了</p>
<p>在这里我们要进行精细化比较 也就是我们经常说的 <strong>diff</strong></p>
<h3 id="4-diff"><a href="#4-diff" class="headerlink" title="4.diff"></a>4.diff</h3><p>经常听到的 <strong>diff(精细化比较)</strong> ,那我们先来了解下</p>
<blockquote>
<p>diff四种优化策略</p>
</blockquote>
<p>在这里要使用 4 个指针,从1-4的顺序来开始命中优化策略，命中一个，指针进行移动<code>(新前和旧前向下移动，新后和旧后向上移动)</code>，没有命中，就使用<strong>下一个策略</strong>，如果四个策略都没有命中，只能靠循环来找</p>
<p>命中：两个节点 <strong>sel</strong> 和 <strong>key</strong> 一样</p>
<ol>
<li>新前与旧前</li>
<li>新后与旧后</li>
<li>新后与旧前</li>
<li>新前与旧后</li>
</ol>
<blockquote>
<p>先来说下新增的情况</p>
</blockquote>
<p>四种策略都是在 循环里面执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(旧前&lt;=旧后&amp;&amp;新前&lt;=新后)&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5d39847b94f4a3ca1763eb939366ae0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="14"></p>
<p>可以看出 <strong>旧子节点</strong> 先循环完毕，那么说明了新的子节点有需要 新增的 子节点</p>
<p><strong>新前</strong> 和 <strong>新后</strong> 的 节点 就是需要新增的字节</p>
<blockquote>
<p>删除的情况1</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8727f03b28e4dd48d960c73e3b4be85~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="19"></p>
<p>这里新子节点 先循环完毕说明 旧子节点有需要删除的节点</p>
<blockquote>
<p>删除的情况2</p>
</blockquote>
<p>当我们删除多个，而且 4种策略都没有满足，我们得通过 <strong>while</strong> 循环 旧子节点 找到 新子节点需要寻找节点并标记为 <code>undefined</code> 虚拟节点是 <strong>undefined</strong>实际上在 <strong>DOM</strong>已经把它移动了 ,<strong>旧前</strong> 和 <strong>旧后</strong> 之间的节点就是需要删除的节点</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4bc4cbb7093444988b87830f036bba3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="18"></p>
<blockquote>
<p>复杂情况1</p>
</blockquote>
<p>当触发了 第四种 策略，这里就需要移动节点了，旧后指向的节点（在虚拟节点标为 <strong>undefined</strong>），实际把 <strong>新前</strong> 指向的节点 在<strong>DOM</strong> 中 移动到<strong>旧前之前</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99cc589cb22548528139cc46d6498234~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="20"></p>
<blockquote>
<p>复杂情况2</p>
</blockquote>
<p>当触发了 第三种 策略，这里也需要移动节点了，旧前 指向的节点（在虚拟节点标为 <strong>undefined</strong>），实际把 <strong>新后</strong> 指向的节点 在<strong>DOM</strong> 中 移动到<strong>旧后之后</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f9bbbb7afce48da85d76991d7367e80~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="21"></p>
<blockquote>
<p>注意几个点 :</p>
</blockquote>
<ul>
<li><code>h(&#39;li&#39;,&#123;key:&#39;A&#39;&#125; : &quot;A&quot;&#125;)</code> 比如这其中的 key 是这个节点的唯一的标识</li>
<li>它的存在是在告诉 <strong>diff</strong> ,在更改前后它们是同一个<strong>DOM</strong>节点。</li>
<li>只有是<strong>同一个虚拟节点，</strong>才进行精细化比较，否则就是<strong>暴力删除旧的</strong>、插入新的</li>
<li>同一虚拟节点 不仅要 key 相同而且要 选择器相同也就是上面的 <code>h()</code> 函数创建的 虚拟节点 对象里的 <code>sel</code></li>
<li>只进行同层比较，不会进行跨层比较</li>
</ul>
<h3 id="5-updateChildren"><a href="#5-updateChildren" class="headerlink" title="5.updateChildren"></a>5.updateChildren</h3><p>看了上面对于 <strong>diff</strong> 的介绍，不知道我画的图 演示清楚了没，然后我们接着继续来完成 <strong>patchVnode</strong></p>
<p>我们得写个 <strong>updateChildren</strong> 来进行精细化比较</p>
<p>这个文件就是 <strong>diff</strong> 算法的核心，我们用来比较 <strong>oldVnode</strong> 和 <strong>newVnode</strong> 都存在 <strong>children</strong> 的情况</p>
<p>这里有点绕，注释都写了，请耐心观看，流程就是按照 diff 的四种策略来写，还要处理没有命中的情况</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElm <span class="keyword">from</span> <span class="string">&#x27;./createElm&#x27;</span></span><br><span class="line"><span class="keyword">import</span> patchVnode <span class="keyword">from</span> <span class="string">&#x27;./patchVnode&#x27;</span></span><br><span class="line"><span class="keyword">import</span> sameVnode <span class="keyword">from</span> <span class="string">&#x27;./sameVnode&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;dom&#125; parentElm 父节点</span><br><span class="line"> \* @param &#123;array&#125; oldCh 旧子节点</span><br><span class="line"> \* @param &#123;array&#125; newCh 新子节点</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">updateChildren</span>(<span class="params">parentElm, oldCh, newCh</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span>,</span><br><span class="line">    newStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh\[<span class="number">0</span>\]</span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh\[oldEndIdx\]</span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh\[<span class="number">0</span>\]</span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh\[newEndIdx\]</span><br><span class="line">  <span class="keyword">let</span> keyMap = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (newStartIdx &lt;= newEndIdx &amp;&amp; oldStartIdx &lt;= oldEndIdx) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---进入diff---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldCh\[oldStartIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldStartVnode = oldCh\[++oldStartIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldCh\[oldEndIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldEndVnode = oldCh\[--oldEndIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newCh\[newStartIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newCh\[newEndIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newEndVnode = newCh\[--newEndIdx\]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newStartVnode)</span><br><span class="line"></span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">      oldStartVnode = oldCh\[++oldStartIdx\]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newEndVnode)</span><br><span class="line"></span><br><span class="line">      newEndVnode = newCh\[--newEndIdx\]</span><br><span class="line">      oldEndVnode = oldCh\[--oldEndIdx\]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newEndVnode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      parentElm.<span class="title function_">insertBefore</span>(oldStartVnode.<span class="property">elm</span>, oldEndVnode.<span class="property">elm</span>.<span class="property">nextSibling</span>)</span><br><span class="line"></span><br><span class="line">      newEndVnode = newCh\[--newEndIdx\]</span><br><span class="line">      oldStartVnode = oldCh\[++oldStartIdx\]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newStartVnode)</span><br><span class="line"></span><br><span class="line">      parentElm.<span class="title function_">insertBefore</span>(oldEndVnode.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line"></span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">      oldEndVnode = oldCh\[--oldEndIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;diff四种优化策略都没命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!keyMap) &#123;</span><br><span class="line"></span><br><span class="line">        keyMap = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = oldStartIdx; i &lt; oldEndIdx; i++) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> key = oldCh\[i\].<span class="property">data</span>.<span class="property">key</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!key) keyMap\[key\] = i</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> idInOld = keyMap\[newStartIdx.<span class="property">data</span>\]</span><br><span class="line">        ? keyMap\[newStartIdx.<span class="property">data</span>.<span class="property">key</span>\]</span><br><span class="line">        : <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (idInOld) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;移动节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> moveElm = oldCh\[idInOld\]</span><br><span class="line"></span><br><span class="line">        <span class="title function_">patchVnode</span>(moveElm, newStartVnode)</span><br><span class="line"></span><br><span class="line">        oldCh\[idInOld\] = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        parentElm.<span class="title function_">insertBefore</span>(moveElm.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加新节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        parentElm.<span class="title function_">insertBefore</span>(<span class="title function_">createElm</span>(newStartVnode), oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;进入添加剩余节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> beforeFlag = newCh\[newEndIdx + <span class="number">1</span>\] ? newCh\[newEndIdx + <span class="number">1</span>\] : <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = newStartIdx; i &lt;= newEndIdx; i++) &#123;</span><br><span class="line"></span><br><span class="line">      parentElm.<span class="title function_">insertBefore</span>(<span class="title function_">createElm</span>(newCh\[i\]), beforeFlag)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldStartIdx &lt;= oldEndIdx) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;进入删除多余节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = oldStartIdx; i &lt;= oldEndIdx; i++) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (oldCh\[i\].<span class="property">elm</span>) parentElm.<span class="title function_">removeChild</span>(oldCh\[i\].<span class="property">elm</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到了这里我们基本写都完成了， <strong>h</strong> 函数 创建 虚拟 <strong>DOM</strong> , <strong>patch</strong> 比较 虚拟<strong>DOM</strong> 进行更新视图</p>
<h2 id="6-我们来测试一下写的"><a href="#6-我们来测试一下写的" class="headerlink" title="6.我们来测试一下写的"></a>6.我们来测试一下写的</h2><p>其实在写代码的时候就在不断的调试。。。现在随便测试几个</p>
<h3 id="1-代码"><a href="#1-代码" class="headerlink" title="1.代码"></a>1.代码</h3><blockquote>
<p>html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>策略3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>复杂<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>复杂<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>复杂<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    hellow</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/virtualdir/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>index.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h <span class="keyword">from</span> <span class="string">&#x27;./my-snabbdom/h&#x27;</span></span><br><span class="line"><span class="keyword">import</span> patch <span class="keyword">from</span> <span class="string">&#x27;./my-snabbdom/patch&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;A&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;D&#x27;</span> &#125;, <span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="string">&#x27;E&#x27;</span>),</span><br><span class="line">\])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> oldVnode = <span class="title function_">patch</span>(app, vnode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode2 = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="string">&#x27;E&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;D&#x27;</span> &#125;, <span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;A&#x27;</span>),</span><br><span class="line">\])</span><br><span class="line"><span class="keyword">let</span> vnode3 = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="string">&#x27;E&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;D&#x27;</span> &#125;, <span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;A&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;K&#x27;</span> &#125;, <span class="string">&#x27;K&#x27;</span>),</span><br><span class="line">\])</span><br><span class="line"><span class="keyword">let</span> vnode4 = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;A&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">\])</span><br><span class="line"><span class="keyword">let</span> vnode5 = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="string">&#x27;E&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;V&#x27;</span> &#125;, <span class="string">&#x27;V&#x27;</span>),</span><br><span class="line">\])</span><br><span class="line"><span class="keyword">let</span> vnode6 = <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;A&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;D&#x27;</span> &#125;, <span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">  <span class="title function_">h</span>(</span><br><span class="line">    <span class="string">&#x27;li&#x27;</span>,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;,</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;ul&#x27;</span>, &#123;&#125;, \[</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;A&#x27;</span> &#125;, <span class="string">&#x27;A&#x27;</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;B&#x27;</span> &#125;, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;C&#x27;</span> &#125;, <span class="string">&#x27;C&#x27;</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;D&#x27;</span> &#125;, <span class="string">&#x27;D&#x27;</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;li&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;E&#x27;</span> &#125;, <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">key</span>: <span class="string">&#x27;R&#x27;</span> &#125;, <span class="string">&#x27;R&#x27;</span>)),</span><br><span class="line">    \])</span><br><span class="line">  ),</span><br><span class="line">\])</span><br><span class="line"><span class="keyword">let</span> vnodeList = \[vnode2, vnode3, vnode4, vnode5, vnode6\]</span><br><span class="line"><span class="keyword">let</span> btn = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.btn&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; btn.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  btn\[i\].<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">patch</span>(vnode, vnodeList\[i\])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-演示"><a href="#2-演示" class="headerlink" title="2.演示"></a>2.演示</h3><blockquote>
<p>策略3</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f95d637265f4ea894fb0ee36e9c9bdb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="22"></p>
<blockquote>
<p>复杂</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5582ea0aa45e4b05b751e3c54a2b59c9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="23"></p>
<blockquote>
<p>删除</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/246cbf9a6c6749a494e27f0ef5fecbb1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="24"></p>
<blockquote>
<p>复杂</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b351a63e539467598b4e3ff1990bef9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="25"></p>
<blockquote>
<p>复杂（这里是简单 。。）</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff817315ac8c4cacac1dab0330a96e6e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="26"></p>
<h2 id="7-结语"><a href="#7-结语" class="headerlink" title="7.结语"></a>7.结语</h2><p>注释我都写了喔，大家可以对照 我上面画的图不清楚可以反复耐心的看哈</p>
<p>如果看的话没什么感觉，大家可以自己动手写写，下面我会贴出所有的代码</p>
<p>代码同样也放在 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FLianTianNo1%2FVirtual_DOM_demo%2Ftree%2Fmain%2Fsrc%2Fmy-snabbdom" title="https://github.com/LianTianNo1/Virtual_DOM_demo/tree/main/src/my-snabbdom"><strong>github</strong></a></p>
<p>完整代码：</p>
<blockquote>
<p>h.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&#x27;./vnode&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;string&#125; a sel</span><br><span class="line"> \* @param &#123;object&#125; b data</span><br><span class="line"> \* @param &#123;any&#125; c 是子节点 可以是文本，数组</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">a, b, c</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &lt; <span class="number">3</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;请检查参数个数&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> c === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> c === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(a, b, <span class="literal">undefined</span>, c, <span class="literal">undefined</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(c)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> children = \[\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!(<span class="keyword">typeof</span> c\[i\] === <span class="string">&#x27;object&#x27;</span> &amp;&amp; c\[i\].<span class="property">sel</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;第三个参数为数组时只能传递 h() 函数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      children.<span class="title function_">push</span>(c\[i\])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(a, b, children, <span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> c === <span class="string">&#x27;object&#x27;</span> &amp;&amp; c.<span class="property">sel</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> children = \[c\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(a, b, children, <span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>patch.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vnode <span class="keyword">from</span> <span class="string">&#x27;./vnode&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createElm <span class="keyword">from</span> <span class="string">&#x27;./createElm&#x27;</span></span><br><span class="line"><span class="keyword">import</span> patchVnode <span class="keyword">from</span> <span class="string">&#x27;./patchVnode&#x27;</span></span><br><span class="line"><span class="keyword">import</span> sameVnode <span class="keyword">from</span> <span class="string">&#x27;./sameVnode&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;vnode/<span class="variable constant_">DOM</span>&#125; oldVnode</span><br><span class="line"> \* @param &#123;vnode&#125; newVnode</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">oldVnode, newVnode</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!oldVnode.<span class="property">sel</span>) &#123;</span><br><span class="line"></span><br><span class="line">    oldVnode = <span class="title function_">emptyNodeAt</span>(oldVnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldVnode, newVnode)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">patchVnode</span>(oldVnode, newVnode)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newNode = <span class="title function_">createElm</span>(newVnode)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">elm</span>.<span class="property">parentNode</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> parentNode = oldVnode.<span class="property">elm</span>.<span class="property">parentNode</span></span><br><span class="line"></span><br><span class="line">      parentNode.<span class="title function_">insertBefore</span>(newNode, oldVnode.<span class="property">elm</span>)</span><br><span class="line"></span><br><span class="line">      parentNode.<span class="title function_">removeChild</span>(oldVnode.<span class="property">elm</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  newVnode.<span class="property">elm</span> = oldVnode.<span class="property">elm</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newVnode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \* 转为 虚拟 <span class="variable constant_">DOM</span></span><br><span class="line"> \* @param &#123;<span class="variable constant_">DOM</span>&#125; elm <span class="variable constant_">DOM</span>节点</span><br><span class="line"> \* @returns &#123;object&#125;</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emptyNodeAt</span>(<span class="params">elm</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">vnode</span>(elm.<span class="property">tagName</span>.<span class="title function_">toLowerCase</span>(), <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, elm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>createElm.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">\* 创建元素</span><br><span class="line"> \* @param &#123;vnode&#125; vnode 要创建的节点</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createElm</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> node = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">sel</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    vnode.<span class="property">text</span> !== <span class="string">&#x27;&#x27;</span> &amp;&amp;</span><br><span class="line">    (vnode.<span class="property">children</span> === <span class="literal">undefined</span> || vnode.<span class="property">children</span>.<span class="property">length</span> === <span class="number">0</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line"></span><br><span class="line">    node.<span class="property">textContent</span> = vnode.<span class="property">text</span></span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>) &amp;&amp; vnode.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> children = vnode.<span class="property">children</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> ch = children\[i\]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> chDom = <span class="title function_">createElm</span>(ch)</span><br><span class="line"></span><br><span class="line">      node.<span class="title function_">appendChild</span>(chDom)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vnode.<span class="property">elm</span> = node</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>vnode.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">\* 把传入的 参数 作为 对象返回</span><br><span class="line"> \* @param &#123;string&#125; sel 选择器</span><br><span class="line"> \* @param &#123;object&#125; data 数据</span><br><span class="line"> \* @param &#123;array&#125; children 子节点</span><br><span class="line"> \* @param &#123;string&#125; text 文本</span><br><span class="line"> \* @param &#123;dom&#125; elm <span class="variable constant_">DOM</span></span><br><span class="line"> \* @returns</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">sel, data, children, text, elm</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; sel, data, children, text, elm &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>patchVnode.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElm <span class="keyword">from</span> <span class="string">&#x27;./createElm&#x27;</span></span><br><span class="line"><span class="keyword">import</span> updateChildren <span class="keyword">from</span> <span class="string">&#x27;./updateChildren&#x27;</span></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;vnode&#125; oldVnode 老的虚拟节点</span><br><span class="line"> \* @param &#123;vnode&#125; newVnode 新的虚拟节点</span><br><span class="line"> \* @returns</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">patchVnode</span>(<span class="params">oldVnode, newVnode</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (oldVnode === newVnode) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newVnode.<span class="property">text</span> &amp;&amp; !newVnode.<span class="property">children</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">text</span> !== newVnode.<span class="property">text</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文字不相同&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      oldVnode.<span class="property">elm</span>.<span class="property">textContent</span> = newVnode.<span class="property">text</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">children</span>) &#123;</span><br><span class="line">      <span class="title function_">updateChildren</span>(oldVnode.<span class="property">elm</span>, oldVnode.<span class="property">children</span>, newVnode.<span class="property">children</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;old没有children，new有children&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      oldVnode.<span class="property">elm</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> newChildren = newVnode.<span class="property">children</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newChildren.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> node = <span class="title function_">createElm</span>(newChildren\[i\])</span><br><span class="line"></span><br><span class="line">        oldVnode.<span class="property">elm</span>.<span class="title function_">appendChild</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sameVnode.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">\* 判断两个虚拟节点是否是同一节点</span><br><span class="line"> \* @param &#123;vnode&#125; vnode1 虚拟节点<span class="number">1</span></span><br><span class="line"> \* @param &#123;vnode&#125; vnode2 虚拟节点<span class="number">2</span></span><br><span class="line"> \* @returns boolean</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">sameVnode</span>(<span class="params">vnode1, vnode2</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    (vnode1.<span class="property">data</span> ? vnode1.<span class="property">data</span>.<span class="property">key</span> : <span class="literal">undefined</span>) ===</span><br><span class="line">      (vnode2.<span class="property">data</span> ? vnode2.<span class="property">data</span>.<span class="property">key</span> : <span class="literal">undefined</span>) &amp;&amp; vnode1.<span class="property">sel</span> === vnode2.<span class="property">sel</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>updateChildren.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createElm <span class="keyword">from</span> <span class="string">&#x27;./createElm&#x27;</span></span><br><span class="line"><span class="keyword">import</span> patchVnode <span class="keyword">from</span> <span class="string">&#x27;./patchVnode&#x27;</span></span><br><span class="line"><span class="keyword">import</span> sameVnode <span class="keyword">from</span> <span class="string">&#x27;./sameVnode&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;dom&#125; parentElm 父节点</span><br><span class="line"> \* @param &#123;array&#125; oldCh 旧子节点</span><br><span class="line"> \* @param &#123;array&#125; newCh 新子节点</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">updateChildren</span>(<span class="params">parentElm, oldCh, newCh</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span>,</span><br><span class="line">    newStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh\[<span class="number">0</span>\]</span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh\[oldEndIdx\]</span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh\[<span class="number">0</span>\]</span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh\[newEndIdx\]</span><br><span class="line">  <span class="keyword">let</span> keyMap = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (newStartIdx &lt;= newEndIdx &amp;&amp; oldStartIdx &lt;= oldEndIdx) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---进入diff---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldCh\[oldStartIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldStartVnode = oldCh\[++oldStartIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldCh\[oldEndIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      oldEndVnode = oldCh\[--oldEndIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newCh\[newStartIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newCh\[newEndIdx\] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">      newEndVnode = newCh\[--newEndIdx\]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newStartVnode)</span><br><span class="line"></span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">      oldStartVnode = oldCh\[++oldStartIdx\]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newEndVnode)</span><br><span class="line"></span><br><span class="line">      newEndVnode = newCh\[--newEndIdx\]</span><br><span class="line">      oldEndVnode = oldCh\[--oldEndIdx\]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newEndVnode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      parentElm.<span class="title function_">insertBefore</span>(oldStartVnode.<span class="property">elm</span>, oldEndVnode.<span class="property">elm</span>.<span class="property">nextSibling</span>)</span><br><span class="line"></span><br><span class="line">      newEndVnode = newCh\[--newEndIdx\]</span><br><span class="line">      oldStartVnode = oldCh\[++oldStartIdx\]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newStartVnode)</span><br><span class="line"></span><br><span class="line">      parentElm.<span class="title function_">insertBefore</span>(oldEndVnode.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line"></span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">      oldEndVnode = oldCh\[--oldEndIdx\]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;diff四种优化策略都没命中&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!keyMap) &#123;</span><br><span class="line"></span><br><span class="line">        keyMap = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = oldStartIdx; i &lt; oldEndIdx; i++) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> key = oldCh\[i\].<span class="property">data</span>.<span class="property">key</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!key) keyMap\[key\] = i</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> idInOld = keyMap\[newStartIdx.<span class="property">data</span>\]</span><br><span class="line">        ? keyMap\[newStartIdx.<span class="property">data</span>.<span class="property">key</span>\]</span><br><span class="line">        : <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (idInOld) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;移动节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> moveElm = oldCh\[idInOld\]</span><br><span class="line"></span><br><span class="line">        <span class="title function_">patchVnode</span>(moveElm, newStartVnode)</span><br><span class="line"></span><br><span class="line">        oldCh\[idInOld\] = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        parentElm.<span class="title function_">insertBefore</span>(moveElm.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加新节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        parentElm.<span class="title function_">insertBefore</span>(<span class="title function_">createElm</span>(newStartVnode), oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      newStartVnode = newCh\[++newStartIdx\]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;进入添加剩余节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> beforeFlag = newCh\[newEndIdx + <span class="number">1</span>\] ? newCh\[newEndIdx + <span class="number">1</span>\] : <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = newStartIdx; i &lt;= newEndIdx; i++) &#123;</span><br><span class="line"></span><br><span class="line">      parentElm.<span class="title function_">insertBefore</span>(<span class="title function_">createElm</span>(newCh\[i\]), beforeFlag)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldStartIdx &lt;= oldEndIdx) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;进入删除多余节点&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = oldStartIdx; i &lt;= oldEndIdx; i++) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (oldCh\[i\].<span class="property">elm</span>) parentElm.<span class="title function_">removeChild</span>(oldCh\[i\].<span class="property">elm</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/07/26/24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/07/26/24/" class="post-title-link" itemprop="url">手写一个简易vue响应式带你了解响应式原理</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-26 06:10:24" itemprop="dateCreated datePublished" datetime="2021-07-26T06:10:24+08:00">2021-07-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="手写一个简易vue响应式带你了解响应式原理"><a href="#手写一个简易vue响应式带你了解响应式原理" class="headerlink" title="手写一个简易vue响应式带你了解响应式原理"></a>手写一个简易vue响应式带你了解响应式原理</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6989106100582744072">https://juejin.cn/post/6989106100582744072</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>这是小浪在学习<strong>Vue</strong>总结的一篇文章，在这篇文章我们来了解 <strong>Vue2.X</strong> 响应式原理，然后我们来实现一个 <strong>vue</strong> 响应式原理（写的内容简单）实现步骤和注释写的很清晰，大家有兴趣可以耐心观看，大家可以在评论多多交流，也希望大家能给 小浪一个 <strong>赞</strong></p>
</blockquote>
<h1 id="Vue2-X响应式原理"><a href="#Vue2-X响应式原理" class="headerlink" title="Vue2.X响应式原理"></a>Vue2.X响应式原理</h1><h2 id="1-defineProperty-的应用"><a href="#1-defineProperty-的应用" class="headerlink" title="1.defineProperty 的应用"></a>1.defineProperty 的应用</h2><p>在<strong>Vue2.X</strong> 响应式中使用到了 <strong>defineProperty</strong> 进行数据劫持，所以我们对它必须有一定的了解，那么我们先来了解它的使用方法把， 这里我们来使用 <strong>defineProperty</strong>来模拟 <strong>Vue</strong> 中的 <strong>data</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> vm = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(vm, <span class="string">&#x27;msg&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> data.<span class="property">msg</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (newValue === data.<span class="property">msg</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                data.<span class="property">msg</span> = newValue</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">textContent</span> = data.<span class="property">msg</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        vm.<span class="property">msg</span> = <span class="string">&#x27;1234&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ad4d2fcc15f47d9a3df0db8878ffba5~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="7"></p>
<p>可以看见 上面 <strong>vm.msg</strong> 数据是<strong>响应式</strong>的</p>
<h2 id="2-defineProperty修改多个参数为响应式"><a href="#2-defineProperty修改多个参数为响应式" class="headerlink" title="2.defineProperty修改多个参数为响应式"></a>2.defineProperty修改多个参数为响应式</h2><blockquote>
<p>修改多个参数</p>
</blockquote>
<p>看了上面的方法只能修改一个属性，实际上我们 <strong>data</strong> 中数据不可能只有一个,我们何不定义一个方法把<strong>data</strong>中的数据进行遍历都修改成响应式呢</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">msg</span>: <span class="string">&#x27;哈哈&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> vm = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">proxyData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(vm, key, &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">configurable</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> data\[key\]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (newValue === data\[key\]) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        data\[key\] = newValue</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">textContent</span> = data\[key\]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">proxyData</span>(data)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-Proxy"><a href="#3-Proxy" class="headerlink" title="3.Proxy"></a>3.Proxy</h2><blockquote>
<p>在<strong>Vue3</strong> 中使用 <strong>Proxy</strong> 来设置响应式的属性</p>
</blockquote>
<p>先来了解下 <strong>Proxy</strong> 的两个参数</p>
<p><code>new Proxy(target,handler)</code></p>
<ul>
<li><code>target</code> ：要使用 <code>Proxy</code> 包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）</li>
<li><code>handler</code>：一个通常以函数作为属性的对象，各属性中的函数分别定义了在执行各种操作时代理 <code>p</code> 的行为</li>
</ul>
<p>其实 和 Vue2.X实现的逻辑差不多，不过实现的方法不一样</p>
<p>那么就放上代码了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">let</span> data = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">age</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="keyword">return</span> target\[key\]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="title function_">set</span>(<span class="params">target, key, newValue</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="keyword">if</span> (target\[key\] === newValue) <span class="keyword">return</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    target\[key\] = newValue</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">textContent</span> = target\[key\]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>触发<strong>set</strong> 和 <strong>get</strong> 的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="property">msg</span> = <span class="string">&#x27;haha&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="property">msg</span>)</span><br></pre></td></tr></table></figure>
<h2 id="4-发布订阅模式"><a href="#4-发布订阅模式" class="headerlink" title="4.发布订阅模式"></a>4.发布订阅模式</h2><blockquote>
<p>在Vue 响应式中应用到了 发布订阅模式 我们先来了解下</p>
</blockquote>
<p>首先来说简单介绍下 一共有三个角色</p>
<p><strong>发布者</strong>、 <strong>订阅者</strong>、 <strong>信号中心</strong> 举个现实中例子 作者(发布者)写一篇文章 发到了掘金(信号中心) ,掘金可以处理文章然后推送到了首页，然后各自大佬(订阅者)就可以订阅文章</p>
<p>在Vue 中的例子 就是<strong>EventBus</strong><code>$on``$emit</code></p>
<blockquote>
<p>那么我们就简单模仿一下 Vue 的事件总线吧</p>
</blockquote>
<p>之前代码缩进4个单位有点宽，这里改成2个</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">subs</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      $on(type, fn) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">subs</span>\[type\]) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">subs</span>\[type\] = \[\]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">subs</span>\[type\].<span class="title function_">push</span>(fn)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      $emit(type) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">subs</span>\[type\]) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">subs</span>\[type\].<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>(...args))</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> eventHub = <span class="keyword">new</span> <span class="title class_">Vue</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    eventHub.$on(<span class="string">&#x27;sum&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> count = \[...<span class="variable language_">arguments</span>\].<span class="title function_">reduce</span>(<span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(count)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    eventHub.$emit(<span class="string">&#x27;sum&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-观察者模式"><a href="#5-观察者模式" class="headerlink" title="5.观察者模式"></a>5.观察者模式</h2><blockquote>
<p>与 发布订阅 的差异</p>
</blockquote>
<p>与发布订阅者不同 观察者中 发布者和订阅者(观察者)是相互依赖的 必须要求观察者订阅内容改变事件 ，而发布订阅者是由调度中心进行调度，那么看看观察者模式 是如何相互依赖，下面就举个简单例子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">observerLists</span> = \[\]</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addObs</span>(<span class="params">obs</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (obs &amp;&amp; obs.<span class="property">update</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">observerLists</span>.<span class="title function_">push</span>(obs)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">observerLists</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">obs</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          obs.<span class="title function_">update</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">empty</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">observerLists</span> = \[\]</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">update</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;目标更新了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> sub = <span class="keyword">new</span> <span class="title class_">Subject</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> obs1 = <span class="keyword">new</span> <span class="title class_">Observer</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> obs2 = <span class="keyword">new</span> <span class="title class_">Observer</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    sub.<span class="title function_">addObs</span>(obs1)</span></span><br><span class="line"><span class="language-javascript">    sub.<span class="title function_">addObs</span>(obs2)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    sub.<span class="title function_">notify</span>()</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="6-模拟Vue的响应式原理"><a href="#6-模拟Vue的响应式原理" class="headerlink" title="6.模拟Vue的响应式原理"></a>6.模拟Vue的响应式原理</h2><blockquote>
<p>这里来实现一个小型简单的 <strong>Vue</strong> 主要实现以下的功能</p>
</blockquote>
<ul>
<li>接收初始化的参数，这里只举几个简单的例子 <strong>el**</strong>data<strong>**options</strong></li>
<li>通过私有方法 <strong>_proxyData</strong> 把<strong>data</strong> 注册到 <strong>Vue</strong> 中 转成<strong>getter**</strong>setter**</li>
<li>使用 <strong>observer</strong> 把 <strong>data</strong> 中的属性转为 响应式 添加到 自身身上</li>
<li>使用 <strong>observer</strong> 方法监听 <strong>data</strong> 的所有属性变化来 通过观察者模式 更新视图</li>
<li>使用 <strong>compiler</strong> 编译元素节点上面指令 和 文本节点差值表达式</li>
</ul>
<h3 id="1-vue-js"><a href="#1-vue-js" class="headerlink" title="1.vue.js"></a>1.vue.js</h3><p>在这里获取到 <code>el``data</code></p>
<p>通过 <strong>_proxyData</strong> 把 <strong>data</strong>的属性 注册到<strong>Vue</strong> 并转成 <strong>getter**</strong>setter**</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$options</span> = options || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$el</span> =</span><br><span class="line">      <span class="keyword">typeof</span> options.<span class="property">el</span> === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">        ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>)</span><br><span class="line">        : options.<span class="property">el</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$data</span> = options.<span class="property">data</span> || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_proxyData</span>(<span class="variable language_">this</span>.<span class="property">$data</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_proxyData</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, key, &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> data\[key\]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (newValue === data\[key\]) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">          data\[key\] = newValue</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-observer-js"><a href="#2-observer-js" class="headerlink" title="2.observer.js"></a>2.observer.js</h3><p>在这里把 <strong>data</strong> 中的 属性变为响应式加在自身的身上，还有一个主要功能就是 观察者模式在 第 <code>4.dep.js</code> 会有详细的使用</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">defineReactive</span>(data, key, data\[key\])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">defineReactive</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newValue === value) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        value = newValue</span><br><span class="line"></span><br><span class="line">        self.<span class="title function_">walk</span>(newValue)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在html中引入的话注意顺序</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/observer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在<strong>vue.js</strong> 中使用 <strong>Observer</strong></p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_proxyData</span>(<span class="params">data</span>) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到这里为什么做了两个重复性的操作呢？重复性两次把 <strong>data</strong>的属性转为响应式</p>
<p>在<strong>obsever.js</strong> 中是把 <strong>data</strong> 的所有属性 加到 <strong>data</strong> 自身 变为响应式 转成 <strong>getter**</strong>setter**方式</p>
<p>在<strong>vue.js</strong> 中 也把 <strong>data</strong>的 的所有属性 加到 <strong>Vue</strong> 上,是为了以后方面操作可以用 <strong>Vue</strong> 的实例直接访问到 或者在 <strong>Vue</strong> 中使用 <strong>this</strong> 访问</p>
<blockquote>
<p>使用例子</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/observer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">msg</span>: <span class="string">&#x27;123&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">age</span>: <span class="number">21</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/792a2a311f044c3a8d153c4fad2f0c46~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210725162744305"></p>
<p>这样在<code>Vue</code> 和 <code>$data</code> 中都存在了 所有的<strong>data</strong> 属性了 并且是响应式的</p>
<h3 id="3-compiler-js"><a href="#3-compiler-js" class="headerlink" title="3.compiler.js"></a>3.compiler.js</h3><p><strong>comilper.js</strong>在这个文件里实现对文本节点 和 元素节点指令编译 主要是为了举例子 当然这个写的很简单 指令主要实现 <strong>v-text**</strong>v-model**</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span> = vm.<span class="property">$el</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">compile</span>(<span class="variable language_">this</span>.<span class="property">el</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compile</span>(<span class="params">el</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> childNodes = \[...el.<span class="property">childNodes</span>\]</span><br><span class="line">    childNodes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isTextNode</span>(node)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileText</span>(node)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isElementNode</span>(node)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileElement</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">childNodes</span> &amp;&amp; node.<span class="property">childNodes</span>.<span class="property">length</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compile</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compileText</span>(<span class="params">node</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\\&#123;\\&#123;(.+?)\\&#125;\\&#125;/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> val = node.<span class="property">textContent</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (reg.<span class="title function_">test</span>(val)) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> key = <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="title function_">trim</span>()</span><br><span class="line"></span><br><span class="line">      node.<span class="property">textContent</span> = val.<span class="title function_">replace</span>(reg, <span class="variable language_">this</span>.<span class="property">vm</span>\[key\])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compileElement</span>(<span class="params">node</span>) &#123;</span><br><span class="line"></span><br><span class="line">    !\[...node.<span class="property">attributes</span>\].<span class="title function_">forEach</span>(<span class="function">(<span class="params">attr</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> attrName = attr.<span class="property">name</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isDirective</span>(attrName)) &#123;</span><br><span class="line"></span><br><span class="line">        attrName = attrName.<span class="title function_">substr</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> key = attr.<span class="property">value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update</span>(node, key, attrName)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">node, key, attrName</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> updateFn = <span class="variable language_">this</span>\[attrName + <span class="string">&#x27;Updater&#x27;</span>\]</span><br><span class="line"></span><br><span class="line">    updateFn &amp;&amp; <span class="title function_">updateFn</span>(node, key, <span class="variable language_">this</span>.<span class="property">vm</span>\[key\])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">textUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    node.<span class="property">textContent</span> = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">modelUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    node.<span class="property">value</span> = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">isDirective</span>(<span class="params">attr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> attr.<span class="title function_">startsWith</span>(<span class="string">&#x27;v-&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">isElementNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">isTextNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-dep-js"><a href="#4-dep-js" class="headerlink" title="4.dep.js"></a>4.dep.js</h3><p>写一个<strong>Dep</strong>类 它相当于 观察者中的发布者 每个响应式属性都会创建这么一个 <strong>Dep</strong> 对象 ，负责收集该依赖属性的<strong>Watcher</strong>对象 （是在使用响应式数据的时候做的操作）</p>
<p>当我们对响应式属性在 <strong>setter</strong> 中进行更新的时候，会调用 <strong>Dep</strong> 中 <strong>notify</strong> 方法发送更新通知</p>
<p>然后去调用 <strong>Watcher</strong> 中的 <strong>update</strong> 实现视图的更新操作（是当数据发生变化的时候去通知观察者调用观察者的update更新视图）</p>
<p>总的来说 在<strong>Dep</strong>(这里指发布者) 中负责收集依赖 添加观察者(这里指<strong>Wathcer</strong>)，然后在 <strong>setter</strong> 数据更新的时候通知观察者</p>
<p>说的这么多重复的话，大家应该知道是在哪个阶段 收集依赖 哪个阶段 通知观察者了吧，下面就来实现一下吧</p>
<blockquote>
<p>先写<strong>Dep</strong>类</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = \[\]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addSub</span>(<span class="params">sub</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sub &amp;&amp; sub.<span class="property">update</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">sub</span>) =&gt;</span> &#123;</span><br><span class="line">      sub.<span class="title function_">update</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 <strong>obsever.js</strong> 中使用<strong>Dep</strong></p>
</blockquote>
<p>在 <strong>get</strong> 中添加 <strong>Dep.target</strong> (观察者)</p>
<p>在 <strong>set</strong> 中 触发 <strong>notify</strong> (通知)</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">data</span>) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">defineReactive</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">	  ...</span><br><span class="line"></span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> &amp;&amp; dep.<span class="title function_">addSub</span>(<span class="title class_">Dep</span>.<span class="property">target</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue === value) <span class="keyword">return</span></span><br><span class="line">        value = newValue</span><br><span class="line">        self.<span class="title function_">walk</span>(newValue)</span><br><span class="line"></span><br><span class="line">        dep.<span class="title function_">notify</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-watcher-js"><a href="#5-watcher-js" class="headerlink" title="5.watcher.js"></a>5.watcher.js</h3><p>**watcher **的作用 数据更新后 收到通知之后 调用 <strong>update</strong> 进行更新</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm, key, cb</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldValue</span> = vm\[key\]</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newValue = <span class="variable language_">this</span>.<span class="property">vm</span>\[<span class="variable language_">this</span>.<span class="property">key</span>\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newValue === <span class="variable language_">this</span>.<span class="property">oldValue</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">cb</span>(newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么去哪里创建 <strong>Watcher</strong> 呢？还记得在 <strong>compiler.js</strong>中 对文本节点的编译操作吗</p>
<p>在编译完文本节点后 在这里添加一个 <strong>Watcher</strong></p>
<p>还有 <strong>v-text**</strong>v-model<strong> 指令 当编译的是元素节点 就添加一个 </strong>Watcher**</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span> = vm.<span class="property">$el</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">compile</span>(<span class="variable language_">this</span>.<span class="property">el</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compile</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> childNodes = \[...el.<span class="property">childNodes</span>\]</span><br><span class="line">    childNodes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isTextNode</span>(node)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileText</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line">       ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compileText</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\\&#123;\\&#123;(.+)\\&#125;\\&#125;/</span></span><br><span class="line">    <span class="keyword">let</span> val = node.<span class="property">textContent</span></span><br><span class="line">    <span class="keyword">if</span> (reg.<span class="title function_">test</span>(val)) &#123;</span><br><span class="line">      <span class="keyword">let</span> key = <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="title function_">trim</span>()</span><br><span class="line">      node.<span class="property">textContent</span> = val.<span class="title function_">replace</span>(reg, <span class="variable language_">this</span>.<span class="property">vm</span>\[key\])</span><br><span class="line"></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">        node.<span class="property">textContent</span> = newValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">textUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    node.<span class="property">textContent</span> = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">textContent</span> = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">modelUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    node.<span class="property">value</span> = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">value</span> = newValue</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    node.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">vm</span>\[key\] = node.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 我们改变 响应式属性的时候 触发了 <strong>set()</strong> 方法 ，然后里面 发布者 <strong>dep.notify</strong> 方法启动了，拿到了 所有的 观察者 <strong>watcher</strong> 实例去执行 <strong>update</strong> 方法调用了回调函数 <strong>cb(newValue)</strong> 方法并把 新值传递到了 <strong>cb()</strong> 当中 <strong>cb</strong>方法是的具体更新视图的方法 去更新视图</p>
<p>比如上面的例子里的第三个参数 <strong>cb</strong>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">    node.<span class="property">textContent</span> = newValue</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>还有一点要实现<strong>v-model</strong>的双向绑定</p>
<p>不仅要通过修改数据来触发更新视图，还得为<strong>node</strong>添加 <strong>input</strong> 事件 改变 <strong>data</strong>数据中的属性</p>
<p>来达到双向绑定的效果</p>
<h2 id="7-测试下自己写的"><a href="#7-测试下自己写的" class="headerlink" title="7.测试下自己写的"></a>7.测试下自己写的</h2><blockquote>
<p>到了目前为止 响应式 和 双向绑定 都基本实现了 那么来写个例子测试下</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;msg&#125;&#125; <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    &#123;&#123;age&#125;&#125; <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-text</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/dep.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/watcher.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/compiler.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/observer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">msg</span>: <span class="string">&#x27;123&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>: <span class="number">21</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1e875a85d8845f7b6a92e98ba7d1f3a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="8"></p>
<p>OK 基本实现了 通过 观察者模式 来 实现 响应式原理</p>
<h2 id="8-五个文件代码"><a href="#8-五个文件代码" class="headerlink" title="8.五个文件代码"></a>8.五个文件代码</h2><p>这里直接把5个文件个代码贴出来 上面有的地方省略了,下面是完整的方便大家阅读</p>
<blockquote>
<p>vue.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$options</span> = options || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$el</span> =</span><br><span class="line">      <span class="keyword">typeof</span> options.<span class="property">el</span> === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">        ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>)</span><br><span class="line">        : options.<span class="property">el</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$data</span> = options.<span class="property">data</span> || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_proxyData</span>(<span class="variable language_">this</span>.<span class="property">$data</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Compiler</span>(<span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_proxyData</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, key, &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> data\[key\]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (newValue === data\[key\]) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">          data\[key\] = newValue</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>obsever.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">defineReactive</span>(data, key, data\[key\])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">defineReactive</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> &amp;&amp; dep.<span class="title function_">addSub</span>(<span class="title class_">Dep</span>.<span class="property">target</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newValue === value) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        value = newValue</span><br><span class="line"></span><br><span class="line">        self.<span class="title function_">walk</span>(newValue)</span><br><span class="line"></span><br><span class="line">        dep.<span class="title function_">notify</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>compiler.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Compiler</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span> = vm.<span class="property">$el</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">compile</span>(<span class="variable language_">this</span>.<span class="property">el</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compile</span>(<span class="params">el</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> childNodes = \[...el.<span class="property">childNodes</span>\]</span><br><span class="line">    childNodes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isTextNode</span>(node)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileText</span>(node)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isElementNode</span>(node)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileElement</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">childNodes</span> &amp;&amp; node.<span class="property">childNodes</span>.<span class="property">length</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compile</span>(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compileText</span>(<span class="params">node</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\\&#123;\\&#123;(.+?)\\&#125;\\&#125;/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> val = node.<span class="property">textContent</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (reg.<span class="title function_">test</span>(val)) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> key = <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="title function_">trim</span>()</span><br><span class="line"></span><br><span class="line">      node.<span class="property">textContent</span> = val.<span class="title function_">replace</span>(reg, <span class="variable language_">this</span>.<span class="property">vm</span>\[key\])</span><br><span class="line"></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">        node.<span class="property">textContent</span> = newValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compileElement</span>(<span class="params">node</span>) &#123;</span><br><span class="line"></span><br><span class="line">    !\[...node.<span class="property">attributes</span>\].<span class="title function_">forEach</span>(<span class="function">(<span class="params">attr</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> attrName = attr.<span class="property">name</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isDirective</span>(attrName)) &#123;</span><br><span class="line"></span><br><span class="line">        attrName = attrName.<span class="title function_">substr</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> key = attr.<span class="property">value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update</span>(node, key, attrName)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">node, key, attrName</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> updateFn = <span class="variable language_">this</span>\[attrName + <span class="string">&#x27;Updater&#x27;</span>\]</span><br><span class="line"></span><br><span class="line">    updateFn &amp;&amp; updateFn.<span class="title function_">call</span>(<span class="variable language_">this</span>, node, key, <span class="variable language_">this</span>.<span class="property">vm</span>\[key\])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">textUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    node.<span class="property">textContent</span> = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">textContent</span> = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">modelUpdater</span>(<span class="params">node, key, value</span>) &#123;</span><br><span class="line">    node.<span class="property">value</span> = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.<span class="property">value</span> = newValue</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    node.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">vm</span>\[key\] = node.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">isDirective</span>(<span class="params">attr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> attr.<span class="title function_">startsWith</span>(<span class="string">&#x27;v-&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">isElementNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">isTextNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>dep.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = \[\]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addSub</span>(<span class="params">sub</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sub &amp;&amp; sub.<span class="property">update</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">sub</span>) =&gt;</span> &#123;</span><br><span class="line">      sub.<span class="title function_">update</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>watcher.js</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm, key, cb</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldValue</span> = vm\[key\]</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newValue = <span class="variable language_">this</span>.<span class="property">vm</span>\[<span class="variable language_">this</span>.<span class="property">key</span>\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newValue === <span class="variable language_">this</span>.<span class="property">oldValue</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">cb</span>(newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://liantianno1.github.io/xiaolangwiki/2021/07/24/17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/xiaolangwiki/images/avatar.png">
      <meta itemprop="name" content="小浪wiki">
      <meta itemprop="description" content="一个关于编程、计算机、软件工程、互联网的知识库。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小浪wiki">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/xiaolangwiki/2021/07/24/17/" class="post-title-link" itemprop="url">从使用到自己实现简单Vue Router看这个就行</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-24 08:00:17" itemprop="dateCreated datePublished" datetime="2021-07-24T08:00:17+08:00">2021-07-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/xiaolangwiki/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="从使用到自己实现简单Vue-Router看这个就行了"><a href="#从使用到自己实现简单Vue-Router看这个就行了" class="headerlink" title="从使用到自己实现简单Vue Router看这个就行了"></a>从使用到自己实现简单Vue Router看这个就行了</h2><p>原文：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6988316779818778631">https://juejin.cn/post/6988316779818778631</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>这是小浪在学习<strong>Vue Router</strong> 总结的笔记，有的地方写的不是很好，请大家多多指教</p>
<ul>
<li>这里带你了解 <strong>Vue Router</strong> 的基本使用</li>
<li>手写一个基础的 <strong>Vue Router</strong> 感受下基础的实现</li>
<li>有了之前的基础，那么按照官方的源码 再写个 <strong>Vue Router</strong> 吧</li>
</ul>
<p>在两个手写<strong>Vue Router</strong>地方我都有写详细的注释</p>
<p>希望这篇文章对您有所帮助，建议自己手动去敲下</p>
<p>最后：小浪在线<strong>求赞</strong></p>
</blockquote>
<h1 id="Vue-Router-基础"><a href="#Vue-Router-基础" class="headerlink" title="Vue Router 基础"></a>Vue Router 基础</h1><p>让我们先来了解下<code>Vue Router</code>的简单使用吧，先了解怎么使用，之后再去想办法怎么去实现</p>
<h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p>路由：本质上是一种对应关系</p>
<p>分类分为<strong>前端路由</strong>和<strong>后端路由</strong></p>
<blockquote>
<p>后端路由</p>
</blockquote>
<p>比如node.js 的路由是 <strong>URL</strong>的请求地址和服务器上面的<strong>资源</strong>对应，根据不同的请求地址返回不同的资源</p>
<blockquote>
<p>前端路由</p>
</blockquote>
<p>在<strong>SPA</strong>（单页应用）中根据用户所触发的事件改变了<strong>URL</strong> 在无需刷新的前提下 显示不同的页面内容，比如等下就要讲的<strong>Vue Router</strong></p>
<h2 id="2-Vue-Router最基础的使用步骤"><a href="#2-Vue-Router最基础的使用步骤" class="headerlink" title="2.Vue-Router最基础的使用步骤"></a>2.Vue-Router最基础的使用步骤</h2><h3 id="1-引入Vue-Router文件"><a href="#1-引入Vue-Router文件" class="headerlink" title="1.引入Vue-Router文件"></a>1.引入Vue-Router文件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue-router_3.0.2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-在页面上添加-router-link-和-router-view"><a href="#2-在页面上添加-router-link-和-router-view" class="headerlink" title="2.在页面上添加 router-link 和 router-view"></a>2.在页面上添加 router-link 和 router-view</h3> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-创建路由组件"><a href="#3-创建路由组件" class="headerlink" title="3.创建路由组件"></a>3.创建路由组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> home = &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">&lt;div&gt;欢迎来到&#123;&#123;name&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> login = &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">		&lt;div&gt;欢迎来到登录页&lt;/div&gt;</span></span><br><span class="line"><span class="string">	`</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-配置路由规则"><a href="#4-配置路由规则" class="headerlink" title="4.配置路由规则"></a>4.配置路由规则</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: \[</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: home,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: login,</span><br><span class="line">        &#125;,</span><br><span class="line">    \],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="5-挂载路由"><a href="#5-挂载路由" class="headerlink" title="5.挂载路由"></a>5.挂载路由</h3> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">        router,</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76bdf2efd0d14eecb50e7dfc199e36f3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="2"></p>
<h2 id="3-嵌套路由"><a href="#3-嵌套路由" class="headerlink" title="3.嵌套路由"></a>3.嵌套路由</h2><blockquote>
<p>这里的嵌套路由是基于上面的例子继续写的</p>
</blockquote>
<h3 id="1-在路由里面添加-子路由链接和-占位符"><a href="#1-在路由里面添加-子路由链接和-占位符" class="headerlink" title="1.在路由里面添加 子路由链接和 占位符"></a>1.在路由里面添加 子路由链接和 占位符</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> home = &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    欢迎来到首页</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    &lt;!\-\- 子路由链接 --&gt;</span></span><br><span class="line"><span class="string">    &lt;router-link to=&quot;/tab1&quot;&gt;Tab1&lt;/router-link&gt;</span></span><br><span class="line"><span class="string">    &lt;router-link to=&quot;/tab2&quot;&gt;Tab2&lt;/router-link&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;!\-\- 子路由展示 --&gt;</span></span><br><span class="line"><span class="string">    &lt;router-view&gt;&lt;/router-view&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-添加路由组件"><a href="#2-添加路由组件" class="headerlink" title="2.添加路由组件"></a>2.添加路由组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tab1 = &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    子路由1</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> tab2 = &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    子路由2</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-配置路由规则"><a href="#3-配置路由规则" class="headerlink" title="3.配置路由规则"></a>3.配置路由规则</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: \[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: home,</span><br><span class="line"></span><br><span class="line">            <span class="attr">children</span>: \[</span><br><span class="line">                &#123; <span class="attr">path</span>: <span class="string">&#x27;/tab1&#x27;</span>, <span class="attr">component</span>: tab1 &#125;,</span><br><span class="line">                &#123; <span class="attr">path</span>: <span class="string">&#x27;/tab2&#x27;</span>, <span class="attr">component</span>: tab2 &#125;,</span><br><span class="line">            \],</span><br><span class="line">        &#125;,</span><br><span class="line">    \],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c79adc65ba146ba89240855603e262c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="3"></p>
<h2 id="4-动态路由"><a href="#4-动态路由" class="headerlink" title="4.动态路由"></a>4.动态路由</h2><blockquote>
<p><code>path</code>属性加上<code>/:id</code> 使用<code>route</code>对象的<code>params.id</code>获取动态参数</p>
</blockquote>
<p>比如现在有这么多个路由，如果自己也配置多个路由，岂不是有点。。。多余</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/goods/1&quot;</span>&gt;</span>goods1<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/goods/2&quot;</span>&gt;</span>goods2<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/goods/3&quot;</span>&gt;</span>goods3<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/goods/4&quot;</span>&gt;</span>goods4<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后这里就可以使用 动态路由来解决</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> goods = &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div&gt;欢迎来到商品 &#123;&#123;$route.params.id&#125;&#125;页&lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">        <span class="attr">routes</span>: \[</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;/goods/:id&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: goods,</span><br><span class="line">            &#125;,</span><br><span class="line">        \],</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">        router,</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ccc5241e7f94107b59e39225390b0e6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="4"></p>
<blockquote>
<p>最后提一下还可以用<strong>query</strong>进行传参.</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 比如</span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/goods?id=1&quot;</span>&gt;</span>goods<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后使用<code>this.$route.query.id</code>就可以在路由组件中获取到<strong>id</strong></p>
<blockquote>
<p>添加动态路由</p>
</blockquote>
<p>使用 <code>this.$router.addRoutes(\[\])</code> 可以<strong>添加动态路由</strong>,里面传递是一个数组 和 <strong>routes</strong>里面一样</p>
<h2 id="5-路由传参"><a href="#5-路由传参" class="headerlink" title="5.路由传参"></a>5.路由传参</h2><blockquote>
<p>我们可以使用 props 进行传值</p>
<p>为啥要用 props 进行传值，route不香了吗，确实route 不够灵活</p>
<p>props 值有三种情况</p>
</blockquote>
<h3 id="1-布尔值类型"><a href="#1-布尔值类型" class="headerlink" title="1.布尔值类型"></a>1.布尔值类型</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> goods = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">props</span>: \[<span class="string">&#x27;id&#x27;</span>\],</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;欢迎来到商品 &#123;&#123;id&#125;&#125;页&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: \[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/goods/:id&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: goods,</span><br><span class="line"></span><br><span class="line">            <span class="attr">props</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    \],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-对象类型"><a href="#2-对象类型" class="headerlink" title="2.对象类型"></a>2.对象类型</h3><p>但是这里就获取不到 <code>id</code> 了，会<strong>报错</strong></p>
<p>这里的id 需要 <code>$route.params.id</code> 获取</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> goods = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">props</span>: \[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;id&#x27;</span>\],</span><br><span class="line"></span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;&#123;&#123;info&#125;&#125;来到&#123;&#123;name&#125;&#125; &#123;&#123;id&#125;&#125;页&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: \[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/goods/:id&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: goods,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="attr">props</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;商品&#x27;</span>,</span><br><span class="line">                <span class="attr">info</span>: <span class="string">&#x27;欢迎&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    \],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-函数"><a href="#3-函数" class="headerlink" title="3.函数"></a>3.函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> goods = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">props</span>: \[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;id&#x27;</span>\],</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;&#123;&#123;info&#125;&#125;来到&#123;&#123;name&#125;&#125; &#123;&#123;id&#125;&#125;页&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: \[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/goods/:id&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: goods,</span><br><span class="line"></span><br><span class="line">            <span class="attr">props</span>: <span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;商品&#x27;</span>,</span><br><span class="line">                    <span class="attr">info</span>: <span class="string">&#x27;欢迎&#x27;</span>,</span><br><span class="line">                    <span class="attr">id</span>: route.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    \],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="6-route-和-router"><a href="#6-route-和-router" class="headerlink" title="6.route 和 router"></a>6.route 和 router</h2><blockquote>
<p>在上面提到了<strong>route</strong> 那么和 <strong>router</strong>有什么区别呢</p>
</blockquote>
<ul>
<li><strong>route</strong>为<strong>当前router跳转对象</strong>里面可以获取<strong>path</strong>，<strong>params</strong>，<strong>hash</strong>，<strong>query</strong>，<strong>fullPath</strong>，<strong>matched</strong>，<strong>name</strong></li>
<li><strong>router</strong>为<strong>VueRouter实例</strong>用 <strong>new VueRouter</strong>创建的实例，想要导航到不同<strong>URL</strong>，则使用<code>router.push</code>方法</li>
<li><strong>routes</strong>是<strong>router</strong>路由实例用来配置路由对象（顺带提一下）</li>
</ul>
<h2 id="7-命名路由"><a href="#7-命名路由" class="headerlink" title="7.命名路由"></a>7.命名路由</h2><p>路由组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> goods = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">props</span>: \[<span class="string">&#x27;id&#x27;</span>\],</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;商品&#123;&#123;id&#125;&#125;页&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>路由配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">    <span class="attr">routes</span>: \[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/goods/:id&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: goods,</span><br><span class="line">        &#125;,</span><br><span class="line">    \],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>绑定 <code>:to</code> 通过<code>name</code>找到定义的路由 还可以使用 <code>params</code> 传递参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;name: &#x27;goods&#x27;, params: &#123; id: 1 &#125; &#125;&quot;</span>&gt;</span>goods1<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="8-编程式导航"><a href="#8-编程式导航" class="headerlink" title="8.编程式导航"></a>8.编程式导航</h2><h3 id="1-声明式导航"><a href="#1-声明式导航" class="headerlink" title="1.声明式导航"></a>1.声明式导航</h3><blockquote>
<p>既然提到了编程式导航，那么先简单说下声明式导航</p>
</blockquote>
<p>上面所展示的都是<strong>声明是导航</strong> 比如<strong>router-link</strong></p>
<p><code>&lt;router-link to=&quot;/goods/1&quot;&gt;goods1&lt;/router-link&gt;</code></p>
<p>还有<strong>a</strong>标签</p>
<p><code>&lt;a href=&quot;#/goods/1&quot;&gt;goods1&lt;/a&gt;</code></p>
<h3 id="2-编程式导航"><a href="#2-编程式导航" class="headerlink" title="2.编程式导航"></a>2.编程式导航</h3><blockquote>
<p>使用<strong>javaScript</strong>来控制<strong>路由跳转</strong></p>
</blockquote>
<p>在普通的网页中使用 <code>loaction.href``window.open</code> 等等进行跳转</p>
<p>现在我要介绍的是<strong>Vue Router</strong>中的编程式导航</p>
<p>我们平时都是用<strong>router.push()</strong> **router.go(n)**方法进行跳转</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$ruter</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&#x27;/goods&#x27;</span>,<span class="attr">query</span>:&#123;<span class="attr">id</span>:<span class="string">&#x27;1&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;goods&#x27;</span>,<span class="attr">params</span>:&#123;<span class="attr">id</span>:<span class="number">1</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>(-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="9-路由守卫"><a href="#9-路由守卫" class="headerlink" title="9.路由守卫"></a>9.路由守卫</h2><h3 id="1-全局守卫"><a href="#1-全局守卫" class="headerlink" title="1.全局守卫"></a>1.全局守卫</h3><p><strong>router.beforeEach</strong> 全局守卫 对所有的路由都起作用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/error&#x27;</span>, <span class="attr">replace</span>: <span class="literal">true</span>, <span class="attr">query</span>: &#123; <span class="attr">back</span>: <span class="literal">false</span> &#125;&#125;</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>全局的守卫的三个参数</p>
</blockquote>
<p><code>to</code>: 即将要进入的目标 路由对象</p>
<p><code>from</code>: 当前导航正要离开 路由对象</p>
<p><code>next</code>: 参数不同做的事也不同</p>
<blockquote>
<ul>
<li><strong>next()</strong> 直接进入下一个钩子</li>
<li><strong>next(false)</strong> 停止当前导航</li>
<li><strong>next(‘/路径’)</strong> 跳转到<strong>path</strong>路由地址 当然这里面也可以写成对象形式 <strong>next({path : ‘/路径’})</strong></li>
<li><strong>next(error)</strong>: 如果传入参数是一个 <strong>Error</strong> 实例，则导航会被终止且该错误会被传递给 <code>router.onError()</code></li>
</ul>
</blockquote>
<h3 id="2-路由独享的守卫"><a href="#2-路由独享的守卫" class="headerlink" title="2.路由独享的守卫"></a>2.路由独享的守卫</h3><p><strong>beforeEnter</strong> 路由对象独享的守卫写在<strong>routes</strong>里面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: \[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/goods&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: goods,</span><br><span class="line">      <span class="attr">beforeEnter</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  \]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-组件内的守卫-了解"><a href="#3-组件内的守卫-了解" class="headerlink" title="3.组件内的守卫(了解)"></a>3.组件内的守卫(了解)</h3><p>组件内的守卫 写在组件内部 下面是官方介绍</p>
<ul>
<li><strong>beforeRouteEnter</strong> 进入路由前,组件还没有被实例化所以这里无法获取到this</li>
<li><strong>beforeRouteUpdate (2.2)</strong> 这个阶段可以获取this,在路由复用同一个组件时触发</li>
<li><strong>beforeRouteLeave</strong> 这个阶段可以获取this,当离开组件对应的路由时,此时可以用来保存数据,或数据初始化,或关闭定时器等等</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> goods = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;goods&lt;/div&gt;`</span>,</span><br><span class="line">  <span class="title function_">beforeRouteEnter</span> (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span> (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteLeave</span> (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-组件缓存-keep-alive"><a href="#10-组件缓存-keep-alive" class="headerlink" title="10.组件缓存 keep-alive"></a>10.组件缓存 <strong>keep-alive</strong></h2><p>页面重新加载会重新渲染页面比如回退的时候等等，我们有的组件它不是一个活动的(数据不变)不希望它被重新渲染，所以这里就可以使用 <strong><code>&lt;keep-alive&gt; &lt;/keep-alive&gt;</code></strong> 包裹起来，这样就不会触发<code>created</code>钩子</p>
<p>应用场景：获取一个商品的详情然后回退在前进的时候就使用缓存，提高性能</p>
<h3 id="1-不使用-keep-alive例子"><a href="#1-不使用-keep-alive例子" class="headerlink" title="1.不使用 keep-alive例子"></a>1.不使用 keep-alive例子</h3><blockquote>
<p>这里home 组件在<strong>created</strong>进行打印当前的时间</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>login<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">      <span class="keyword">const</span> login = &#123;</span><br><span class="line">        <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div&gt;Login&lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>,</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> home = &#123;</span><br><span class="line">        <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div&gt;Home&lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>,</span><br><span class="line">        <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">        <span class="attr">routes</span>: \[</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">            <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: home,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">            <span class="attr">component</span>: login,</span><br><span class="line">          &#125;,</span><br><span class="line">        \],</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;&#125;,</span><br><span class="line">        router,</span><br><span class="line">      &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12d49c936f34449798635c804731805c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="5"></p>
<p>如上，每切换<code>home</code> 的路由 组件就会<strong>重新渲染</strong>，打印当前的时间</p>
<p>如果使用 <strong>keep-alive</strong> 会有什么效果呢</p>
<h3 id="2-使用keep-alive"><a href="#2-使用keep-alive" class="headerlink" title="2.使用keep-alive"></a>2.使用keep-alive</h3><blockquote>
<p>这里只需简单的包裹起来就行了</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>login<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d9d1e2bdad646d88b3d9823980fbef8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="6"></p>
<p>可以看到的是只打印一次，说明切换了路由它并<strong>没有重新渲染组件</strong></p>
<blockquote>
<p>当然可以在 组件内取个<strong>name</strong>名字 <code>keep-alive</code> 标签里面添加 <strong>include</strong> 属性就可以对相应的组件进行缓存</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> login = &#123;</span><br><span class="line">    <span class="attr">name</span>: login,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;Login&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> home = &#123;</span><br><span class="line">    <span class="attr">name</span>: home,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;Home&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>login<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;login,home&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-activated-和-deactivated"><a href="#3-activated-和-deactivated" class="headerlink" title="3.activated 和 deactivated"></a>3.activated 和 deactivated</h3><blockquote>
<p>keep-alive 生命周期执行顺序</p>
</blockquote>
<p>第一次访问路由时：</p>
<ul>
<li><code>created</code>—&gt;<code>mounted</code> —&gt;<code>activated</code></li>
<li><code>deactivated</code>在退出后触发</li>
</ul>
<p><strong>以后进入只会触发</strong><code>activated</code></p>
<h2 id="11-hash-和-history-模式"><a href="#11-hash-和-history-模式" class="headerlink" title="11.hash 和 history 模式"></a>11.hash 和 history 模式</h2><h3 id="1-hash模式"><a href="#1-hash模式" class="headerlink" title="1.hash模式"></a>1.hash模式</h3><p>在vue-router中<strong>默认使用</strong>的是 <strong>hash</strong> 模式</p>
<p><code>hash</code>是url中的锚点就是<strong><code>#</code></strong>,通过锚点作为路由地址,我们通常改变的是改变<strong><code>#</code></strong>后面部分,实现浏览器渲染指定的组件.,锚点发生改变会触发 <strong>onhashchange</strong> 事件</p>
<h3 id="2-history模式"><a href="#2-history模式" class="headerlink" title="2.history模式"></a>2.history模式</h3><p>history 模式就是平时正常的地址，使用方面需要服务器支持</p>
<p>如果访问的路径资源没有 直接就是 <code>404</code></p>
<p>在<strong>HTML5</strong>后新增了两个API</p>
<p><strong>pushState()</strong>: IE10后支持</p>
<p><strong>replaceState()</strong></p>
<p>在<code>vue-router</code>中如果要使用 <code>history</code> 模式<strong>需要指定</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="实现一个基础-Vue-Router"><a href="#实现一个基础-Vue-Router" class="headerlink" title="实现一个基础 Vue Router"></a>实现一个基础 Vue Router</h1><blockquote>
<p>复习上面的路由的基础那么我们不如来写个Vue Router吧</p>
</blockquote>
<p>实现的这个 Vue Router是基于 history模式</p>
<p>所有的步骤都放到代码的注释中，每一行都写个注释</p>
<p>这个简单的没有按照Vue Router源码来写主要是一些基础功能的实现</p>
<p>为后面的按照源码写打基础</p>
<h2 id="1-注册全局Vue-Router"><a href="#1-注册全局Vue-Router" class="headerlink" title="1.注册全局Vue Router"></a>1.注册全局Vue Router</h2><blockquote>
<p>首先就是先注册自己的 Vue Router</p>
<p>判断是否注册了组件</p>
<p>在Vue实例创建完成进行注册</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">MyVueRouter</span>.<span class="property">install</span>.<span class="property">installed</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">MyVueRouter</span>.<span class="property">install</span>.<span class="property">installed</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    _Vue = <span class="title class_">Vue</span></span><br><span class="line"></span><br><span class="line">    _Vue.<span class="title function_">mixin</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>) &#123;</span><br><span class="line"></span><br><span class="line">          _Vue.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$router</span> = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-实现-构造方法"><a href="#2-实现-构造方法" class="headerlink" title="2.实现 构造方法"></a>2.实现 构造方法</h2><blockquote>
<p><strong>optoins</strong> 保存传入的规则</p>
<p><strong>routerMap</strong> 确定地址和组件的关系</p>
<p><strong>current</strong> 表示当前的地址是响应式的之后渲染组件和它相关</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">optoins</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">optoins</span> = optoins</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routerMap</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = _Vue.<span class="title function_">observable</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">current</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-解析路由规则"><a href="#3-解析路由规则" class="headerlink" title="3.解析路由规则"></a>3.解析路由规则</h2><blockquote>
<p>传入的路由规则拿到一个对象里 地址 和 组件一一匹配</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createRouterMap</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">optoins</span>.<span class="property">routes</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">routerMap</span>\[item.<span class="property">path</span>\] = item.<span class="property">component</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-实现-router-link-组件"><a href="#4-实现-router-link-组件" class="headerlink" title="4.实现 router-link 组件"></a>4.实现 router-link 组件</h2><blockquote>
<p>router-link就是页面上所展示的路由链接</p>
<p>因为一般使用的基本都是运行版的Vue 所以自己把组件转为 虚拟DOM</p>
<p>还有就是链接会刷新的问题</p>
<p>自己写个函数进行跳转阻止默认事件</p>
<p>还得注意对应的路由所要渲染的组件</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initComponents</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;router-link&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">to</span>: <span class="title class_">String</span>,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line">          <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line"></span><br><span class="line">          &#123;</span><br><span class="line"></span><br><span class="line">            <span class="attr">attrs</span>: &#123;</span><br><span class="line">              <span class="attr">href</span>: <span class="variable language_">this</span>.<span class="property">to</span>,</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line"></span><br><span class="line">              <span class="attr">click</span>: <span class="variable language_">this</span>.<span class="property">myClick</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line"></span><br><span class="line">          \[<span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span>\]</span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">methods</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">myClick</span>(<span class="params">e</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          history.<span class="title function_">pushState</span>(&#123;&#125;, <span class="string">&#x27;&#x27;</span>, <span class="variable language_">this</span>.<span class="property">to</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">data</span>.<span class="property">current</span> = <span class="variable language_">this</span>.<span class="property">to</span></span><br><span class="line"></span><br><span class="line">          e.<span class="title function_">preventDefault</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="5-实现-router-view-组件"><a href="#5-实现-router-view-组件" class="headerlink" title="5.实现 router-view 组件"></a>5.实现 router-view 组件</h2><blockquote>
<p>这里从之前解析的规则里面拿到当前的对应的组件进行转为虚拟DOM</p>
<p>最后<code>router-view</code>占位渲染到页面上</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initComponents</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;router-view&#x27;</span>, &#123;</span><br><span class="line">      <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> component = <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">routerMap</span>\[<span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">data</span>.<span class="property">current</span>\]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">h</span>(component)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-前进和后退"><a href="#6-前进和后退" class="headerlink" title="6.前进和后退"></a>6.前进和后退</h2><blockquote>
<p>在完成之前的编写还是不够的，因为在浏览器点后退和前进虽然改变了浏览器的地址，但是组件却没有刷新，下面就来解决这个问题</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initEvent</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">current</span> = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-在router挂载后进行初始化"><a href="#7-在router挂载后进行初始化" class="headerlink" title="7.在router挂载后进行初始化"></a>7.在router挂载后进行初始化</h2><blockquote>
<p>最后写个函数进行初始化</p>
<p>在router注册到Vue之后进行 初始化</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">createRouterMap</span>()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initComponents</span>(_Vue)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initEvent</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">MyVueRouter</span>.<span class="property">install</span>.<span class="property">installed</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="title class_">MyVueRouter</span>.<span class="property">install</span>.<span class="property">installed</span> = <span class="literal">true</span></span><br><span class="line">    _Vue = <span class="title class_">Vue</span></span><br><span class="line">    _Vue.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">      <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>) &#123;</span><br><span class="line">          _Vue.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$router</span> = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span></span><br><span class="line"></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>.<span class="title function_">init</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-放上完整的-index-js"><a href="#8-放上完整的-index-js" class="headerlink" title="8.放上完整的 index.js"></a>8.放上完整的 index.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyVueRouter</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">MyVueRouter</span>.<span class="property">install</span>.<span class="property">installed</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">MyVueRouter</span>.<span class="property">install</span>.<span class="property">installed</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    _Vue = <span class="title class_">Vue</span></span><br><span class="line"></span><br><span class="line">    _Vue.<span class="title function_">mixin</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>) &#123;</span><br><span class="line"></span><br><span class="line">          _Vue.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$router</span> = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span></span><br><span class="line"></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>.<span class="title function_">init</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">optoins</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">optoins</span> = optoins</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routerMap</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = _Vue.<span class="title function_">observable</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">current</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createRouterMap</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">optoins</span>.<span class="property">routes</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">routerMap</span>\[item.<span class="property">path</span>\] = item.<span class="property">component</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initComponents</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;router-link&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">to</span>: <span class="title class_">String</span>,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line">          <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line"></span><br><span class="line">          &#123;</span><br><span class="line"></span><br><span class="line">            <span class="attr">attrs</span>: &#123;</span><br><span class="line">              <span class="attr">href</span>: <span class="variable language_">this</span>.<span class="property">to</span>,</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line"></span><br><span class="line">              <span class="attr">click</span>: <span class="variable language_">this</span>.<span class="property">myClick</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          \[<span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span>\]</span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">methods</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">myClick</span>(<span class="params">e</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          history.<span class="title function_">pushState</span>(&#123;&#125;, <span class="string">&#x27;&#x27;</span>, <span class="variable language_">this</span>.<span class="property">to</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">data</span>.<span class="property">current</span> = <span class="variable language_">this</span>.<span class="property">to</span></span><br><span class="line"></span><br><span class="line">          e.<span class="title function_">preventDefault</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;router-view&#x27;</span>, &#123;</span><br><span class="line">      <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> component = <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">routerMap</span>\[<span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">data</span>.<span class="property">current</span>\]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">h</span>(component)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initEvent</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">current</span> = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">createRouterMap</span>()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initComponents</span>(_Vue)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initEvent</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到了这里基础的实现功能差不多了，上面的例子是为了下面打基础，所有的功能实现基本都是在一个文件下很不严谨，下面就严格按照<strong>Vue Router</strong> 源码来实现自己 <strong>Vue Router</strong></p>
<h1 id="Vue-Router实现"><a href="#Vue-Router实现" class="headerlink" title="Vue Router实现"></a>Vue Router实现</h1><blockquote>
<p>经过上面简单的实现，现在我们按照Vue Router源码的方式进行编写</p>
</blockquote>
<h2 id="1-首先是Vue-Router-构造"><a href="#1-首先是Vue-Router-构造" class="headerlink" title="1.首先是Vue Router 构造"></a>1.首先是Vue Router 构造</h2> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VueRouter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_options</span> = options.<span class="property">routes</span> || \[\]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params">Vue</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-注册组件-install"><a href="#2-注册组件-install" class="headerlink" title="2.注册组件 install"></a>2.注册组件 install</h2><blockquote>
<p>在 <strong>install.js</strong> 对自己写的<strong>Vue-Router</strong>进行全局的注册</p>
<p>之后还会在这里创建 <strong> $r o u t e r <em> </em> <em> </em>$) route</strong></p>
<p>还有注册 <strong>router-link**</strong>router-view**</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">  _Vue = <span class="title class_">Vue</span></span><br><span class="line"></span><br><span class="line">  _Vue.<span class="title function_">mixin</span>(&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_routerRoot</span> = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_router</span> = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_router</span>.<span class="title function_">init</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.\_routerRoot = (<span class="variable language_">this</span>.<span class="property">$parent</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$parent</span>.\_routerRoot) || <span class="variable language_">this</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 <code>index.js</code>中导入<strong>install</strong> 进行为构造添加 <strong>install</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> install <span class="keyword">from</span> <span class="string">&#x27;./install&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VueRouter</span> &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">VueRouter</span>.<span class="property">install</span> = install</span><br></pre></td></tr></table></figure>
<h2 id="3-编写-create-route-map-js"><a href="#3-编写-create-route-map-js" class="headerlink" title="3.编写 create-route-map.js"></a>3.编写 create-route-map.js</h2><blockquote>
<p>这个主要的作用就是用来解析传递过来的路由 需要导出然后在 <code>create-matcher.js</code>进行使用</p>
<p>具体的细节都写了注释</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">\*</span><br><span class="line"> \* @param &#123;*&#125; routes 路由规则</span><br><span class="line"> \* @param &#123;*&#125; oldPathList 路由列表</span><br><span class="line"> \* @param &#123;*&#125; oldPathMap 路由和组件的对应关系</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createRouteMap</span>(<span class="params">routes, oldPathList, oldPathMap</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pathList = oldPathList || \[\]</span><br><span class="line">  <span class="keyword">const</span> pathMap = oldPathMap || \[\]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  routes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">addRouteRecord</span>(route, pathList, pathMap)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pathList,</span><br><span class="line">    pathMap,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> \*</span><br><span class="line"> \* @param &#123;*&#125; route 路由规则</span><br><span class="line"> \* @param &#123;*&#125; pathList 路由列表</span><br><span class="line"> \* @param &#123;*&#125; pathMap 路由和组件之间的对应关系</span><br><span class="line"> \* @param &#123;*&#125; parentRecord  父路由</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addRouteRecord</span>(<span class="params">route, pathList, pathMap, parentRecord</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> path = parentRecord ? <span class="string">`<span class="subst">$&#123;parentRecord.path&#125;</span>/<span class="subst">$&#123;route.path&#125;</span>`</span> : route.<span class="property">path</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> record = &#123;</span><br><span class="line">    path,</span><br><span class="line">    <span class="attr">component</span>: route.<span class="property">component</span>,</span><br><span class="line">    <span class="attr">parent</span>: parentRecord,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!pathList\[path\]) &#123;</span><br><span class="line"></span><br><span class="line">    pathList.<span class="title function_">push</span>(path)</span><br><span class="line"></span><br><span class="line">    pathMap\[path\] = record</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (route.<span class="property">children</span>) &#123;</span><br><span class="line">    route.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">childRoute</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">addRouteRecord</span>(childRoute, pathList, pathMap, record)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-编写-create-matcher-js"><a href="#4-编写-create-matcher-js" class="headerlink" title="4.编写 create-matcher.js"></a>4.编写 create-matcher.js</h2><blockquote>
<p>这个模块的意义也是解析路由不过这个是个指挥家，上面实现的是具体解析操作</p>
<p>在这个模块里进行调用上面的具体解析路由的方法就行了</p>
<p>有了上面面具体的路由解析，这个<strong>create-matcher.js</strong>就容易实现了，只需要简单的调用它即可</p>
<p>这个模块返回了两个方法</p>
<ul>
<li><strong>match</strong> : 根据路由路径创建路由规则对象，之后就可以通过 规则对象获取到所有的路由信息然后拿到所有的组件进行创建</li>
<li><strong>addRoutes</strong> : 添加动态路由</li>
</ul>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createRouteMap <span class="keyword">from</span> <span class="string">&#x27;./create-route-map&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createMatcher</span>(<span class="params">router</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; pathList, pathMap &#125; = <span class="title function_">createRouteMap</span>(router)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">match</span>(<span class="params">path</span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addRoutes</span>(<span class="params">router</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">createRouteMap</span>(router, pathList, pathMap)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    match,</span><br><span class="line">    addRoutes,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后在<strong>index.js</strong>也就是<strong>Vue Router</strong>的构造中使用 <strong>createMatcher.</strong> 使用<strong>this.matcher</strong>接收</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> install <span class="keyword">from</span> <span class="string">&#x27;./install&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> createMatcher <span class="keyword">from</span> <span class="string">&#x27;./create-matcher&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VueRouter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_routes</span> = options.<span class="property">routes</span> || \[\]</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">matcher</span> = <span class="title function_">createMatcher</span>(<span class="variable language_">this</span>.<span class="property">_routes</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params">Vue</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">VueRouter</span>.<span class="property">install</span> = install</span><br></pre></td></tr></table></figure>
<h2 id="5-编写-createMatcher"><a href="#5-编写-createMatcher" class="headerlink" title="5.编写 createMatcher"></a>5.编写 createMatcher</h2><blockquote>
<p>看见上面在 <strong>createMatcher</strong>中定义了 一个<strong>match</strong>了吗，</p>
<p><strong>match</strong>是 从<strong>pathMap</strong> 根据<strong>path</strong>获取 相应的路由记录</p>
<p>上面还没有去实现，现在来实现它</p>
<p>需要实现它的话还需要编写个 <strong>createRoute</strong> 方法，我这里写在 <strong>uitl/route.js</strong>模块里</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">\*</span><br><span class="line"> \* @param &#123;*&#125; record 传过来的记录</span><br><span class="line"> \* @param &#123;*&#125; path 路由地址</span><br><span class="line"> \* @returns</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createRoute</span>(<span class="params">record, path</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> matched = \[\]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (record) &#123;</span><br><span class="line"></span><br><span class="line">    matched.<span class="title function_">unshift</span>(record)</span><br><span class="line"></span><br><span class="line">    record = record.<span class="property">parent</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    path,</span><br><span class="line">    matched,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面编写了 <strong>createRoute</strong>方法我们就可以在 <strong>create-mathcer.js</strong> 调用 来获取到记录了</p>
<p>然后再 <strong>create-mathcer.js</strong>中继续 完善 <strong>match</strong>方法</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createRouteMap <span class="keyword">from</span> <span class="string">&#x27;./create-route-map&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> createRoute <span class="keyword">from</span> <span class="string">&#x27;./util/route&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createMatcher</span>(<span class="params">router</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; pathList, pathMap &#125; = <span class="title function_">createRouteMap</span>(router)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">match</span>(<span class="params">path</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> record = pathMap\[path\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (record) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createRoute</span>(record, path)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createRoute</span>(<span class="literal">null</span>, path)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addRoutes</span>(<span class="params">router</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">createRouteMap</span>(router, pathList, pathMap)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    match,</span><br><span class="line">    addRoutes,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-历史记录的处理-History"><a href="#6-历史记录的处理-History" class="headerlink" title="6.历史记录的处理 History"></a>6.历史记录的处理 History</h2><blockquote>
<p>在 <strong>history</strong>目录下新建一个 <strong>base</strong>模块用来编写 父类</p>
<p>这个父类有 <strong>hash</strong> 模式 和 <strong>history</strong>(html5) 模式共同的方法</p>
<p>这里就主要演示下 <strong>hash</strong> 模式的代码</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createRoute <span class="keyword">from</span> <span class="string">&#x27;../util/route&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">History</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">router</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">router</span> = router</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">current</span> = <span class="title function_">createRoute</span>(<span class="literal">null</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">transitionTo</span>(<span class="params">path, onComplete</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">current</span> = <span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">matcher</span>.<span class="title function_">match</span>(path)</span><br><span class="line"></span><br><span class="line">    onComplete &amp;&amp; <span class="title function_">onComplete</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编写 <strong>HashHistory</strong> 模式 继承 <strong>History</strong></p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">History</span> <span class="keyword">from</span> <span class="string">&#x27;./base&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">HashHistory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">History</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">router</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(router)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ensuerSlash</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setUpListener</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;hashchange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">transitionTo</span>(<span class="variable language_">this</span>.<span class="title function_">getCurrentLocation</span>())</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getCurrentLocation</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> href = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span></span><br><span class="line">    <span class="keyword">const</span> index = href.<span class="title function_">indexOf</span>(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    href = href.<span class="title function_">slice</span>(index + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> href</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ensuerSlash</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关于 <strong>html5</strong>模式 这里 就没写了</p>
<p>然后回到 <strong>index.js</strong> 就是自己写的 <strong>Vue Router</strong>中继续编写模式判断</p>
<p>最后就是 初始化 init方法</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> install <span class="keyword">from</span> <span class="string">&#x27;./install&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> createMatcher <span class="keyword">from</span> <span class="string">&#x27;./create-matcher&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HashHistory</span> <span class="keyword">from</span> <span class="string">&#x27;./history/hash&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HTML5History</span> <span class="keyword">from</span> <span class="string">&#x27;./history/html5&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VueRouter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_routes</span> = options.<span class="property">routes</span> || \[\]</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">matcher</span> = <span class="title function_">createMatcher</span>(<span class="variable language_">this</span>.<span class="property">_routes</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mode</span> = options.<span class="property">mode</span> || <span class="string">&#x27;hash&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">mode</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;history&#x27;</span>:</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span> = <span class="keyword">new</span> <span class="title class_">HTML5History</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;hash&#x27;</span>:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span> = <span class="keyword">new</span> <span class="title class_">HashHistory</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;该模式不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> history = <span class="variable language_">this</span>.<span class="property">history</span></span><br><span class="line"></span><br><span class="line">    history.<span class="title function_">transitionTo</span>(history.<span class="property">getCurrentLocation</span>, <span class="function">() =&gt;</span></span><br><span class="line"></span><br><span class="line">      history.<span class="title function_">setUpListener</span>()</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">VueRouter</span>.<span class="property">install</span> = install</span><br></pre></td></tr></table></figure>
<h2 id="7-定义一个响应值-route"><a href="#7-定义一个响应值-route" class="headerlink" title="7.定义一个响应值 _route"></a>7.定义一个响应值 _route</h2><blockquote>
<p>渲染不同路由页面有个前提的就是需要一个表示 当前路由 响应式的属性</p>
<p>所以我们来到 <strong>install.js</strong> 添加一个响应式的 属性<strong>_route</strong></p>
<p>和这个无关的代码 <code>...</code>省略</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line">  _Vue = <span class="title class_">Vue</span></span><br><span class="line">  <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">    <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">router</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="title class_">Vue</span>.<span class="property">util</span>.<span class="title function_">defineReactive</span>(<span class="variable language_">this</span>, <span class="string">&#x27;\_route&#x27;</span>, <span class="variable language_">this</span>.\_router.<span class="property">history</span>.<span class="property">current</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后得回到 <strong>history</strong>下面的 <strong>base</strong> 添加一个修改响应式 <strong>_route</strong>的值的回调 <strong>this.cb</strong></p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createRoute <span class="keyword">from</span> <span class="string">&#x27;../util/route&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">History</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">router</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">listen</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">transitionTo</span>(<span class="params">path, onComplete</span>) &#123;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">cb</span>(<span class="variable language_">this</span>.<span class="property">current</span>)</span><br><span class="line">	...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最后在 <strong>index.js</strong> 的 <strong>init</strong> 调用 listen 方法 传入回调修改 响应式值<strong>_route</strong></p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">VueRouter</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">init</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    history.<span class="title function_">listen</span>(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Vue</span>.<span class="property">_route</span> = route</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="8-添加-router-和-route"><a href="#8-添加-router-和-route" class="headerlink" title="8.添加 $router 和 $route"></a>8.添加 <code>$router</code> 和 <code>$route</code></h2><blockquote>
<p>我们知道在 <strong>Vue Router</strong> 提供了 <strong><code>$router</code></strong> (这个是路由对象是<strong><code>Vue Router</code></strong>的实例) 还有 <strong>$route</strong>(路由规则对象)</p>
<p>我们自己可以来到 <code>install.js</code> 中进行 添加这两个属性</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;$router&#x27;</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.\_routerRoot.\_router</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;$route&#x27;</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.\_routerRoot.\_route</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-router-link"><a href="#9-router-link" class="headerlink" title="9.router-link"></a>9.router-link</h2><blockquote>
<p>基本的介绍就不多说了，之前也是有介绍的。然后现在重新来实现下</p>
<p>在 <strong>components</strong> 文件下新建 <strong>link.js</strong></p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">to</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(</span><br><span class="line"></span><br><span class="line">      <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">domProps</span>: &#123;</span><br><span class="line">          <span class="attr">href</span>: <span class="string">&#x27;#&#x27;</span> + <span class="variable language_">this</span>.<span class="property">to</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      \[<span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span>\]</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-router-view"><a href="#10-router-view" class="headerlink" title="10.router-view"></a>10.router-view</h2><blockquote>
<p>在 <strong>components</strong> 文件下新建 <strong>view.js</strong> 具体步骤干了什么都写在注释里了</p>
</blockquote>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> route = <span class="variable language_">this</span>.<span class="property">$route</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> depth = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">routerView</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> parent = <span class="variable language_">this</span>.<span class="property">$parent</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (parent.<span class="property">routerView</span>) &#123;</span><br><span class="line">        depth++</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      parent = parent.<span class="property">$parent</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> record = route.<span class="property">matched</span>\[depth\]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!record) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> component = record.<span class="property">component</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(component)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>好了到了这里 <strong>Vue Router</strong>的第二次编写就完成了，虽然和官方的差距很大。。额，因为这里是简化写的</p>
</blockquote>
<h2 id="11-文件目录"><a href="#11-文件目录" class="headerlink" title="11.文件目录"></a>11.文件目录</h2><blockquote>
<p>忘了最后贴上文件的目录</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3271178c386347b49ab772f2c088bf67~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="image-20210723215447677"></p>
<blockquote>
<p>这个模拟<strong>Vue Router</strong>的<strong>demo</strong> 放在了 <strong>github</strong>,有需要的可以这里 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FLianTianNo1%2Fmy_vue_router" title="https://github.com/LianTianNo1/my_vue_router">MyVueRouter</a></p>
<p>到了这里也只是仅仅实现了 <strong>VueRouter</strong>的一小部分功能</p>
<p>但是大体上的功能都差不多实现了，嵌套路由 添加动态路由也实现了</p>
<p>其实我觉得到这里了也可以了,不过还是得继续加油学习</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/xiaolangwiki/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/xiaolangwiki/">1</a><span class="page-number current">2</span><a class="page-number" href="/xiaolangwiki/page/3/">3</a><a class="extend next" rel="next" href="/xiaolangwiki/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="小浪wiki"
      src="/xiaolangwiki/images/avatar.png">
  <p class="site-author-name" itemprop="name">小浪wiki</p>
  <div class="site-description" itemprop="description">一个关于编程、计算机、软件工程、互联网的知识库。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/xiaolangwiki/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/xiaolangwiki/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/xiaolangwiki/tags/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/LianTianNo1" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LianTianNo1" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小浪wiki</span>
</div><div>
<!--添加网站运行时间-->
<span>小破站已经在风雨中度过了</span>
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    function createtime() {
        const startTime = '09/27/2018 00:12:55',
            start = new Date(startTime)
        let mill = new Date() - start,
            seconds = Math.floor(mill / 1000),
            mins = Math.floor(seconds / 60),
            hours = Math.floor(mins / 60),
            days = Math.floor(hours / 24)
        const time = {
            seconds: seconds - mins * 60,
            mins: mins - hours * 60,
            hours: hours - days * 24,
        }
        for (const k in time) {
            time[k] = `${time[k]}`.padStart(2, '0')
        }
        document.getElementById("timeDate").innerHTML = ` ${days} 天`
        document.getElementById("times").innerHTML = ` ${time.hours} 小时 ${time.mins} 分 ${time.seconds} 秒`
    }
    setInterval(createtime, 500)
</script>
</div>


        








      </div>
    </footer>
  </div>

  
  <script src="/xiaolangwiki/lib/anime.min.js"></script>
  <script src="/xiaolangwiki/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/xiaolangwiki/lib/velocity/velocity.min.js"></script>
  <script src="/xiaolangwiki/lib/velocity/velocity.ui.min.js"></script>

<script src="/xiaolangwiki/js/utils.js"></script>

<script src="/xiaolangwiki/js/motion.js"></script>


<script src="/xiaolangwiki/js/schemes/muse.js"></script>


<script src="/xiaolangwiki/js/next-boot.js"></script>

<script src="/xiaolangwiki/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/xiaolangwiki/js/local-search.js"></script>













    <div id="pjax">
  

  

  

    </div>
<script src="/xiaolangwiki/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/xiaolangwiki/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300,"left":10},"mobile":{"show":true}});</script></body>
</html>
